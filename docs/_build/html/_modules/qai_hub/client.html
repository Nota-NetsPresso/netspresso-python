

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>qai_hub.client &mdash; NetsPresso 1.13.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css" />

  
    <link rel="shortcut icon" href="../../_static/netspresso_symbol_navy.png"/>
      <script src="../../_static/jquery.js"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
      <script src="../../_static/doctools.js"></script>
      <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            NetsPresso
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../description.html">API Description</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">NetsPresso</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">qai_hub.client</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for qai_hub.client</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">posixpath</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tempfile</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">textwrap</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">TYPE_CHECKING</span><span class="p">,</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">ClassVar</span><span class="p">,</span>
    <span class="n">Dict</span><span class="p">,</span>
    <span class="n">List</span><span class="p">,</span>
    <span class="n">Optional</span><span class="p">,</span>
    <span class="n">Tuple</span><span class="p">,</span>
    <span class="n">Union</span><span class="p">,</span>
    <span class="n">cast</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urljoin</span><span class="p">,</span> <span class="n">urlparse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">zipfile</span><span class="w"> </span><span class="kn">import</span> <span class="n">ZipFile</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">deprecation</span>  <span class="c1"># type: ignore</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">h5py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">packaging.version</span><span class="w"> </span><span class="kn">import</span> <span class="n">Version</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">assert_never</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">api_status_codes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">public_api_pb2</span> <span class="k">as</span> <span class="n">api_pb</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">public_rest_api</span> <span class="k">as</span> <span class="n">api</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.public_rest_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">APIException</span><span class="p">,</span> <span class="n">ClientConfig</span><span class="p">,</span> <span class="n">DatasetEntries</span><span class="p">,</span> <span class="n">InputSpecs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.util.dataset_entries_converters</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">dataset_entries_to_h5</span><span class="p">,</span>
    <span class="n">h5_to_dataset_entries</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.util.zipped_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_zipped_model_compatible</span><span class="p">,</span> <span class="n">unzip_model</span><span class="p">,</span> <span class="n">zip_model</span>

<span class="n">SUPPORT_EMAIL</span> <span class="o">=</span> <span class="s2">&quot;ai-hub-support@qti.qualcomm.com&quot;</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="c1"># Evaluate to False in general. Only import to resolve Sphinx autodoc</span>
    <span class="c1"># typehints forward declaration warnings</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">coremltools</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">onnx</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>

<span class="n">MISSING_METRIC_VALUE</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">IS_WINDOWS</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;win32&quot;</span><span class="p">,</span> <span class="s2">&quot;msys&quot;</span><span class="p">,</span> <span class="s2">&quot;cygwin&quot;</span><span class="p">]</span>

<span class="n">ASSEMBLE_JSON_FILE</span> <span class="o">=</span> <span class="s2">&quot;assemble.json&quot;</span>
<span class="n">ESPRESSO_NET_FILE</span> <span class="o">=</span> <span class="s2">&quot;model.espresso.net&quot;</span>
<span class="n">TRTMODEL_METADATA_PATHS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;trt_metadata.json&quot;</span><span class="p">,</span> <span class="s2">&quot;trt_metadata.pb&quot;</span><span class="p">]</span>
<span class="c1"># Maximum amount of time to automatically retry on rate-limiting before giving up</span>
<span class="c1"># and raising an exception to the user.</span>
<span class="n">RATE_LIMIT_RETRY_TIMEOUT</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># minutes</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_dev_to_dev_pb</span><span class="p">(</span><span class="n">device</span><span class="p">:</span> <span class="n">Device</span><span class="p">):</span>
    <span class="n">dev_pb</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Device</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">device</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">os</span><span class="o">=</span><span class="n">device</span><span class="o">.</span><span class="n">os</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">device</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
        <span class="n">dev_pb</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dev_pb</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_devs_to_devs_pb</span><span class="p">(</span><span class="n">devices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Device</span><span class="p">]):</span>
    <span class="n">devices_pb</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">DeviceList</span><span class="p">(</span><span class="n">total_query_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">devices</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">dev</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
        <span class="n">devices_pb</span><span class="o">.</span><span class="n">devices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_dev_to_dev_pb</span><span class="p">(</span><span class="n">dev</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">devices_pb</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_dev_pb_to_dev</span><span class="p">(</span><span class="n">dev_pb</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Device</span><span class="p">):</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">dev_pb</span><span class="o">.</span><span class="n">attributes</span><span class="p">]</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">Device</span><span class="p">(</span><span class="n">dev_pb</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dev_pb</span><span class="o">.</span><span class="n">os</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">device</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_devs_pb_to_devs</span><span class="p">(</span><span class="n">devices_pb</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">DeviceList</span><span class="p">):</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dev</span> <span class="ow">in</span> <span class="n">devices_pb</span><span class="o">.</span><span class="n">devices</span><span class="p">:</span>
        <span class="n">devices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_dev_pb_to_dev</span><span class="p">(</span><span class="n">dev</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">devices</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_profile_pb_to_python_dict</span><span class="p">(</span><span class="n">profile_pb</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ProfileDetail</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="n">layer_details</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">layer_detail_pb</span> <span class="ow">in</span> <span class="n">profile_pb</span><span class="o">.</span><span class="n">layer_details</span><span class="p">:</span>
        <span class="n">layer_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">layer_detail_pb</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">layer_detail_pb</span><span class="o">.</span><span class="n">layer_type_name</span><span class="p">,</span>
            <span class="c1"># Remove the compute unit enum prefix (COMPUTE_UNIT_).</span>
            <span class="s2">&quot;compute_unit&quot;</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ComputeUnit</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="n">layer_detail_pb</span><span class="o">.</span><span class="n">compute_unit</span><span class="p">)[</span>
                <span class="nb">len</span><span class="p">(</span><span class="s2">&quot;COMPUTE_UNIT_&quot;</span><span class="p">)</span> <span class="p">:</span>
            <span class="p">],</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">layer_detail_pb</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s2">&quot;execution_time&quot;</span><span class="p">):</span>
            <span class="n">layer_data</span><span class="p">[</span><span class="s2">&quot;execution_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer_detail_pb</span><span class="o">.</span><span class="n">execution_time</span>
        <span class="k">if</span> <span class="n">layer_detail_pb</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s2">&quot;execution_cycles&quot;</span><span class="p">):</span>
            <span class="n">layer_data</span><span class="p">[</span><span class="s2">&quot;execution_cycles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer_detail_pb</span><span class="o">.</span><span class="n">execution_cycles</span>
        <span class="n">layer_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer_data</span><span class="p">)</span>

    <span class="n">execution_summary</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">profile_pb</span><span class="o">.</span><span class="n">major_version</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">execution_summary</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;estimated_inference_time&quot;</span><span class="p">:</span> <span class="n">profile_pb</span><span class="o">.</span><span class="n">execution_time</span><span class="p">,</span>
            <span class="s2">&quot;estimated_inference_peak_memory&quot;</span><span class="p">:</span> <span class="n">profile_pb</span><span class="o">.</span><span class="n">after_execution_peak_memory</span><span class="p">,</span>
            <span class="s2">&quot;first_load_time&quot;</span><span class="p">:</span> <span class="n">profile_pb</span><span class="o">.</span><span class="n">cold_load_time</span><span class="p">,</span>
            <span class="s2">&quot;first_load_peak_memory&quot;</span><span class="p">:</span> <span class="n">profile_pb</span><span class="o">.</span><span class="n">after_cold_load_peak_memory</span><span class="p">,</span>
            <span class="s2">&quot;warm_load_time&quot;</span><span class="p">:</span> <span class="n">profile_pb</span><span class="o">.</span><span class="n">warm_load_time</span><span class="p">,</span>
            <span class="s2">&quot;warm_load_peak_memory&quot;</span><span class="p">:</span> <span class="n">profile_pb</span><span class="o">.</span><span class="n">after_warm_load_peak_memory</span><span class="p">,</span>
            <span class="s2">&quot;compile_time&quot;</span><span class="p">:</span> <span class="n">profile_pb</span><span class="o">.</span><span class="n">compile_time</span><span class="p">,</span>
            <span class="s2">&quot;compile_peak_memory&quot;</span><span class="p">:</span> <span class="n">profile_pb</span><span class="o">.</span><span class="n">after_compile_peak_memory</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">profile_pb</span><span class="o">.</span><span class="n">minor_version</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">stage_memories</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ProfileDetail</span><span class="o">.</span><span class="n">MemoryUsage</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;compile&quot;</span><span class="p">,</span> <span class="n">profile_pb</span><span class="o">.</span><span class="n">compile_memory</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;first_load&quot;</span><span class="p">,</span> <span class="n">profile_pb</span><span class="o">.</span><span class="n">cold_load_memory</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;warm_load&quot;</span><span class="p">,</span> <span class="n">profile_pb</span><span class="o">.</span><span class="n">warm_load_memory</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;inference&quot;</span><span class="p">,</span> <span class="n">profile_pb</span><span class="o">.</span><span class="n">execution_memory</span><span class="p">),</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">stage</span><span class="p">,</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">stage_memories</span><span class="p">:</span>
                <span class="c1"># ByteSize() &gt; 0 means the field was explicitly set</span>
                <span class="k">if</span> <span class="n">memory</span><span class="o">.</span><span class="n">ByteSize</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">increase</span> <span class="o">=</span> <span class="n">memory</span><span class="o">.</span><span class="n">increase</span>
                    <span class="n">peak</span> <span class="o">=</span> <span class="n">memory</span><span class="o">.</span><span class="n">peak</span>
                    <span class="n">execution_summary</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stage</span><span class="si">}</span><span class="s2">_memory_increase_range&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">increase</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span>
                        <span class="n">increase</span><span class="o">.</span><span class="n">upper</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">execution_summary</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stage</span><span class="si">}</span><span class="s2">_memory_peak_range&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">peak</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span>
                        <span class="n">peak</span><span class="o">.</span><span class="n">upper</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">execution_summary</span><span class="p">[</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stage</span><span class="si">}</span><span class="s2">_memory_increase_range&quot;</span>
                    <span class="p">]</span> <span class="o">=</span> <span class="n">MISSING_METRIC_VALUE</span>
                    <span class="n">execution_summary</span><span class="p">[</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stage</span><span class="si">}</span><span class="s2">_memory_peak_range&quot;</span>
                    <span class="p">]</span> <span class="o">=</span> <span class="n">MISSING_METRIC_VALUE</span>
        <span class="k">if</span> <span class="n">profile_pb</span><span class="o">.</span><span class="n">minor_version</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">stage_all_times</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;compile&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">profile_pb</span><span class="o">.</span><span class="n">all_compile_times</span><span class="p">]),</span>
                <span class="p">(</span><span class="s2">&quot;first_load&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">profile_pb</span><span class="o">.</span><span class="n">all_cold_load_times</span><span class="p">]),</span>
                <span class="p">(</span><span class="s2">&quot;warm_load&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">profile_pb</span><span class="o">.</span><span class="n">all_warm_load_times</span><span class="p">]),</span>
                <span class="p">(</span><span class="s2">&quot;inference&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">profile_pb</span><span class="o">.</span><span class="n">all_execution_times</span><span class="p">]),</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">stage</span><span class="p">,</span> <span class="n">all_times</span> <span class="ow">in</span> <span class="n">stage_all_times</span><span class="p">:</span>
                <span class="n">execution_summary</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;all_</span><span class="si">{</span><span class="n">stage</span><span class="si">}</span><span class="s2">_times&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_times</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">execution_summary</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;estimated_inference_time&quot;</span><span class="p">:</span> <span class="n">profile_pb</span><span class="o">.</span><span class="n">execution_time</span><span class="p">,</span>
            <span class="s2">&quot;estimated_inference_peak_memory&quot;</span><span class="p">:</span> <span class="n">MISSING_METRIC_VALUE</span><span class="p">,</span>
            <span class="s2">&quot;first_load_time&quot;</span><span class="p">:</span> <span class="n">profile_pb</span><span class="o">.</span><span class="n">load_time</span><span class="p">,</span>
            <span class="s2">&quot;first_load_peak_memory&quot;</span><span class="p">:</span> <span class="n">MISSING_METRIC_VALUE</span><span class="p">,</span>
            <span class="s2">&quot;warm_load_time&quot;</span><span class="p">:</span> <span class="n">MISSING_METRIC_VALUE</span><span class="p">,</span>
            <span class="s2">&quot;warm_load_peak_memory&quot;</span><span class="p">:</span> <span class="n">MISSING_METRIC_VALUE</span><span class="p">,</span>
            <span class="s2">&quot;compile_time&quot;</span><span class="p">:</span> <span class="n">MISSING_METRIC_VALUE</span><span class="p">,</span>
            <span class="s2">&quot;compile_peak_memory&quot;</span><span class="p">:</span> <span class="n">profile_pb</span><span class="o">.</span><span class="n">peak_memory_usage</span><span class="p">,</span>
            <span class="s2">&quot;compile_memory_increase_range&quot;</span><span class="p">:</span> <span class="n">MISSING_METRIC_VALUE</span><span class="p">,</span>
            <span class="s2">&quot;compile_memory_peak_range&quot;</span><span class="p">:</span> <span class="n">MISSING_METRIC_VALUE</span><span class="p">,</span>
            <span class="s2">&quot;first_load_memory_increase_range&quot;</span><span class="p">:</span> <span class="n">MISSING_METRIC_VALUE</span><span class="p">,</span>
            <span class="s2">&quot;first_load_memory_peak_range&quot;</span><span class="p">:</span> <span class="n">MISSING_METRIC_VALUE</span><span class="p">,</span>
            <span class="s2">&quot;warm_load_memory_increase_range&quot;</span><span class="p">:</span> <span class="n">MISSING_METRIC_VALUE</span><span class="p">,</span>
            <span class="s2">&quot;warm_load_memory_peak_range&quot;</span><span class="p">:</span> <span class="n">MISSING_METRIC_VALUE</span><span class="p">,</span>
            <span class="s2">&quot;inference_memory_increase_range&quot;</span><span class="p">:</span> <span class="n">MISSING_METRIC_VALUE</span><span class="p">,</span>
            <span class="s2">&quot;inference_memory_peak_range&quot;</span><span class="p">:</span> <span class="n">MISSING_METRIC_VALUE</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;execution_summary&quot;</span><span class="p">:</span> <span class="n">execution_summary</span><span class="p">,</span>
        <span class="s2">&quot;execution_detail&quot;</span><span class="p">:</span> <span class="n">layer_details</span><span class="p">,</span>
    <span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_class_repr_print</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display a class repr according to some simple rules.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj: Object to display a repr for</span>
<span class="sd">    fields: List[str | (str, str)]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Record the max_width so that if width is not provided, we calculate it.</span>
    <span class="n">max_width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="s2">&quot;Class&quot;</span><span class="p">)</span>

    <span class="c1"># Add in the section header.</span>
    <span class="n">section_title</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="n">out_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">section_title</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">section_title</span><span class="p">)]</span>

    <span class="c1"># Add in all the key-value pairs</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">out_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">max_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_width</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out_fields</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">f</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">f</span><span class="p">)))</span>
            <span class="n">max_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_width</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

    <span class="c1"># Add in the empty footer.</span>
    <span class="n">out_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># Now, go through and format the key_value pairs nicely.</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">format_key_pair</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">key</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">max_width</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="n">out_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">format_key_pair</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">out_fields</span><span class="p">]</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_fields</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">requires_compilation</span><span class="p">(</span><span class="n">model_type</span><span class="p">:</span> <span class="n">SourceModelType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">TORCHSCRIPT</span>
        <span class="ow">or</span> <span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">AIMET_ONNX</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">allows_compilation</span><span class="p">(</span><span class="n">model_type</span><span class="p">:</span> <span class="n">SourceModelType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">ONNX</span> <span class="ow">or</span> <span class="n">requires_compilation</span><span class="p">(</span><span class="n">model_type</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_source_model_type_from_model_type</span><span class="p">(</span><span class="n">model_type</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelType</span><span class="o">.</span><span class="n">ValueType</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">model_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelType</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">model_type</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelType</span><span class="o">.</span><span class="n">MODEL_TYPE_UNSPECIFIED</span>
    <span class="k">return</span> <span class="n">SourceModelType</span><span class="p">(</span><span class="n">model_type</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_is_in_zip</span><span class="p">(</span><span class="nb">zip</span><span class="p">:</span> <span class="n">ZipFile</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">filename</span> <span class="ow">in</span> <span class="nb">zip</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_assert_is_valid_zipped_model</span><span class="p">(</span><span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Valid if one of following is true:</span>
    <span class="c1"># 1. is a valid Runtime model:</span>
    <span class="c1">#   * name is &lt;filepath&gt;/foo.trtmodel</span>
    <span class="c1">#   * &lt;filepath&gt;/foo.trtmodel/trt_metadata.[json|pb]</span>
    <span class="c1"># 2. has mlpackage</span>
    <span class="c1">#    &lt;filepath&gt;/foo.mlpackage/</span>
    <span class="c1"># 3. has one of following file (valid .mlmodelc)</span>
    <span class="c1">#   a. &lt;filepath&gt;/foo.mlmodelc/assemble.json</span>
    <span class="c1">#   b. &lt;filepath&gt;/foo.mlmodelc/model.espresso.net</span>
    <span class="c1">#   c. &lt;filepath&gt;/foo.mlmodelc/model0/model.espresso.net</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">__get_model_dir</span><span class="p">(</span>
        <span class="n">model_type</span><span class="p">:</span> <span class="n">SourceModelType</span><span class="p">,</span> <span class="n">zippedNames</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Is there exactly one subdirectory with the correct extension for the given model type?&quot;&quot;&quot;</span>
        <span class="n">ext_incl_zip</span> <span class="o">=</span> <span class="n">EXTENSIONS_BY_MODEL_TYPE</span><span class="p">[</span><span class="n">model_type</span><span class="p">]</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="n">ext_incl_zip</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">suffix_with_trailing_slash</span> <span class="o">=</span> <span class="n">suffix</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
        <span class="n">model_subdirs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">dname</span> <span class="k">for</span> <span class="n">dname</span> <span class="ow">in</span> <span class="n">zippedNames</span> <span class="k">if</span> <span class="n">dname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix_with_trailing_slash</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">model_subdirs</span><span class="p">:</span>
            <span class="c1"># Zip files do not have to contain separate entries for</span>
            <span class="c1"># directories. If this is the case, model_subdirs is empty and we</span>
            <span class="c1"># need to infer the sub directories from files.</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">_get_root</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">head</span><span class="p">,</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">head</span> <span class="o">==</span> <span class="s2">&quot;/&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">head</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">tail</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">_get_root</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>

            <span class="n">model_subdirs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">_get_root</span><span class="p">(</span><span class="n">dname</span><span class="p">)</span> <span class="k">for</span> <span class="n">dname</span> <span class="ow">in</span> <span class="n">zippedNames</span><span class="p">]))</span>
            <span class="n">model_subdirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">model_subdirs</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_subdirs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid zipped model contains multiple &#39;</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&#39; directories.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">model_subdirs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_subdirs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">with</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zippedModel</span><span class="p">:</span>
        <span class="n">zippedNames</span> <span class="o">=</span> <span class="n">zippedModel</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">__get_model_dir</span><span class="p">(</span><span class="n">SourceModelType</span><span class="o">.</span><span class="n">AIMET_ONNX</span><span class="p">,</span> <span class="n">zippedNames</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">__get_model_dir</span><span class="p">(</span><span class="n">SourceModelType</span><span class="o">.</span><span class="n">MLPACKAGE</span><span class="p">,</span> <span class="n">zippedNames</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Is a valid mlpackage zipped model</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">__get_model_dir</span><span class="p">(</span><span class="n">SourceModelType</span><span class="o">.</span><span class="n">ONNX</span><span class="p">,</span> <span class="n">zippedNames</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">trtmodel_dir</span> <span class="o">=</span> <span class="n">__get_model_dir</span><span class="p">(</span><span class="n">SourceModelType</span><span class="o">.</span><span class="n">TETRART</span><span class="p">,</span> <span class="n">zippedNames</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trtmodel_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metadata_paths</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">trtmodel_dir</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">TRTMODEL_METADATA_PATHS</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">_is_in_zip</span><span class="p">(</span><span class="n">zippedModel</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">metadata_paths</span><span class="p">]):</span>
                <span class="k">return</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;.trtmodel&#39; bundle has no metadata file.&quot;</span><span class="p">)</span>

        <span class="c1"># Check if it&#39;s a valid mlmodelc zipped model</span>
        <span class="c1"># Find .mlmodelc directory</span>
        <span class="n">mlmodelc_dir</span> <span class="o">=</span> <span class="n">__get_model_dir</span><span class="p">(</span><span class="n">SourceModelType</span><span class="o">.</span><span class="n">MLMODELC</span><span class="p">,</span> <span class="n">zippedNames</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mlmodelc_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="s2">&quot;Incorrect zipped model .zip provided.&quot;</span>
                <span class="s2">&quot; Must have one root level &#39;.trtmodel&#39;, &#39;.mlmodelc&#39;, or &#39;.mlpackage&#39; directory.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Case 3. a): &lt;filepath&gt;/foo.mlmodelc/assemble.json</span>
        <span class="k">if</span> <span class="n">_is_in_zip</span><span class="p">(</span><span class="n">zippedModel</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mlmodelc_dir</span><span class="p">,</span> <span class="n">ASSEMBLE_JSON_FILE</span><span class="p">)):</span>
            <span class="k">return</span>
        <span class="c1"># Search in the .mlmodelc directory</span>
        <span class="c1"># Case 3. b): &lt;filepath&gt;/foo.mlmodelc/model.espresso.net</span>
        <span class="k">if</span> <span class="n">_is_in_zip</span><span class="p">(</span><span class="n">zippedModel</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mlmodelc_dir</span><span class="p">,</span> <span class="n">ESPRESSO_NET_FILE</span><span class="p">)):</span>
            <span class="k">return</span>
        <span class="c1"># Case 3. c): &lt;filepath&gt;/foo.mlmodelc/model0/model.espresso.net</span>
        <span class="k">if</span> <span class="n">_is_in_zip</span><span class="p">(</span>
            <span class="n">zippedModel</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mlmodelc_dir</span><span class="p">,</span> <span class="s2">&quot;model0&quot;</span><span class="p">,</span> <span class="n">ESPRESSO_NET_FILE</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># No match in each of the 3 supported types</span>
        <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Incorrect mlmodelc.zip provided. Neither </span><span class="si">{</span><span class="n">ESPRESSO_NET_FILE</span><span class="si">}</span><span class="s2"> nor </span><span class="si">{</span><span class="n">ASSEMBLE_JSON_FILE</span><span class="si">}</span><span class="s2"> found.&quot;</span>
        <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_make_zipped_model_compatible</span><span class="p">(</span>
    <span class="n">source_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">archive_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_ext</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If source_path is a directory, zip it up.</span>
<span class="sd">    If source_path is a zip, ensure only one model asset is present in zip.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    source_path:</span>
<span class="sd">        A model zip archive or directory.</span>
<span class="sd">    archive_path:</span>
<span class="sd">        Path of archive to create if source path is a directory.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    model_archive_path :</span>
<span class="sd">        Path to a zip file containing the source model.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    UserError</span>
<span class="sd">        if source_path is a directory but not a model</span>
<span class="sd">    UserError</span>
<span class="sd">        if provided zipped archive has no or more than one model asset at base path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">source_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">source_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">model_ext</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Provided source path must point to </span><span class="si">{</span><span class="n">model_ext</span><span class="si">}</span><span class="s2"> dir. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Provided </span><span class="si">{</span><span class="n">source_path</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">zip_model</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">archive_path</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)),</span>
            <span class="n">source_path</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="c1"># Make existing archived model compatible with hub</span>
    <span class="k">return</span> <span class="n">make_zipped_model_compatible</span><span class="p">(</span><span class="n">source_path</span><span class="p">,</span> <span class="n">archive_path</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_is_apple_version_supported</span><span class="p">(</span>
    <span class="n">device_attributes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
    <span class="n">os_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">target_major_ios_version</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns True if given `os_version` belongs to the generation defined by the</span>
<span class="sd">    `target_major_ios_version`. Note, if this is set to iOS 16, then macOS 13</span>
<span class="sd">    will also return True, since they are generationally equivalent.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">os_version</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">os_major</span> <span class="o">=</span> <span class="n">Version</span><span class="p">(</span><span class="n">os_version</span><span class="p">)</span><span class="o">.</span><span class="n">major</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">device_attributes</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">device_attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">device_attributes</span><span class="p">]</span>

    <span class="c1"># .mlpackage is supported on</span>
    <span class="c1">#  - iOS15+</span>
    <span class="c1">#  - macOS12+</span>
    <span class="c1"># Ref: https://github.com/apple/coremltools/blob/801c705340093cb2d61ffeaf1244408194b4f89e/coremltools/converters/mil/_deployment_compatibility.py#L17</span>
    <span class="k">if</span> <span class="s2">&quot;os:ios&quot;</span> <span class="ow">in</span> <span class="n">device_attributes</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os_major</span> <span class="o">&gt;=</span> <span class="n">target_major_ios_version</span>
    <span class="k">if</span> <span class="s2">&quot;os:macos&quot;</span> <span class="ow">in</span> <span class="n">device_attributes</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os_major</span> <span class="o">&gt;=</span> <span class="n">target_major_ios_version</span> <span class="o">-</span> <span class="mi">3</span>
    <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_is_mlpackage_supported</span><span class="p">(</span>
    <span class="n">device_attributes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">os_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">version_buffer</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns True if mlpackage is supported for given device i.e.</span>
<span class="sd">        - iPhone/iPad with iOS15+</span>
<span class="sd">        - mac with macOS12+</span>
<span class="sd">    Otherwise, False</span>

<span class="sd">    ref: https://github.com/apple/coremltools/blob/801c705340093cb2d61ffeaf1244408194b4f89e/coremltools/converters/mil/_deployment_compatibility.py#L17</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_is_apple_version_supported</span><span class="p">(</span>
        <span class="n">device_attributes</span><span class="p">,</span> <span class="n">os_version</span><span class="p">,</span> <span class="n">target_major_ios_version</span><span class="o">=</span><span class="mi">15</span>
    <span class="p">)</span>


<span class="c1">## ERROR HANDLING ##</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Error</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all exceptions explicitly thrown by the API.</span>

<span class="sd">    Other exception may be raised from dependent third party packages.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">InternalError</span><span class="p">(</span><span class="n">Error</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal API failure; please contact ai-hub-support@qti.qualcomm.com for assistance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">UserError</span><span class="p">(</span><span class="n">Error</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Something in the user input caused a failure; you may need to adjust your input.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">RateLimitedError</span><span class="p">(</span><span class="n">Error</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The operation was rate-limited by the server.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">pass</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_visible_textbox</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Letting exceptions terminate a python program is a cluttered way to give</span>
<span class="sd">    user feedback. This box is to draw attention to action items for users.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mi">70</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">wrapper</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">TextWrapper</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">footer</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span>

    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;| &quot;</span> <span class="o">+</span> <span class="n">line</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; |&quot;</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">text</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">header</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="n">footer</span>


<span class="c1"># Retry api calls with exponential back-off and a max duration.</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_api_call_with_retry</span><span class="p">(</span><span class="n">api_func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="n">time_between_retries</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># seconds</span>
    <span class="n">max_time_between_retries</span> <span class="o">=</span> <span class="mi">60</span>  <span class="c1"># seconds</span>
    <span class="n">total_time_spent_retrying</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># seconds</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response_pb</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span><span class="n">api_func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">RateLimitedError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="n">_visible_textbox</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> Retrying periodically until your request succeeds. Interrupt this and pass retry=False if you don&#39;t want this automatic retry.&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retrying after </span><span class="si">{</span><span class="n">time_between_retries</span><span class="si">}</span><span class="s2"> seconds.&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">time_between_retries</span><span class="p">)</span>
            <span class="n">total_time_spent_retrying</span> <span class="o">+=</span> <span class="n">time_between_retries</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">response_pb</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span><span class="n">api_func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="n">RateLimitedError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">total_time_spent_retrying</span> <span class="o">&gt;</span> <span class="n">RATE_LIMIT_RETRY_TIMEOUT</span> <span class="o">*</span> <span class="mi">60</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">RateLimitedError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Could not create a job after retrying for </span><span class="si">{</span><span class="n">RATE_LIMIT_RETRY_TIMEOUT</span><span class="si">}</span><span class="s2"> minutes. Please try again later.&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>

                <span class="n">time_between_retries</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                    <span class="n">time_between_retries</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">max_time_between_retries</span>
                <span class="p">)</span>
                <span class="k">continue</span>

    <span class="k">return</span> <span class="n">response_pb</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_raise_if_hub_user_error</span><span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">APIException</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ClientConfig</span><span class="p">]):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_exception_string</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># for some 4xx exceptions the actual message is embedded in the exception</span>
        <span class="n">message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="p">)[</span><span class="s2">&quot;detail&quot;</span><span class="p">]</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">message</span>

    <span class="n">config_path</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">get_config_path</span><span class="p">(</span><span class="n">expanduser</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">web_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">web_url</span> <span class="k">if</span> <span class="n">config</span> <span class="k">else</span> <span class="n">api</span><span class="o">.</span><span class="n">DEFAULT_HUB_WEB_URL</span>
    <span class="n">account_page_link_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">web_url</span><span class="si">}</span><span class="s2">/account/&quot;</span>

    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">api_status_codes</span><span class="o">.</span><span class="n">API_CONFIGURATION_MISSING_FIELDS</span><span class="p">:</span>
        <span class="n">long_message</span> <span class="o">=</span> <span class="n">_visible_textbox</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Your </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2"> file is missing required fields. &quot;</span>
            <span class="s2">&quot;Please go to your Account page for help configuring qai-hub&quot;</span>
            <span class="o">+</span> <span class="n">account_page_link_text</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load configuration file.</span><span class="se">\n</span><span class="si">{</span><span class="n">long_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
    <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">api_status_codes</span><span class="o">.</span><span class="n">HTTP_401_UNAUTHORIZED</span><span class="p">:</span>
        <span class="n">long_message</span> <span class="o">=</span> <span class="n">_visible_textbox</span><span class="p">(</span>
            <span class="s2">&quot;Failure to authenticate is likely caused by a bad or outdated API &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;token in your </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2"> file. Please go to your Account page &quot;</span>
            <span class="s2">&quot;to view your current token&quot;</span> <span class="o">+</span> <span class="n">account_page_link_text</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to authenticate.</span><span class="se">\n</span><span class="si">{</span><span class="n">long_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
    <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">api_status_codes</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
    <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">api_status_codes</span><span class="o">.</span><span class="n">HTTP_413_REQUEST_ENTITY_TOO_LARGE</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
            <span class="n">_get_exception_string</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;Please contact support at </span><span class="si">{</span><span class="n">SUPPORT_EMAIL</span><span class="si">}</span><span class="s2"> if you need assistance.&quot;</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">api_status_codes</span><span class="o">.</span><span class="n">HTTP_426_UPGRADE_REQUIRED</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="n">_visible_textbox</span><span class="p">(</span><span class="n">_get_exception_string</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
    <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">api_status_codes</span><span class="o">.</span><span class="n">HTTP_429_TOO_MANY_REQUESTS</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">RateLimitedError</span><span class="p">(</span><span class="n">_get_exception_string</span><span class="p">(</span><span class="n">e</span><span class="p">))</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
    <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="n">_get_exception_string</span><span class="p">(</span><span class="n">e</span><span class="p">))</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_is_hub_request</span><span class="p">(</span><span class="n">api_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
    <span class="c1"># when we don&#39;t have enough info, assume Hub</span>
    <span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">api_url</span><span class="p">)</span> <span class="k">if</span> <span class="n">api_url</span> <span class="ow">and</span> <span class="n">url</span> <span class="k">else</span> <span class="kc">True</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_raise_internal_error</span><span class="p">(</span>
    <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cause</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">,</span>
    <span class="n">api_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">contact_support</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">is_hub_request</span> <span class="o">=</span> <span class="n">_is_hub_request</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_hub_request</span><span class="p">:</span>
        <span class="n">service</span> <span class="o">=</span> <span class="s2">&quot;Qualcomm AI Hub&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">request_url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">service</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">request_url</span><span class="o">.</span><span class="n">netloc</span><span class="p">)</span>

    <span class="n">long_message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="n">service</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_hub_request</span> <span class="ow">and</span> <span class="n">api_url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">long_message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; Please visit </span><span class="si">{</span><span class="n">api_url</span><span class="si">}</span><span class="s2"> to check the service&#39;s status.&quot;</span>

    <span class="k">if</span> <span class="n">contact_support</span><span class="p">:</span>
        <span class="n">long_message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; Please contact support at </span><span class="si">{</span><span class="n">SUPPORT_EMAIL</span><span class="si">}</span><span class="s2">.&quot;</span>

    <span class="k">raise</span> <span class="n">InternalError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Internal API failure.</span><span class="se">\n</span><span class="si">{</span><span class="n">_visible_textbox</span><span class="p">(</span><span class="n">long_message</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">cause</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_extract_exception_url</span><span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">e</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">request</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_api_call</span><span class="p">(</span><span class="n">api_func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper to re-raise the most common API exceptions appropriate for the</span>
<span class="sd">    client.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">args</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ClientConfig</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">api_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">api_url</span> <span class="k">if</span> <span class="n">config</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">api_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RetryError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">_extract_exception_url</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;too many 502 error responses&quot;</span>
            <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;too many 503 error responses&quot;</span>
        <span class="p">):</span>
            <span class="n">_raise_internal_error</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{service}</span><span class="s2"> is unavailable right now.&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">api_url</span><span class="p">,</span> <span class="n">url</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_raise_internal_error</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{service}</span><span class="s2"> reported errors. &quot;</span><span class="p">,</span>
                <span class="n">e</span><span class="p">,</span>
                <span class="n">api_url</span><span class="p">,</span>
                <span class="n">url</span><span class="p">,</span>
                <span class="n">contact_support</span><span class="o">=</span><span class="n">_is_hub_request</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">url</span><span class="p">),</span>
            <span class="p">)</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">_extract_exception_url</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">_raise_internal_error</span><span class="p">(</span><span class="s2">&quot;Could not connect to </span><span class="si">{service}</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">api_url</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">_extract_exception_url</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">_raise_internal_error</span><span class="p">(</span>
            <span class="s2">&quot;Timeout occurred while communicating with </span><span class="si">{service}</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">api_url</span><span class="p">,</span> <span class="n">url</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">api</span><span class="o">.</span><span class="n">APIException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">url</span>
        <span class="n">is_hub_request</span> <span class="o">=</span> <span class="n">_is_hub_request</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_hub_request</span><span class="p">:</span>
            <span class="n">_raise_if_hub_user_error</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">e</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">api_status_codes</span><span class="o">.</span><span class="n">HTTP_502_BAD_GATEWAY</span>
            <span class="ow">or</span> <span class="n">e</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">api_status_codes</span><span class="o">.</span><span class="n">HTTP_503_SERVICE_UNAVAILABLE</span>
        <span class="p">):</span>
            <span class="n">_raise_internal_error</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{service}</span><span class="s2"> is unavailable right now.&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">api_url</span><span class="p">,</span> <span class="n">url</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">500</span><span class="p">:</span>
            <span class="n">_raise_internal_error</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{service}</span><span class="s2"> reported errors.&quot;</span><span class="p">,</span>
                <span class="n">e</span><span class="p">,</span>
                <span class="n">api_url</span><span class="p">,</span>
                <span class="n">url</span><span class="p">,</span>
                <span class="n">contact_support</span><span class="o">=</span><span class="n">is_hub_request</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">is_hub_request</span><span class="p">:</span>
            <span class="c1"># 4xx or other errors from another service like AWS means a bug in AI Hub code</span>
            <span class="n">_raise_internal_error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">e</span><span class="p">,</span> <span class="n">api_url</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">contact_support</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Re-raise, let the function catch it, or let it bubble up</span>
            <span class="k">raise</span>


<span class="c1">## DATASET ##</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Dataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    A dataset should not be constructed directly. It is constructed by the hub client</span>
<span class="sd">    through :py:func:`qai_hub.upload_dataset`,  :py:func:`qai_hub.get_dataset` or :py:func:`qai_hub.get_datasets`.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    dataset_id : str</span>
<span class="sd">        The dataset ID.</span>
<span class="sd">    creation_time : datetime</span>
<span class="sd">        The time this dataset was created.</span>
<span class="sd">    dataset_name : str</span>
<span class="sd">        Name of this dataset</span>
<span class="sd">    expiration_time: datetime</span>
<span class="sd">        The time this dataset will expire.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">owner</span><span class="p">:</span> <span class="n">Client</span><span class="p">,</span>
        <span class="n">dataset_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">creation_time</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
        <span class="n">expiration_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DatasetEntries</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span> <span class="o">=</span> <span class="n">owner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">dataset_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span> <span class="o">=</span> <span class="n">dataset_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creation_time</span> <span class="o">=</span> <span class="n">creation_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expiration_time</span> <span class="o">=</span> <span class="n">expiration_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetEntries</span> <span class="o">|</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Downloads the dataset entries either to memory or to an h5py (.h5) file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename:</span>
<span class="sd">            If filename is specified the dataset is downloaded to file, otherwise to memory.</span>
<span class="sd">            If the filename doesn&#39;t end with the correct file extension,</span>
<span class="sd">            the appropriate file extension is added to the name.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : DatasetEntries | str</span>
<span class="sd">            Loaded data instance or file name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_expired</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot download expired dataset. </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">download_file</span> <span class="o">=</span> <span class="n">filename</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># delete=False to be compatible with Windows</span>
                <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">download_file</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span>
                <span class="c1"># Close the file to avoid double-open on Windows</span>

            <span class="n">download_file</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span>
                <span class="n">api</span><span class="o">.</span><span class="n">download_dataset</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span>
                <span class="n">file_path</span><span class="o">=</span><span class="n">download_file</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded dataset to </span><span class="si">{</span><span class="n">download_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">download_file</span>

            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">download_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5f</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">h5_to_dataset_entries</span><span class="p">(</span><span class="n">h5f</span><span class="p">)</span>

            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">download_file</span><span class="p">)</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                <span class="c1"># Grab filename from the API and append it to the path.</span>
                <span class="n">dataset_info</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span>
                    <span class="n">api</span><span class="o">.</span><span class="n">download_dataset_info</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span>
                <span class="p">)</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dataset_info</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>

                <span class="c1"># Append suffix if necessary, so we don&#39;t overwrite.</span>
                <span class="n">filename</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_unique_path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.h5&quot;</span><span class="p">):</span>
                <span class="n">filename</span> <span class="o">+=</span> <span class="s2">&quot;.h5&quot;</span>

            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5f</span><span class="p">:</span>
                <span class="n">dataset_entries_to_h5</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">h5f</span><span class="p">)</span>

            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded dataset to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">filename</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Dataset(id=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span><span class="si">}</span><span class="s2">&#39;, name=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;, expiration_time=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">expiration_time</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_expiration_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_expired</span><span class="p">():</span>
            <span class="k">return</span> <span class="s2">&quot;Expired&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Not Expired&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_expired</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">expiration_time</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expiration_time</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_class_repr_print</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s2">&quot;dataset_id&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                <span class="s2">&quot;creation_time&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="s2">&quot;expiration_status&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_expiration_status</span><span class="p">()),</span>
            <span class="p">],</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_sharing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the list of email addresses of users that this dataset has been shared with.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span>
            <span class="n">api</span><span class="o">.</span><span class="n">get_sharing</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span>
            <span class="n">api</span><span class="o">.</span><span class="n">SharedEntityType</span><span class="o">.</span><span class="n">DATASET</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">email</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">disable_sharing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable all sharing for this dataset.</span>

<span class="sd">        Note that the dataset will still be accessible by users with which related job(s) are shared.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_api_call</span><span class="p">(</span>
            <span class="n">api</span><span class="o">.</span><span class="n">disable_sharing</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span>
            <span class="n">api</span><span class="o">.</span><span class="n">SharedEntityType</span><span class="o">.</span><span class="n">DATASET</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">modify_sharing</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">add_emails</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">delete_emails</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modifies the list of users that the dataset is shared with.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">add_emails</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">delete_emails</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="s2">&quot;Either add_emails or delete_emails must be specified and non-empty&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">add_emails</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">delete_emails</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;add_emails and delete_emails must both be lists&quot;</span><span class="p">)</span>

        <span class="n">_api_call</span><span class="p">(</span>
            <span class="n">api</span><span class="o">.</span><span class="n">modify_sharing</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span>
            <span class="n">api</span><span class="o">.</span><span class="n">SharedEntityType</span><span class="o">.</span><span class="n">DATASET</span><span class="p">,</span>
            <span class="n">add_emails</span><span class="p">,</span>
            <span class="n">delete_emails</span><span class="p">,</span>
        <span class="p">)</span>


<span class="c1">## DEVICES ##</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_validate_device_params</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">attributes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">os</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">attributes</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Cannot filter devices when provided only an OS version. Please provide a device name and/or attributes.&quot;</span>
        <span class="p">)</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Device</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a target device representation.</span>

<span class="sd">    The actual target device selection is done when a job is submitted.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    name:str</span>
<span class="sd">        A name must be an exact match with an existing device, e.g. `&quot;Samsung Galaxy S23&quot;`.</span>
<span class="sd">    os:str</span>
<span class="sd">       The OS can either be empty, a specific version, or a version interval. If a</span>
<span class="sd">        specific vesion is specified (`&quot;15.2&quot;`), it must be an exact match with an</span>
<span class="sd">        existing device.  An interval can be used to get a range of OS</span>
<span class="sd">        versions. The OS interval must be a</span>
<span class="sd">        `right-open mixed interval &lt;https://simple.wikipedia.org/wiki/Interval_(mathematics)#Mixed_Intervals&gt;`_.</span>
<span class="sd">        Either side of an interval can be empty, e.g. `&quot;[12,13)&quot;` or `&quot;[12,)&quot;`.</span>
<span class="sd">        If the OS is empty, this device represents the device with the latest OS version</span>
<span class="sd">        selected from all devices compatible with the name and attriutes.</span>
<span class="sd">    attributes: str|List[str]</span>
<span class="sd">        Additional device attributes. The selected device is compatible with all</span>
<span class="sd">        attributes specified. Supported attributes are:</span>

<span class="sd">            * ``&quot;format:phone&quot;``</span>
<span class="sd">            * ``&quot;format:tablet&quot;``</span>
<span class="sd">            * ``&quot;framework:tflite&quot;``</span>
<span class="sd">            * ``&quot;framework:qnn&quot;``</span>
<span class="sd">            * ``&quot;framework:onnx&quot;``</span>
<span class="sd">            * ``&quot;vendor:google&quot;``</span>
<span class="sd">            * ``&quot;vendor:samsung&quot;``</span>
<span class="sd">            * ``&quot;vendor:xiaomi&quot;``</span>
<span class="sd">            * ``&quot;vendor:oneplus&quot;``</span>

<span class="sd">            * ``&quot;os:android&quot;``</span>

<span class="sd">            * ``&quot;chipset:qualcomm-snapdragon-429&quot;``</span>
<span class="sd">            * ``&quot;chipset:qualcomm-snapdragon-670&quot;``</span>
<span class="sd">            * ``&quot;chipset:qualcomm-snapdragon-678&quot;``</span>
<span class="sd">            * ``&quot;chipset:qualcomm-snapdragon-730&quot;``</span>
<span class="sd">            * ``&quot;chipset:qualcomm-snapdragon-730g&quot;``</span>
<span class="sd">            * ``&quot;chipset:qualcomm-snapdragon-765g&quot;``</span>
<span class="sd">            * ``&quot;chipset:qualcomm-snapdragon-778g&quot;``</span>
<span class="sd">            * ``&quot;chipset:qualcomm-snapdragon-845&quot;``</span>
<span class="sd">            * ``&quot;chipset:qualcomm-snapdragon-855&quot;``</span>
<span class="sd">            * ``&quot;chipset:qualcomm-snapdragon-865+&quot;``</span>
<span class="sd">            * ``&quot;chipset:qualcomm-snapdragon-888&quot;``</span>
<span class="sd">            * ``&quot;chipset:qualcomm-snapdragon-8gen1&quot;``</span>
<span class="sd">            * ``&quot;chipset:qualcomm-snapdragon-8gen2&quot;``</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ::</span>

<span class="sd">        import qai_hub as hub</span>

<span class="sd">    Select a target device for Samsung Galaxy S23 with specifically Android 13:</span>

<span class="sd">        device = hub.Device(&quot;Samsung Galaxy S23&quot;, &quot;13&quot;)</span>

<span class="sd">    Select a target device with OS major version 11::</span>

<span class="sd">        device = hub.Device(os=&quot;[11,12)&quot;, attributes=&quot;os:android&quot;)</span>

<span class="sd">    Select a target device with a Snapdragon 8 Gen 2 chipset::</span>

<span class="sd">        device = hub.Device(attributes=&quot;chipset:qualcomm-snapdragon-8gen2&quot;)</span>

<span class="sd">    Fetch a list of devices using :py:func:`~qai_hub.get_devices`::</span>

<span class="sd">        devices = hub.get_devices()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">os</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">attributes</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
        <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_validate_device_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">os</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>


<span class="c1">## MODELS ##</span>

<span class="n">SourceModel</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="s2">&quot;torch.jit.TopLevelTracedModule&quot;</span><span class="p">,</span>  <span class="c1"># type: ignore # noqa: F821 (imported conditionally)</span>
    <span class="s2">&quot;coremltools.models.model.MLModel&quot;</span><span class="p">,</span>  <span class="c1"># type: ignore # noqa: F821 (imported conditionally)</span>
    <span class="s2">&quot;onnx.ModelProto&quot;</span><span class="p">,</span>  <span class="c1"># type: ignore # noqa: F821 (imported conditionally)</span>
    <span class="nb">bytes</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">TargetModel</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="s2">&quot;coremltools.models.model.MLModel&quot;</span><span class="p">,</span>  <span class="c1"># type: ignore # noqa: F821 (imported conditionally)</span>
    <span class="nb">bytes</span><span class="p">,</span>  <span class="c1"># for TF-Lite and ORT</span>
<span class="p">]</span>


<span class="c1"># Mirrors api_pb.ModelType</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SourceModelType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set of supported input model types.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">UNRECOGNIZED_MODEL_TYPE</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelType</span><span class="o">.</span><span class="n">MODEL_TYPE_UNSPECIFIED</span>
    <span class="n">TORCHSCRIPT</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelType</span><span class="o">.</span><span class="n">MODEL_TYPE_TORCHSCRIPT</span>
    <span class="n">MLMODEL</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelType</span><span class="o">.</span><span class="n">MODEL_TYPE_MLMODEL</span>
    <span class="n">TFLITE</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelType</span><span class="o">.</span><span class="n">MODEL_TYPE_TFLITE</span>
    <span class="n">MLMODELC</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelType</span><span class="o">.</span><span class="n">MODEL_TYPE_MLMODELC</span>
    <span class="n">ONNX</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelType</span><span class="o">.</span><span class="n">MODEL_TYPE_ONNX</span>
    <span class="n">ORT</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelType</span><span class="o">.</span><span class="n">MODEL_TYPE_ORT</span>
    <span class="n">MLPACKAGE</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelType</span><span class="o">.</span><span class="n">MODEL_TYPE_MLPACKAGE</span>
    <span class="n">TETRART</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelType</span><span class="o">.</span><span class="n">MODEL_TYPE_TETRART</span>
    <span class="n">QNN_LIB_AARCH64_ANDROID</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelType</span><span class="o">.</span><span class="n">MODEL_TYPE_QNN_LIB_AARCH64_ANDROID</span>
    <span class="n">QNN_LIB_X86_64_LINUX</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelType</span><span class="o">.</span><span class="n">MODEL_TYPE_QNN_LIB_X86_64_LINUX</span>
    <span class="n">QNN_CONTEXT_BINARY</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelType</span><span class="o">.</span><span class="n">MODEL_TYPE_QNN_CONTEXT_BINARY</span>
    <span class="n">AIMET_ONNX</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelType</span><span class="o">.</span><span class="n">MODEL_TYPE_AIMET_ONNX</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_missing_</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">UNRECOGNIZED_MODEL_TYPE</span>


<span class="c1"># Mirrors api_pb.ModelMetadataKey</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ModelMetadataKey</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model metadata key.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">UNSPECIFIED</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelMetadataKey</span><span class="o">.</span><span class="n">MODEL_METADATA_KEY_UNSPECIFIED</span>
    <span class="n">QNN_SDK_VERSION</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelMetadataKey</span><span class="o">.</span><span class="n">MODEL_METADATA_KEY_QNN_SDK_VERSION</span>
    <span class="n">QNN_SDK_VARIANT</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelMetadataKey</span><span class="o">.</span><span class="n">MODEL_METADATA_KEY_QNN_SDK_VARIANT</span>
    <span class="n">QNN_CONTEXT_BIN_GRAPH_NAMES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelMetadataKey</span><span class="o">.</span><span class="n">MODEL_METADATA_KEY_QNN_CONTEXT_BIN_GRAPH_NAMES</span>
    <span class="p">)</span>
    <span class="n">QNN_CONTEXT_BIN_HEXAGON_VERSION</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelMetadataKey</span><span class="o">.</span><span class="n">MODEL_METADATA_KEY_QNN_CONTEXT_BIN_HEXAGON_VERSION</span>
    <span class="p">)</span>
    <span class="n">QNN_CONTEXT_BIN_SOC_MODEL</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelMetadataKey</span><span class="o">.</span><span class="n">MODEL_METADATA_KEY_QNN_CONTEXT_BIN_SOC_MODEL</span>
    <span class="p">)</span>
    <span class="n">QNN_CONTEXT_BIN_BACKEND</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelMetadataKey</span><span class="o">.</span><span class="n">MODEL_METADATA_KEY_QNN_CONTEXT_BIN_BACKEND</span>
    <span class="p">)</span>
    <span class="n">QNN_CONTEXT_BIN_VTCM</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelMetadataKey</span><span class="o">.</span><span class="n">MODEL_METADATA_KEY_QNN_CONTEXT_BIN_VTCM</span>
    <span class="p">)</span>
    <span class="n">QNN_CONTEXT_BIN_OPTIMIZATION_LEVEL</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelMetadataKey</span><span class="o">.</span><span class="n">MODEL_METADATA_KEY_QNN_CONTEXT_BIN_OPTIMIZATION_LEVEL</span>
    <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_missing_</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ModelMetadataKey</span><span class="o">.</span><span class="n">UNSPECIFIED</span>


<span class="k">class</span><span class="w"> </span><span class="nc">QuantizeDtype</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Supported data types when submitting quantize jobs.&quot;&quot;&quot;</span>

    <span class="n">INT8</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">QuantizeDtype</span><span class="o">.</span><span class="n">QUANTIZE_DTYPE_INT8</span>
    <span class="n">INT16</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">QuantizeDtype</span><span class="o">.</span><span class="n">QUANTIZE_DTYPE_INT16</span>
    <span class="n">INT4</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">QuantizeDtype</span><span class="o">.</span><span class="n">QUANTIZE_DTYPE_INT4</span>


<span class="c1"># We do not support</span>
<span class="c1"># api_pb.ModelType.MODEL_TYPE_DEPRECATED_UNTRACED_TORCHSCRIPT</span>
<span class="c1"># api_pb.ModelType.MODEL_TYPE_AIMET_PT</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">SourceModelType</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">api_pb</span><span class="o">.</span><span class="n">ModelType</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">-</span> <span class="mi">2</span>

<span class="n">MODEL_TYPES_BY_EXTENSION</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;.bin&quot;</span><span class="p">:</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">QNN_CONTEXT_BINARY</span><span class="p">,</span>
    <span class="s2">&quot;.mlmodel&quot;</span><span class="p">:</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">MLMODEL</span><span class="p">,</span>
    <span class="s2">&quot;.mlmodelc&quot;</span><span class="p">:</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">MLMODELC</span><span class="p">,</span>
    <span class="s2">&quot;.mlpackage&quot;</span><span class="p">:</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">MLPACKAGE</span><span class="p">,</span>
    <span class="s2">&quot;.onnx&quot;</span><span class="p">:</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">ONNX</span><span class="p">,</span>
    <span class="s2">&quot;.ort&quot;</span><span class="p">:</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">ORT</span><span class="p">,</span>
    <span class="s2">&quot;.pt&quot;</span><span class="p">:</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">TORCHSCRIPT</span><span class="p">,</span>
    <span class="s2">&quot;.pth&quot;</span><span class="p">:</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">TORCHSCRIPT</span><span class="p">,</span>
    <span class="s2">&quot;.tflite&quot;</span><span class="p">:</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">TFLITE</span><span class="p">,</span>
    <span class="s2">&quot;.trtmodel&quot;</span><span class="p">:</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">TETRART</span><span class="p">,</span>
    <span class="s2">&quot;.aimet&quot;</span><span class="p">:</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">AIMET_ONNX</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_validate_precompiled_qnn_onnx_model</span><span class="p">(</span><span class="n">onnx_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">onnx_dir</span><span class="p">)</span>
    <span class="n">onnx_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.onnx&quot;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">onnx_files</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ONNX model must contain exactly one .onnx file: </span><span class="si">{</span><span class="n">onnx_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">context_binary_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.bin&quot;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">context_binary_files</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ONNX model must contain exactly one .bin file: </span><span class="si">{</span><span class="n">onnx_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">context_binary_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="o">!=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">onnx_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;.onnx file and .bin file must have the same name.&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_validate_aimet_model</span><span class="p">(</span><span class="n">aimet_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">aimet_dir</span><span class="p">)</span>
    <span class="n">onnx_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.onnx&quot;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">onnx_files</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AIMET model must contain exactly one .onnx file: </span><span class="si">{</span><span class="n">aimet_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">encoding_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.encodings&quot;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">encoding_files</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;AIMET model must contain exactly one .ecodings file: </span><span class="si">{</span><span class="n">aimet_dir</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_filepath_to_model_type</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SourceModelType</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">suffix</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">MODEL_TYPES_BY_EXTENSION</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="c1"># high level validation for some directory based models</span>
        <span class="k">if</span> <span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;.onxx&quot;</span><span class="p">:</span>
            <span class="n">_validate_precompiled_qnn_onnx_model</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;.aimet&quot;</span><span class="p">:</span>
            <span class="n">_validate_aimet_model</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">MODEL_TYPES_BY_EXTENSION</span><span class="p">[</span><span class="n">suffix</span><span class="p">]</span>


<span class="c1"># Caution: there is some mild fudging going on here:</span>
<span class="c1">#  * We do not associate an extension with UNRECOGNIZED_MODEL_TYPE</span>
<span class="c1">#  * not part of MODEL_TYPES_BY_EXTENSION dict.</span>
<span class="c1">#  * We have two for TORCHSCRIPT</span>
<span class="c1">#  * .so (2x for QNN_LIB) is not a supported source model type in the client.</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">MODEL_TYPES_BY_EXTENSION</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">SourceModelType</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span>

<span class="n">ZIPPABLE_MODEL_TYPES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">SourceModelType</span><span class="o">.</span><span class="n">MLMODELC</span><span class="p">,</span>
    <span class="n">SourceModelType</span><span class="o">.</span><span class="n">MLPACKAGE</span><span class="p">,</span>
    <span class="n">SourceModelType</span><span class="o">.</span><span class="n">TETRART</span><span class="p">,</span>
    <span class="n">SourceModelType</span><span class="o">.</span><span class="n">AIMET_ONNX</span><span class="p">,</span>
    <span class="n">SourceModelType</span><span class="o">.</span><span class="n">ONNX</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">EXTENSIONS_BY_MODEL_TYPE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">MODEL_TYPES_BY_EXTENSION</span><span class="p">[</span><span class="n">ext</span><span class="p">]:</span> <span class="p">(</span>
        <span class="n">ext</span> <span class="o">+</span> <span class="s2">&quot;.zip&quot;</span> <span class="k">if</span> <span class="n">MODEL_TYPES_BY_EXTENSION</span><span class="p">[</span><span class="n">ext</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ZIPPABLE_MODEL_TYPES</span> <span class="k">else</span> <span class="n">ext</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">MODEL_TYPES_BY_EXTENSION</span>
<span class="p">}</span>

<span class="c1"># PyTorch has two extensions. Affirmatively pick one.</span>
<span class="n">EXTENSIONS_BY_MODEL_TYPE</span><span class="p">[</span><span class="n">SourceModelType</span><span class="o">.</span><span class="n">TORCHSCRIPT</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;.pt&quot;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Model</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Neural network model object.</span>

<span class="sd">    A model should not be constructed directly. It is constructed by the hub client</span>
<span class="sd">    through :py:func:`qai_hub.upload_model`, :py:func:`qai_hub.get_model`, or</span>
<span class="sd">    :py:func:`qai_hub.get_models`.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    model_id : str</span>
<span class="sd">        The model ID.</span>
<span class="sd">    date : datetime</span>
<span class="sd">        The time this model was uploaded.</span>
<span class="sd">    model_type : SourceModelType</span>
<span class="sd">        The type of the model.</span>
<span class="sd">    name : str</span>
<span class="sd">        An optional user-provided name to identify the model.</span>
<span class="sd">    metadata : Dict[ModelMetadataKey, str]</span>
<span class="sd">        Model metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">owner</span><span class="p">:</span> <span class="n">Client</span><span class="p">,</span>
        <span class="n">model_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
        <span class="n">model_type</span><span class="p">:</span> <span class="n">SourceModelType</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ModelMetadataKey</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Any instead of SourceModel to keep mypy happy</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">producer</span><span class="p">:</span> <span class="n">Job</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span> <span class="o">=</span> <span class="n">owner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_id</span> <span class="o">=</span> <span class="n">model_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_type</span> <span class="o">=</span> <span class="n">model_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span>  <span class="c1"># access through download</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">producer</span> <span class="o">=</span> <span class="n">producer</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SourceModel</span> <span class="o">|</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Downloads source model either to memory or to file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename:</span>
<span class="sd">            If filename is specified the model is downloaded to file,</span>
<span class="sd">            otherwise to memory.</span>
<span class="sd">            If the filename doesn&#39;t end with the correct file extension,</span>
<span class="sd">            the appropriate file extension is added to the name.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : SourceModel | str</span>
<span class="sd">            If `filename` is `None`, return `SourceModel`. Otherwise return</span>
<span class="sd">            `str`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">download_file</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">UNRECOGNIZED_MODEL_TYPE</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                    <span class="s2">&quot;Model not recognized.&quot;</span>
                    <span class="s2">&quot; Please upgrade qai-hub client to be able to download the model.&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">IS_WINDOWS</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">MLMODEL</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot load .mlmodel into memory on Windows &quot;</span>
                    <span class="s2">&quot;platform. Specify `filename` to download to disk.&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">MLMODELC</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot load .mlmodelc into memory. &quot;</span>
                    <span class="s2">&quot;Please specify a filename to download it to disk without loading it.&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">MLPACKAGE</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot load .mlpackage into memory. &quot;</span>
                    <span class="s2">&quot;Please specify a filename to download it to disk without loading it.&quot;</span>
                <span class="p">)</span>

            <span class="c1"># delete=False to be compatible with Windows</span>
            <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">download_file</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span>
            <span class="c1"># Close the file to avoid double-open on Windows</span>

        <span class="n">download_file</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span>
            <span class="n">api</span><span class="o">.</span><span class="n">download_model</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span>
            <span class="n">file_path</span><span class="o">=</span><span class="n">download_file</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded model to </span><span class="si">{</span><span class="n">download_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">download_file</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">TORCHSCRIPT</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">download_file</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">MLMODEL</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">coremltools</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">coremltools</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">MLModel</span><span class="p">(</span><span class="n">download_file</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">TFLITE</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">download_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">tf_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">ONNX</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">onnx</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">download_file</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">ORT</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">download_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ort_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">ort_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Model type `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">` cannot be loaded into memory. &quot;</span>
                <span class="s2">&quot;Please pass a filename to the download function to save it to disk.&quot;</span>
            <span class="p">)</span>

        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">download_file</span><span class="p">)</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_sharing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the list of email addresses of users that this model has been shared with.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span>
            <span class="n">api</span><span class="o">.</span><span class="n">get_sharing</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span>
            <span class="n">api</span><span class="o">.</span><span class="n">SharedEntityType</span><span class="o">.</span><span class="n">MODEL</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">email</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">disable_sharing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable all sharing for this model.</span>

<span class="sd">        Note that the model will still be accessible by users with which related job(s) are shared.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_api_call</span><span class="p">(</span>
            <span class="n">api</span><span class="o">.</span><span class="n">disable_sharing</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span>
            <span class="n">api</span><span class="o">.</span><span class="n">SharedEntityType</span><span class="o">.</span><span class="n">MODEL</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">modify_sharing</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">add_emails</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">delete_emails</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modifies the list of users that the model is shared with.</span>

<span class="sd">        If this model was compiled by hub, it will have an associated Compile Job.</span>
<span class="sd">        The associated Compile Job will not be visible unless said Compile Job is also shared.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">add_emails</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">delete_emails</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="s2">&quot;Either add_emails or delete_emails must be specified and non-empty&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">add_emails</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">delete_emails</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;add_emails and delete_emails must both be lists&quot;</span><span class="p">)</span>

        <span class="n">_api_call</span><span class="p">(</span>
            <span class="n">api</span><span class="o">.</span><span class="n">modify_sharing</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span>
            <span class="n">api</span><span class="o">.</span><span class="n">SharedEntityType</span><span class="o">.</span><span class="n">MODEL</span><span class="p">,</span>
            <span class="n">add_emails</span><span class="p">,</span>
            <span class="n">delete_emails</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Model(model_id=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_id</span><span class="si">}</span><span class="s2">&#39;, name=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_class_repr_print</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s2">&quot;model_id&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="s2">&quot;model_type&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                <span class="p">(</span>
                    <span class="s2">&quot;producer_id&quot;</span><span class="p">,</span>
                    <span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">producer</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">producer</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="s2">&quot;date&quot;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_determine_model_type</span><span class="p">(</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Model</span> <span class="o">|</span> <span class="n">SourceModel</span> <span class="o">|</span> <span class="n">TargetModel</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SourceModelType</span><span class="p">:</span>
    <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        - TorchScript: Extension .pt or .pth</span>
<span class="s2">        - Tensorflow Lite: Extension .tflite</span>
<span class="s2">        - ONNX: Extension .onnx</span>
<span class="s2">        - ONNX (ORT model format): Extension .ort</span>
<span class="s2">        - QNN Binary: Extension .bin</span>
<span class="s2">        - AIMET Model: Directory ending with .aimet</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">Model</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">model_type</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.zip&quot;</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_determine_model_type</span><span class="p">(</span><span class="n">unzip_model</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">tmp_dir</span><span class="p">))</span>
        <span class="n">model_type</span> <span class="o">=</span> <span class="n">_filepath_to_model_type</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="sa">rf</span><span class="s2">&quot;Unsupported model type for </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">. The following types are supported </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">model_type</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;TopLevelTracedModule&quot;</span><span class="p">,</span> <span class="s2">&quot;RecursiveScriptModule&quot;</span><span class="p">}:</span>
        <span class="k">return</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">TORCHSCRIPT</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;MLModel&quot;</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">coremltools</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">coremltools</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">MLModel</span><span class="p">)</span>

        <span class="c1"># MLModel distinguishes NeuralNetwork and MLPackage format</span>
        <span class="c1"># with following field</span>
        <span class="c1"># https://github.com/apple/coremltools/blob/d52d536a399011933c6faf23d8fa19bcf79c5dca/coremltools/models/model.py#L360</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">is_package</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">MLPACKAGE</span>
        <span class="k">return</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">MLMODEL</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="ow">and</span> <span class="n">model</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;TFL3&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">TFLITE</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;ModelProto&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">ONNX</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="ow">and</span> <span class="n">model</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;ORTM&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">ORT</span>
    <span class="k">elif</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
            <span class="s2">&quot;Model passed in was &#39;None&#39; (make sure this is not the target of a failed compile job)&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">module_name_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_type</span><span class="o">.</span><span class="vm">__module__</span> <span class="k">for</span> <span class="n">model_type</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">mro</span><span class="p">()]</span>
        <span class="k">if</span> <span class="s2">&quot;torch.nn.modules.module&quot;</span> <span class="ow">in</span> <span class="n">module_name_list</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;The torch model must be traced.&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unsupported model type. The following types are supported </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_determine_model_extension</span><span class="p">(</span><span class="nb">type</span><span class="p">:</span> <span class="n">SourceModelType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="n">EXTENSIONS_BY_MODEL_TYPE</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">suffix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">suffix</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported model type: </span><span class="si">{</span><span class="nb">type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="c1">## JOBS ##</span>


<span class="nd">@dataclass</span><span class="p">(</span>
    <span class="n">unsafe_hash</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># ideally would be frozen but that would be backwards-incompatible</span>
<span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">JobStatus</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Status of a job.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    code: str</span>
<span class="sd">        Status code for the job as a string such as &quot;SUCCESS&quot; or &quot;OPTIMIZING_MODEL&quot;.</span>
<span class="sd">        See :py:class:`JobStatus.State` for a list of possible states.</span>
<span class="sd">    message: str</span>
<span class="sd">        Optional error message.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">State</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
        <span class="n">SUCCESS</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">JobState</span><span class="o">.</span><span class="n">JOB_STATE_DONE</span>
        <span class="n">FAILED</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">JobState</span><span class="o">.</span><span class="n">JOB_STATE_FAILED</span>
        <span class="n">CREATED</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">JobState</span><span class="o">.</span><span class="n">JOB_STATE_CREATED</span>
        <span class="n">UNSPECIFIED</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">JobState</span><span class="o">.</span><span class="n">JOB_STATE_UNSPECIFIED</span>
        <span class="n">OPTIMIZING_MODEL</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">JobState</span><span class="o">.</span><span class="n">JOB_STATE_OPTIMIZING_MODEL</span>
        <span class="n">PROVISIONING_DEVICE</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">JobState</span><span class="o">.</span><span class="n">JOB_STATE_PROVISIONING_DEVICE</span>
        <span class="n">MEASURING_PERFORMANCE</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">JobState</span><span class="o">.</span><span class="n">JOB_STATE_MEASURING_PERFORMANCE</span>
        <span class="n">RUNNING_INFERENCE</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">JobState</span><span class="o">.</span><span class="n">JOB_STATE_RUNNING_INFERENCE</span>
        <span class="n">QUANTIZING_MODEL</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">JobState</span><span class="o">.</span><span class="n">JOB_STATE_QUANTIZING_MODEL</span>
        <span class="n">LINKING_MODELS</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">JobState</span><span class="o">.</span><span class="n">JOB_STATE_LINKING_MODELS</span>

        <span class="nd">@classmethod</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_missing_</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">UNSPECIFIED</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_is_terminal_state</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span> <span class="ow">is</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">SUCCESS</span> <span class="ow">or</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">FAILED</span>
            <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
                <span class="bp">self</span> <span class="ow">is</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">CREATED</span>
                <span class="ow">or</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">OPTIMIZING_MODEL</span>
                <span class="ow">or</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">QUANTIZING_MODEL</span>
                <span class="ow">or</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">PROVISIONING_DEVICE</span>
                <span class="ow">or</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">MEASURING_PERFORMANCE</span>
                <span class="ow">or</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">RUNNING_INFERENCE</span>
                <span class="ow">or</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">LINKING_MODELS</span>
                <span class="ow">or</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">UNSPECIFIED</span>
            <span class="p">)</span>
            <span class="n">assert_never</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_is_running_state</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span> <span class="ow">is</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">OPTIMIZING_MODEL</span>
                <span class="ow">or</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">QUANTIZING_MODEL</span>
                <span class="ow">or</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">PROVISIONING_DEVICE</span>
                <span class="ow">or</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">MEASURING_PERFORMANCE</span>
                <span class="ow">or</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">RUNNING_INFERENCE</span>
                <span class="ow">or</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">LINKING_MODELS</span>
                <span class="ow">or</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">UNSPECIFIED</span>
            <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
                <span class="bp">self</span> <span class="ow">is</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">SUCCESS</span>
                <span class="ow">or</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">FAILED</span>
                <span class="ow">or</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">CREATED</span>
            <span class="p">)</span>
            <span class="n">assert_never</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">all_running_states</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : List[JobStatus.State]</span>
<span class="sd">        returns a list of all states in which jobs are running (not finished or pending)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">state</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span> <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">_is_running_state</span><span class="p">()]</span>

    <span class="n">_len_largest_state</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">enum_val</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">enum_val</span> <span class="ow">in</span> <span class="n">State</span><span class="p">])</span>

    <span class="n">state</span><span class="p">:</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span>
    <span class="n">message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">code</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">failure</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">UNSPECIFIED</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">success</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns whether a job finished succesfully.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : bool</span>
<span class="sd">            returns true if the job finished succesfully.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">SUCCESS</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">failure</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns whether a job failed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : bool</span>
<span class="sd">            returns true if the job failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">FAILED</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">finished</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns whether a job finished.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : bool</span>
<span class="sd">            returns true if the job finished.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">_is_terminal_state</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">running</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns whether a job is still running.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : bool</span>
<span class="sd">            returns true if the job is still running.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">_is_running_state</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pending</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns whether a job is waiting to start running.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : bool</span>
<span class="sd">            returns true if the job is waiting to start.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">CREATED</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">obj</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">obj</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">obj</span><span class="o">.</span><span class="n">state</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">==</span> <span class="n">obj</span><span class="o">.</span><span class="n">message</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_class_repr_print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">])</span>


<span class="k">class</span><span class="w"> </span><span class="nc">JobType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The type of a job (compile, profile, etc.)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">COMPILE</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">JobType</span><span class="o">.</span><span class="n">JOB_TYPE_COMPILE</span>
    <span class="n">PROFILE</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">JobType</span><span class="o">.</span><span class="n">JOB_TYPE_PROFILE</span>
    <span class="n">INFERENCE</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">JobType</span><span class="o">.</span><span class="n">JOB_TYPE_INFERENCE</span>
    <span class="n">QUANTIZE</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">JobType</span><span class="o">.</span><span class="n">JOB_TYPE_QUANTIZE</span>
    <span class="n">LINK</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">JobType</span><span class="o">.</span><span class="n">JOB_TYPE_LINK</span>
    <span class="n">UNSPECIFIED</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">JobType</span><span class="o">.</span><span class="n">JOB_TYPE_UNSPECIFIED</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_missing_</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">JobType</span><span class="o">.</span><span class="n">UNSPECIFIED</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">JobResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Job result structure.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    status : JobStatus</span>
<span class="sd">        Status of the job.</span>
<span class="sd">    url: str</span>
<span class="sd">        The url for the job.</span>
<span class="sd">    artifacts_dir:str</span>
<span class="sd">        Directory where the results are stored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">status</span><span class="p">:</span> <span class="n">JobStatus</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="n">artifacts_dir</span><span class="p">:</span> <span class="nb">str</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CompileJobResult</span><span class="p">(</span><span class="n">JobResult</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compile Job result structure.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Fetch a job result::</span>

<span class="sd">        import qai_hub as hub</span>
<span class="sd">        job = hub.get_job(&quot;jabc123&quot;)</span>
<span class="sd">        job_result = job.download_results(&quot;artifacts&quot;)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># Successful job</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_class_repr_print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;artifacts_dir&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Failed job</span>
            <span class="k">return</span> <span class="n">_class_repr_print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">])</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">QuantizeJobResult</span><span class="p">(</span><span class="n">JobResult</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quantize Job result structure.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Fetch a job result::</span>

<span class="sd">        import qai_hub as hub</span>
<span class="sd">        job = hub.get_job(&quot;jabc123&quot;)</span>
<span class="sd">        job_result = job.download_results(&quot;artifacts&quot;)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_class_repr_print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">])</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LinkJobResult</span><span class="p">(</span><span class="n">JobResult</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Link Job result structure.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Fetch a job result::</span>

<span class="sd">        import qai_hub as hub</span>
<span class="sd">        job = hub.get_job(&quot;jabc123&quot;)</span>
<span class="sd">        job_result = job.download_results(&quot;artifacts&quot;)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># Successful job</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_class_repr_print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;artifacts_dir&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Failed job</span>
            <span class="k">return</span> <span class="n">_class_repr_print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">])</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">InferenceJobResult</span><span class="p">(</span><span class="n">JobResult</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inference Job result structure.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Fetch a job result::</span>

<span class="sd">        import qai_hub as hub</span>
<span class="sd">        job = hub.get_job(&quot;jabc123&quot;)</span>
<span class="sd">        job_result = job.download_results(&quot;artifacts&quot;)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># Successful job</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_class_repr_print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;artifacts_dir&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Failed job</span>
            <span class="k">return</span> <span class="n">_class_repr_print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">])</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ProfileJobResult</span><span class="p">(</span><span class="n">JobResult</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Profile Job result structure.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    profile : Dict</span>
<span class="sd">        The profile result as a python dictionary for a successful job.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Fetch a job result::</span>

<span class="sd">        import qai_hub as hub</span>
<span class="sd">        job = hub.get_job(&quot;jabc123&quot;)</span>

<span class="sd">    Print the profiling results as a dictionary structure::</span>

<span class="sd">        profile = job.download_profile()</span>

<span class="sd">    Print the model runtime latency in milliseconds::</span>

<span class="sd">        latency_ms = profile[&quot;execution_summary&quot;][&quot;estimated_inference_time&quot;] / 1000</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">profile</span><span class="p">:</span> <span class="n">Dict</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_unit_breakdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="n">breakdown</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">NPU</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">GPU</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">CPU</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">layer_detail</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[</span><span class="s2">&quot;execution_detail&quot;</span><span class="p">]:</span>
            <span class="n">breakdown</span><span class="p">[</span><span class="n">layer_detail</span><span class="p">[</span><span class="s2">&quot;compute_unit&quot;</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">breakdown</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># Successful job</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="n">profile_sum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[</span><span class="s2">&quot;execution_summary&quot;</span><span class="p">]</span>
            <span class="n">breakdown</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_unit_breakdown</span>
            <span class="n">breakdown_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">breakdown</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">_class_repr_print</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="p">[</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;url&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;artifacts_dir&quot;</span><span class="p">,</span>
                    <span class="p">(</span>
                        <span class="s2">&quot;Estimated Inference Time (ms)&quot;</span><span class="p">,</span>
                        <span class="n">profile_sum</span><span class="p">[</span><span class="s2">&quot;estimated_inference_time&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;Load Time (ms)&quot;</span><span class="p">,</span> <span class="n">profile_sum</span><span class="p">[</span><span class="s2">&quot;warm_load_time&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">),</span>
                    <span class="p">(</span>
                        <span class="s2">&quot;Peak Memory (MB)&quot;</span><span class="p">,</span>
                        <span class="n">profile_sum</span><span class="p">[</span><span class="s2">&quot;estimated_inference_peak_memory&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;Compute Units (layers)&quot;</span><span class="p">,</span> <span class="n">breakdown_str</span><span class="p">),</span>
                <span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Failed job</span>
            <span class="k">return</span> <span class="n">_class_repr_print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">])</span>


<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">JobSummary</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Summary information about a job and its current status. Job summaries can be queried</span>
<span class="sd">    in bulk for many jobs at a time through :py:func:`qai_hub.get_job_summaries`.</span>

<span class="sd">    A job summary should not be constructed directly.</span>

<span class="sd">    See also :py:class:`CompileJobSummary`, :py:class:`ProfileJobSummary`, :py:class:`InferenceJobSummary`, :py:class:`QuantizeJobSummary`</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    job_id : str</span>
<span class="sd">        The job ID.</span>
<span class="sd">    name : str</span>
<span class="sd">        Name of this job.</span>
<span class="sd">    date : datetime</span>
<span class="sd">        The time this job was submitted.</span>
<span class="sd">    username : str</span>
<span class="sd">        Username of the user who submitted the job.</span>
<span class="sd">    status: JobStatus</span>
<span class="sd">        Status of the job.</span>
<span class="sd">    url: str</span>
<span class="sd">        Returns the URL for the job.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">date</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">username</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">JobStatus</span>
    <span class="n">job_type</span><span class="p">:</span> <span class="n">JobType</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span>

    <span class="c1"># Documented in subclasses because &#39;device&#39; means a different thing in each</span>
    <span class="n">device_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Job(job_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="si">}</span><span class="s2">, device=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_name</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;job_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;url&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;date&quot;</span><span class="p">,</span>
            <span class="s2">&quot;username&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">code</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;device_name&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_class_repr_print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>


<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CompileJobSummary</span><span class="p">(</span><span class="n">JobSummary</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Summary information about a compile job and its current status. Job summaries can be queried</span>
<span class="sd">    in bulk for many jobs at a time through :py:func:`qai_hub.get_job_summaries`.</span>

<span class="sd">    A compile job summary should not be constructed directly.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    job_id : str</span>
<span class="sd">        The job ID.</span>
<span class="sd">    name : str</span>
<span class="sd">        Name of this job.</span>
<span class="sd">    date : datetime</span>
<span class="sd">        The time this job was submitted.</span>
<span class="sd">    username : str</span>
<span class="sd">        Username of the user who submitted the job.</span>
<span class="sd">    status: JobStatus</span>
<span class="sd">        Status of the job.</span>
<span class="sd">    device_name : str</span>
<span class="sd">        The name of the device compiled for.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_summary_from_pb</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">owner</span><span class="p">:</span> <span class="n">Client</span><span class="p">,</span>
        <span class="n">compile_job_pb</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">CompileJobSummary</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">JobStatus</span><span class="p">(</span>
            <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="p">(</span><span class="n">compile_job_pb</span><span class="o">.</span><span class="n">job_state</span><span class="p">)</span>
        <span class="p">)</span>  <span class="c1"># note: no failure reason</span>
        <span class="k">return</span> <span class="n">CompileJobSummary</span><span class="p">(</span>
            <span class="n">job_id</span><span class="o">=</span><span class="n">compile_job_pb</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">compile_job_pb</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">date</span><span class="o">=</span><span class="n">owner</span><span class="o">.</span><span class="n">_creation_date_from_timestamp</span><span class="p">(</span><span class="n">compile_job_pb</span><span class="p">),</span>
            <span class="n">username</span><span class="o">=</span><span class="n">compile_job_pb</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
            <span class="n">job_type</span><span class="o">=</span><span class="n">JobType</span><span class="o">.</span><span class="n">COMPILE</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">owner</span><span class="o">.</span><span class="n">_web_url_of_job</span><span class="p">(</span><span class="n">compile_job_pb</span><span class="o">.</span><span class="n">job_id</span><span class="p">),</span>
            <span class="n">device_name</span><span class="o">=</span><span class="n">compile_job_pb</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span>
        <span class="p">)</span>


<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">QuantizeJobSummary</span><span class="p">(</span><span class="n">JobSummary</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Summary information about a quantize job and its current status. Job summaries can be queried</span>
<span class="sd">    in bulk for many jobs at a time through :py:func:`qai_hub.get_job_summaries`.</span>

<span class="sd">    A quantize job summary should not be constructed directly.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    job_id : str</span>
<span class="sd">        The job ID.</span>
<span class="sd">    name : str</span>
<span class="sd">        Name of this job.</span>
<span class="sd">    date : datetime</span>
<span class="sd">        The time this job was submitted.</span>
<span class="sd">    username : str</span>
<span class="sd">        Username of the user who submitted the job.</span>
<span class="sd">    status: JobStatus</span>
<span class="sd">        Status of the job.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_summary_from_pb</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">owner</span><span class="p">:</span> <span class="n">Client</span><span class="p">,</span>
        <span class="n">quantize_job_pb</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">QuantizeJobSummary</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">JobStatus</span><span class="p">(</span>
            <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="p">(</span><span class="n">quantize_job_pb</span><span class="o">.</span><span class="n">job_state</span><span class="p">)</span>
        <span class="p">)</span>  <span class="c1"># note: no failure reason</span>
        <span class="k">return</span> <span class="n">QuantizeJobSummary</span><span class="p">(</span>
            <span class="n">job_id</span><span class="o">=</span><span class="n">quantize_job_pb</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">quantize_job_pb</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">date</span><span class="o">=</span><span class="n">owner</span><span class="o">.</span><span class="n">_creation_date_from_timestamp</span><span class="p">(</span><span class="n">quantize_job_pb</span><span class="p">),</span>
            <span class="n">username</span><span class="o">=</span><span class="n">quantize_job_pb</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
            <span class="n">job_type</span><span class="o">=</span><span class="n">JobType</span><span class="o">.</span><span class="n">QUANTIZE</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">owner</span><span class="o">.</span><span class="n">_web_url_of_job</span><span class="p">(</span><span class="n">quantize_job_pb</span><span class="o">.</span><span class="n">job_id</span><span class="p">),</span>
            <span class="n">device_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">LinkJobSummary</span><span class="p">(</span><span class="n">JobSummary</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Summary information about a link job and its current status. Job summaries can be queried</span>
<span class="sd">    in bulk for many jobs at a time through :py:func:`qai_hub.get_job_summaries`.</span>

<span class="sd">    A link job summary should not be constructed directly.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    job_id : str</span>
<span class="sd">        The job ID.</span>
<span class="sd">    name : str</span>
<span class="sd">        Name of this job.</span>
<span class="sd">    date : datetime</span>
<span class="sd">        The time this job was submitted.</span>
<span class="sd">    username : str</span>
<span class="sd">        Username of the user who submitted the job.</span>
<span class="sd">    status: JobStatus</span>
<span class="sd">        Status of the job.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_summary_from_pb</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">owner</span><span class="p">:</span> <span class="n">Client</span><span class="p">,</span>
        <span class="n">link_job_pb</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">LinkJobSummary</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">JobStatus</span><span class="p">(</span>
            <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="p">(</span><span class="n">link_job_pb</span><span class="o">.</span><span class="n">job_state</span><span class="p">)</span>
        <span class="p">)</span>  <span class="c1"># note: no failure reason</span>
        <span class="k">return</span> <span class="n">LinkJobSummary</span><span class="p">(</span>
            <span class="n">job_id</span><span class="o">=</span><span class="n">link_job_pb</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">link_job_pb</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">date</span><span class="o">=</span><span class="n">owner</span><span class="o">.</span><span class="n">_creation_date_from_timestamp</span><span class="p">(</span><span class="n">link_job_pb</span><span class="p">),</span>
            <span class="n">username</span><span class="o">=</span><span class="n">link_job_pb</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
            <span class="n">job_type</span><span class="o">=</span><span class="n">JobType</span><span class="o">.</span><span class="n">LINK</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">owner</span><span class="o">.</span><span class="n">_web_url_of_job</span><span class="p">(</span><span class="n">link_job_pb</span><span class="o">.</span><span class="n">job_id</span><span class="p">),</span>
            <span class="n">device_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>


<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ProfileJobSummary</span><span class="p">(</span><span class="n">JobSummary</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Summary information about a profile job and its current status. Job summaries can be queried</span>
<span class="sd">    in bulk for many jobs at a time through :py:func:`qai_hub.get_job_summaries`.</span>

<span class="sd">    A profile job summary should not be constructed directly.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    job_id : str</span>
<span class="sd">        The job ID.</span>
<span class="sd">    name : str</span>
<span class="sd">        Name of this job.</span>
<span class="sd">    date : datetime</span>
<span class="sd">        The time this job was submitted.</span>
<span class="sd">    username : str</span>
<span class="sd">        Username of the user who submitted the job.</span>
<span class="sd">    status: JobStatus</span>
<span class="sd">        Status of the job.</span>
<span class="sd">    device_name : str</span>
<span class="sd">        The name of the device on which the model is being profiled.</span>
<span class="sd">    estimated_inference_time: int</span>
<span class="sd">        Time spent in inference, in microseconds.</span>
<span class="sd">    inference_memory_peak_range: (int, int)</span>
<span class="sd">        Estimated lower and upper bound of peak memory used in inference, in bytes</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">estimated_inference_time</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">inference_memory_peak_range</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_summary_from_pb</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">owner</span><span class="p">:</span> <span class="n">Client</span><span class="p">,</span>
        <span class="n">profile_job_pb</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ProfileJobSummary</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">JobStatus</span><span class="p">(</span><span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="p">(</span><span class="n">profile_job_pb</span><span class="o">.</span><span class="n">job_state</span><span class="p">))</span>
        <span class="n">inference_memory_peak_range</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">profile_job_pb</span><span class="o">.</span><span class="n">execution_peak_memory</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span>
            <span class="n">profile_job_pb</span><span class="o">.</span><span class="n">execution_peak_memory</span><span class="o">.</span><span class="n">upper</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">ProfileJobSummary</span><span class="p">(</span>
            <span class="n">job_id</span><span class="o">=</span><span class="n">profile_job_pb</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">profile_job_pb</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">date</span><span class="o">=</span><span class="n">owner</span><span class="o">.</span><span class="n">_creation_date_from_timestamp</span><span class="p">(</span><span class="n">profile_job_pb</span><span class="p">),</span>
            <span class="n">username</span><span class="o">=</span><span class="n">profile_job_pb</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
            <span class="n">job_type</span><span class="o">=</span><span class="n">JobType</span><span class="o">.</span><span class="n">PROFILE</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">owner</span><span class="o">.</span><span class="n">_web_url_of_job</span><span class="p">(</span><span class="n">profile_job_pb</span><span class="o">.</span><span class="n">job_id</span><span class="p">),</span>
            <span class="n">device_name</span><span class="o">=</span><span class="n">profile_job_pb</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span>
            <span class="n">estimated_inference_time</span><span class="o">=</span><span class="n">profile_job_pb</span><span class="o">.</span><span class="n">execution_time</span><span class="p">,</span>
            <span class="n">inference_memory_peak_range</span><span class="o">=</span><span class="n">inference_memory_peak_range</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_class_repr_print</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s2">&quot;job_id&quot;</span><span class="p">,</span>
                <span class="s2">&quot;url&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                <span class="s2">&quot;date&quot;</span><span class="p">,</span>
                <span class="s2">&quot;username&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">code</span><span class="p">),</span>
                <span class="s2">&quot;device_name&quot;</span><span class="p">,</span>
                <span class="s2">&quot;estimated_inference_time&quot;</span><span class="p">,</span>
                <span class="s2">&quot;inference_memory_peak_range&quot;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>


<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">InferenceJobSummary</span><span class="p">(</span><span class="n">JobSummary</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Summary information about an inference job and its current status. Job summaries can be queried</span>
<span class="sd">    in bulk for many jobs at a time through :py:func:`qai_hub.get_job_summaries`.</span>

<span class="sd">    An inference job summary should not be constructed directly.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    job_id : str</span>
<span class="sd">        The job ID.</span>
<span class="sd">    name : str</span>
<span class="sd">        Name of this job.</span>
<span class="sd">    date : datetime</span>
<span class="sd">        The time this job was submitted.</span>
<span class="sd">    username : str</span>
<span class="sd">        Username of the user who submitted the job.</span>
<span class="sd">    status: JobStatus</span>
<span class="sd">        Status of the job.</span>
<span class="sd">    device_name : str</span>
<span class="sd">        The name of the device on which inference is being performed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_summary_from_pb</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">owner</span><span class="p">:</span> <span class="n">Client</span><span class="p">,</span>
        <span class="n">inference_job_pb</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">InferenceJobSummary</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">JobStatus</span><span class="p">(</span><span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="p">(</span><span class="n">inference_job_pb</span><span class="o">.</span><span class="n">job_state</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">InferenceJobSummary</span><span class="p">(</span>
            <span class="n">job_id</span><span class="o">=</span><span class="n">inference_job_pb</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">inference_job_pb</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">date</span><span class="o">=</span><span class="n">owner</span><span class="o">.</span><span class="n">_creation_date_from_timestamp</span><span class="p">(</span><span class="n">inference_job_pb</span><span class="p">),</span>
            <span class="n">username</span><span class="o">=</span><span class="n">inference_job_pb</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
            <span class="n">job_type</span><span class="o">=</span><span class="n">JobType</span><span class="o">.</span><span class="n">INFERENCE</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">owner</span><span class="o">.</span><span class="n">_web_url_of_job</span><span class="p">(</span><span class="n">inference_job_pb</span><span class="o">.</span><span class="n">job_id</span><span class="p">),</span>
            <span class="n">device_name</span><span class="o">=</span><span class="n">inference_job_pb</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span>
        <span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Job</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    abstract Job base class.</span>

<span class="sd">    A job should not be constructed directly. It is constructed by the hub client</span>
<span class="sd">    through :py:func:`qai_hub.submit_compile_job`, :py:func:`qai_hub.submit_profile_job`,</span>
<span class="sd">    :py:func:`qai_hub.submit_inference_job`, or :py:func:`qai_hub.get_job`.</span>

<span class="sd">    See also :py:class:`CompileJob`, :py:class:`ProfileJob`, :py:class:`InferenceJob`</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    job_id : str</span>
<span class="sd">        The job ID.</span>
<span class="sd">    name : str</span>
<span class="sd">        Name of this job</span>
<span class="sd">    date : datetime</span>
<span class="sd">        The time this job was submitted.</span>
<span class="sd">    options: str</span>
<span class="sd">        Options passed during the job submission.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_polling_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">owner</span><span class="p">:</span> <span class="n">Client</span><span class="p">,</span>
        <span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
        <span class="n">hub_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">job_type</span><span class="p">:</span> <span class="n">JobType</span><span class="p">,</span>
        <span class="n">in_progress_states</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span> <span class="o">=</span> <span class="n">owner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_job_type</span> <span class="o">=</span> <span class="n">job_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span> <span class="o">=</span> <span class="n">job_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hub_version</span> <span class="o">=</span> <span class="n">hub_version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_in_progress_states</span> <span class="o">=</span> <span class="n">in_progress_states</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the URL for the job.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : str</span>
<span class="sd">            The URL for the job.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">_web_url_of_job</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">job_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job_type</span><span class="o">.</span><span class="n">display_name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JobStatus</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Block until this job finishes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        timeout:</span>
<span class="sd">            If provided, a TimeoutError will be raised after waiting this many seconds.</span>

<span class="sd">            If `None`, this client will not time out the job, meaning it will block</span>
<span class="sd">            an indefinite amount of time waiting for the job to finish.</span>

<span class="sd">            HOWEVER, Qualcomm AI Hub will fail / time out any job a set amount of time</span>
<span class="sd">            after its creation. Therefore, even if `timeout` is `None`, the</span>
<span class="sd">            runtime of this method will still have a finite upper bound.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : str</span>
<span class="sd">            The final, &quot;finished&quot; (SUCCESS or FAILED) status for this job.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TimeoutError</span>
<span class="sd">            Raised only if a **client-side** timeout occurs, when param &quot;timeout&quot; != None.</span>

<span class="sd">            If the Qualcomm AI Hub server times out the job, this error will NOT be raised, and a</span>
<span class="sd">            FAILED job status will be returned instead.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">status_text</span><span class="p">(</span><span class="n">job_status</span><span class="p">:</span> <span class="n">JobStatus</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Generates status text:</span>
<span class="sd">            [Status Symbol] [Status Name] [Progress Bar] [Progress Counter]</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># Make sure we always output a string of the same size</span>
            <span class="c1"># by padding smaller status codes with spaces.</span>
            <span class="n">status_code</span> <span class="o">=</span> <span class="n">job_status</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">JobStatus</span><span class="o">.</span><span class="n">_len_largest_state</span><span class="p">)</span>

            <span class="n">progress_bar</span><span class="p">:</span> <span class="nb">str</span>
            <span class="n">progress_count</span><span class="p">:</span> <span class="nb">str</span>
            <span class="k">if</span> <span class="n">job_status</span><span class="o">.</span><span class="n">finished</span><span class="p">:</span>
                <span class="c1"># Don&#39;t show progress bar when we finish.</span>
                <span class="c1"># Pad with empty spaces to make sure we always</span>
                <span class="c1"># output the same string length.</span>
                <span class="n">progress_count</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">progress_bar</span> <span class="o">=</span> <span class="n">progress_count</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Determine number of done states to generate progress bar &amp; count.</span>
                <span class="n">total_states</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_in_progress_states</span><span class="p">)</span>
                <span class="n">done_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_progress_states</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">job_status</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>

                <span class="n">progress_count</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">done_states</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">total_states</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">progress_bar</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">done_states</span><span class="si">}{</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">total_states</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">done_states</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="c1"># Construct and return the status string.</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">status</span><span class="o">.</span><span class="n">symbol</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">status_code</span><span class="si">}{</span><span class="n">status</span><span class="o">.</span><span class="n">message</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">progress_bar</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">progress_count</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">get_in_progress_dots</span><span class="p">(</span><span class="n">num_dots</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Generates a string of length 3 that contains num_dots periods.&quot;&quot;&quot;</span>
            <span class="n">num_dots</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">num_dots</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="k">else</span> <span class="n">num_dots</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">num_dots</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="o">*</span> <span class="n">num_dots</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">-</span> <span class="n">num_dots</span><span class="p">))</span>

        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">running</span> <span class="ow">or</span> <span class="n">status</span><span class="o">.</span><span class="n">pending</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Waiting for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_type</span><span class="si">}</span><span class="s2"> job (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="si">}</span><span class="s2">) completion. Type Ctrl+C to stop waiting at any time.&quot;</span>
                <span class="p">)</span>

            <span class="n">num_dots</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">time_elapsed</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">sleep_seconds</span> <span class="o">=</span> <span class="n">Job</span><span class="o">.</span><span class="n">_polling_interval</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="k">else</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">status</span><span class="o">.</span><span class="n">running</span> <span class="ow">or</span> <span class="n">status</span><span class="o">.</span><span class="n">pending</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="n">num_dots</span><span class="p">,</span> <span class="n">dots_str</span> <span class="o">=</span> <span class="n">get_in_progress_dots</span><span class="p">(</span><span class="n">num_dots</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">status_text</span><span class="p">(</span><span class="n">status</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">dots_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">timeout</span> <span class="ow">and</span> <span class="n">time_elapsed</span> <span class="o">&gt;=</span> <span class="n">timeout</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TimeoutError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Waiting for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_type</span><span class="si">}</span><span class="s2"> job (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="si">}</span><span class="s2">) completion timed out after </span><span class="si">{</span><span class="n">time_elapsed</span><span class="si">}</span><span class="s2"> seconds.&quot;</span>
                    <span class="p">)</span>

                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep_seconds</span><span class="p">)</span>
                <span class="n">time_elapsed</span> <span class="o">+=</span> <span class="n">sleep_seconds</span>

                <span class="k">if</span> <span class="n">time_elapsed</span> <span class="o">%</span> <span class="n">Job</span><span class="o">.</span><span class="n">_polling_interval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">status_text</span><span class="p">(</span><span class="n">status</span><span class="p">)</span><span class="si">}</span><span class="s2">    &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\a\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_state_and_failure_reason</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">job_pb</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Job</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">api_pb</span><span class="o">.</span><span class="n">JobState</span><span class="o">.</span><span class="n">ValueType</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract state and failure reason from job_pb.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JobStatus</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the status of a job.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : JobStatus</span>
<span class="sd">            The status of the job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">job_pb</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">get_job</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
        <span class="n">state</span><span class="p">,</span> <span class="n">failure_reason</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_state_and_failure_reason</span><span class="p">(</span><span class="n">job_pb</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">JobStatus</span><span class="p">(</span><span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="p">(</span><span class="n">state</span><span class="p">),</span> <span class="n">failure_reason</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the name of a job to the specified value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_api_call</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">set_job_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">job_name</span><span class="p">)</span>
        <span class="c1"># Any failure during the API call would throw an exception.</span>
        <span class="c1"># so, if execution reaches the next line, it&#39;s safe to assume that the</span>
        <span class="c1"># job name has been updated on Hub.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">job_name</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">download_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">artifacts_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JobResult</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_sharing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the list of email addresses of users that this job has been shared with.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span>
            <span class="n">api</span><span class="o">.</span><span class="n">get_sharing</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">api</span><span class="o">.</span><span class="n">SharedEntityType</span><span class="o">.</span><span class="n">JOB</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">email</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">disable_sharing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable all sharing for this job.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_api_call</span><span class="p">(</span>
            <span class="n">api</span><span class="o">.</span><span class="n">disable_sharing</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span>
            <span class="n">api</span><span class="o">.</span><span class="n">SharedEntityType</span><span class="o">.</span><span class="n">JOB</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">modify_sharing</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">add_emails</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">delete_emails</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modifies the list of users that the job is shared with.</span>

<span class="sd">        All assets (models, datasets, artifacts, etc.) associated with the job will also be shared.</span>
<span class="sd">        For inference and profile jobs, the corresponding compile and link jobs (if any) will also be shared.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">add_emails</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">delete_emails</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="s2">&quot;Either add_emails or delete_emails must be specified and non-empty&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">add_emails</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">delete_emails</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;add_emails and delete_emails must both be lists&quot;</span><span class="p">)</span>

        <span class="n">_api_call</span><span class="p">(</span>
            <span class="n">api</span><span class="o">.</span><span class="n">modify_sharing</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span>
            <span class="n">api</span><span class="o">.</span><span class="n">SharedEntityType</span><span class="o">.</span><span class="n">JOB</span><span class="p">,</span>
            <span class="n">add_emails</span><span class="p">,</span>
            <span class="n">delete_emails</span><span class="p">,</span>
        <span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">CompileJob</span><span class="p">(</span><span class="n">Job</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compile job for a model, a set of input specs, and a set of device.</span>

<span class="sd">    A compile job should not be constructed directly. It is constructed by the hub client</span>
<span class="sd">    through :py:func:`qai_hub.submit_compile_job`, or :py:func:`qai_hub.get_job`.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    device : Device</span>
<span class="sd">        The device compiled for.</span>
<span class="sd">    compatible_devices : List[Device]</span>
<span class="sd">        The devices compiled for in case of single compile.</span>
<span class="sd">    model : Model</span>
<span class="sd">        The model for the job.</span>
<span class="sd">    date : datetime</span>
<span class="sd">        The time this job was submitted.</span>
<span class="sd">    shapes : InputSpecs</span>
<span class="sd">        The input specs for the model to be compiled.</span>
<span class="sd">    target_shapes : InputSpecs</span>
<span class="sd">        The input specs for the compiled model to run (profile or inference).</span>
<span class="sd">    calibration_dataset : Optional[Dataset]</span>
<span class="sd">        The dataset used with post training quantization run during compilation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_job_type</span> <span class="o">=</span> <span class="n">JobType</span><span class="o">.</span><span class="n">COMPILE</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">job_pb</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Job</span><span class="p">,</span>
        <span class="n">owner</span><span class="p">:</span> <span class="n">Client</span><span class="p">,</span>
        <span class="n">device</span><span class="p">:</span> <span class="n">Device</span><span class="p">,</span>
        <span class="n">compatible_devices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Device</span><span class="p">],</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span>
        <span class="n">date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
        <span class="n">shapes</span><span class="p">:</span> <span class="n">InputSpecs</span><span class="p">,</span>
        <span class="n">target_shapes</span><span class="p">:</span> <span class="n">InputSpecs</span><span class="p">,</span>
        <span class="n">calibration_dataset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dataset</span><span class="p">],</span>
    <span class="p">):</span>
        <span class="n">compile_job_pb</span> <span class="o">=</span> <span class="n">job_pb</span><span class="o">.</span><span class="n">compile_job</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">owner</span><span class="o">=</span><span class="n">owner</span><span class="p">,</span>
            <span class="n">job_id</span><span class="o">=</span><span class="n">compile_job_pb</span><span class="o">.</span><span class="n">compile_job_id</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">compile_job_pb</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span>
            <span class="n">hub_version</span><span class="o">=</span><span class="n">job_pb</span><span class="o">.</span><span class="n">hub_version</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="n">compile_job_pb</span><span class="o">.</span><span class="n">options</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">owner</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">job_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_job_type</span><span class="p">,</span>
            <span class="n">in_progress_states</span><span class="o">=</span><span class="p">[</span>
                <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">CREATED</span><span class="p">,</span>
                <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">OPTIMIZING_MODEL</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span> <span class="o">=</span> <span class="n">shapes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_shapes</span> <span class="o">=</span> <span class="n">target_shapes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_target_model</span> <span class="o">=</span> <span class="n">owner</span><span class="o">.</span><span class="n">_make_target_model</span><span class="p">(</span><span class="n">compile_job_pb</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compatible_devices</span> <span class="o">=</span> <span class="n">compatible_devices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calibration_dataset</span> <span class="o">=</span> <span class="n">calibration_dataset</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_target_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Model</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the target model object.</span>
<span class="sd">        If the job is not ready, this function will block until completion.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : TargetModel | None</span>
<span class="sd">            The target model object, or None if the job failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_model</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download_target_model</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TargetModel</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the downloaded target model, either in memory or as a file.</span>

<span class="sd">        If the job is not ready, this function will block until completion.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename:</span>
<span class="sd">            If filename is specified the target model is downloaded to file, otherwise</span>
<span class="sd">            to memory.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : TargetModel | str | None</span>
<span class="sd">            The downloaded target model, filename, or None if the job failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">target_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_model</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">target_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="c1"># Asserting the return type is correct requires importing coremltools.</span>
        <span class="c1"># Seems like overkill so we&#39;re just going to trust that we didn&#39;t get</span>
        <span class="c1"># a SourceModel that isn&#39;t also a TargetModel.</span>
        <span class="k">return</span> <span class="n">target_model</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">artifacts_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CompileJobResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns all the results of a job.</span>

<span class="sd">        This includes the compiled target model.</span>

<span class="sd">        If the job is not ready, this function will block until completion.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        artifacts_dir:</span>
<span class="sd">            Directory name where the job artifacts are stored.</span>
<span class="sd">            If the directory does not exist, it is cretaed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : CompileJobResult</span>
<span class="sd">            Job results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">artifacts_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">artifacts_dir</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">artifacts_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">download_target_model</span><span class="p">(</span><span class="n">artifacts_dir</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">CompileJobResult</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_status</span><span class="p">(),</span>
            <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
            <span class="n">artifacts_dir</span><span class="o">=</span><span class="n">artifacts_dir</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JobStatus</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">compile_job_pb</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span>
                <span class="n">api</span><span class="o">.</span><span class="n">get_job</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">job_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span>
            <span class="p">)</span><span class="o">.</span><span class="n">compile_job</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_shapes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">api</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">tensor_type_list_pb_to_list_shapes</span><span class="p">(</span>
                    <span class="n">compile_job_pb</span><span class="o">.</span><span class="n">target_tensor_type_list</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_target_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">_make_target_model</span><span class="p">(</span><span class="n">compile_job_pb</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_state_and_failure_reason</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">job_pb</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Job</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">api_pb</span><span class="o">.</span><span class="n">JobState</span><span class="o">.</span><span class="n">ValueType</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">inner_job_pb</span> <span class="o">=</span> <span class="n">job_pb</span><span class="o">.</span><span class="n">compile_job</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">inner_job_pb</span><span class="o">.</span><span class="n">job_state</span><span class="p">,</span> <span class="n">inner_job_pb</span><span class="o">.</span><span class="n">failure_reason</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Job(job_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="si">}</span><span class="s2">, model_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">model_id</span><span class="si">}</span><span class="s2">, device=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_class_repr_print</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s2">&quot;job_id&quot;</span><span class="p">,</span>
                <span class="s2">&quot;url&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span><span class="o">.</span><span class="n">code</span><span class="p">),</span>
                <span class="s2">&quot;model&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                <span class="s2">&quot;options&quot;</span><span class="p">,</span>
                <span class="s2">&quot;shapes&quot;</span><span class="p">,</span>
                <span class="s2">&quot;target_shapes&quot;</span><span class="p">,</span>
                <span class="s2">&quot;device&quot;</span><span class="p">,</span>
                <span class="s2">&quot;compatible_devices&quot;</span><span class="p">,</span>
                <span class="s2">&quot;date&quot;</span><span class="p">,</span>
                <span class="s2">&quot;calibration_dataset&quot;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">QuantizeJob</span><span class="p">(</span><span class="n">Job</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quantize job for a model, a set of input specs, and a set of device.</span>

<span class="sd">    A quantize job should not be constructed directly. It is constructed by the hub client</span>
<span class="sd">    through :py:func:`qai_hub.submit_quantize_job`, :py:func:`qai_hub.get_job`, or</span>
<span class="sd">    :py:func:`qai_hub.get_jobs`.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    model : Model</span>
<span class="sd">        The model for the job.</span>
<span class="sd">    date : datetime</span>
<span class="sd">        The time this job was submitted.</span>
<span class="sd">    shapes : InputSpecs</span>
<span class="sd">        The input specs for the model to be compiled.</span>
<span class="sd">    target_shapes : InputSpecs</span>
<span class="sd">        The input specs for the compiled model to run (profile or inference).</span>
<span class="sd">    calibration_dataset : Optional[Dataset]</span>
<span class="sd">        The dataset used with post training quantization run during compilation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_job_type</span> <span class="o">=</span> <span class="n">JobType</span><span class="o">.</span><span class="n">QUANTIZE</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">job_pb</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Job</span><span class="p">,</span>
        <span class="n">weights_dtype</span><span class="p">:</span> <span class="n">QuantizeDtype</span><span class="p">,</span>
        <span class="n">activations_dtype</span><span class="p">:</span> <span class="n">QuantizeDtype</span><span class="p">,</span>
        <span class="n">owner</span><span class="p">:</span> <span class="n">Client</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span>
        <span class="n">date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
        <span class="n">shapes</span><span class="p">:</span> <span class="n">InputSpecs</span><span class="p">,</span>
        <span class="n">calibration_dataset</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">quantize_job_pb</span> <span class="o">=</span> <span class="n">job_pb</span><span class="o">.</span><span class="n">quantize_job</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">owner</span><span class="o">=</span><span class="n">owner</span><span class="p">,</span>
            <span class="n">job_id</span><span class="o">=</span><span class="n">quantize_job_pb</span><span class="o">.</span><span class="n">quantize_job_id</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">quantize_job_pb</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span>
            <span class="n">hub_version</span><span class="o">=</span><span class="n">job_pb</span><span class="o">.</span><span class="n">hub_version</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="n">quantize_job_pb</span><span class="o">.</span><span class="n">options</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">owner</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">job_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_job_type</span><span class="p">,</span>
            <span class="n">in_progress_states</span><span class="o">=</span><span class="p">[</span>
                <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">CREATED</span><span class="p">,</span>
                <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">QUANTIZING_MODEL</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span> <span class="o">=</span> <span class="n">shapes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_target_model</span> <span class="o">=</span> <span class="n">owner</span><span class="o">.</span><span class="n">_make_target_model</span><span class="p">(</span><span class="n">quantize_job_pb</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calibration_dataset</span> <span class="o">=</span> <span class="n">calibration_dataset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights_dtype</span> <span class="o">=</span> <span class="n">weights_dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activations_dtype</span> <span class="o">=</span> <span class="n">activations_dtype</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_target_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Model</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the target model object.</span>
<span class="sd">        If the job is not ready, this function will block until completion.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : TargetModel | None</span>
<span class="sd">            The target model object, or None if the job failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_model</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download_target_model</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TargetModel</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the downloaded target model, either in memory or as a file.</span>

<span class="sd">        If the job is not ready, this function will block until completion.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename:</span>
<span class="sd">            If filename is specified the target model is downloaded to file, otherwise</span>
<span class="sd">            to memory.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : TargetModel | str | None</span>
<span class="sd">            The downloaded target model, filename, or None if the job failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">target_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_model</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">target_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="c1"># Asserting the return type is correct requires importing coremltools.</span>
        <span class="c1"># Seems like overkill so we&#39;re just going to trust that we didn&#39;t get</span>
        <span class="c1"># a SourceModel that isn&#39;t also a TargetModel.</span>
        <span class="k">return</span> <span class="n">target_model</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">artifacts_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantizeJobResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns all the results of a job.</span>

<span class="sd">        This includes compiled target model.</span>

<span class="sd">        If the job is not ready, this function will block until completion.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : QuantizeJobResult</span>
<span class="sd">            Job results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">artifacts_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">artifacts_dir</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">artifacts_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">download_target_model</span><span class="p">(</span><span class="n">artifacts_dir</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">QuantizeJobResult</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_status</span><span class="p">(),</span>
            <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
            <span class="n">artifacts_dir</span><span class="o">=</span><span class="n">artifacts_dir</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JobStatus</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">quantize_job_pb</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span>
                <span class="n">api</span><span class="o">.</span><span class="n">get_job</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">job_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span>
            <span class="p">)</span><span class="o">.</span><span class="n">quantize_job</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_target_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">_make_target_model</span><span class="p">(</span><span class="n">quantize_job_pb</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_state_and_failure_reason</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">job_pb</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Job</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">api_pb</span><span class="o">.</span><span class="n">JobState</span><span class="o">.</span><span class="n">ValueType</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">inner_job_pb</span> <span class="o">=</span> <span class="n">job_pb</span><span class="o">.</span><span class="n">quantize_job</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">inner_job_pb</span><span class="o">.</span><span class="n">job_state</span><span class="p">,</span> <span class="n">inner_job_pb</span><span class="o">.</span><span class="n">failure_reason</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Job(job_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="si">}</span><span class="s2">, model_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">model_id</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_class_repr_print</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s2">&quot;job_id&quot;</span><span class="p">,</span>
                <span class="s2">&quot;url&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span><span class="o">.</span><span class="n">code</span><span class="p">),</span>
                <span class="s2">&quot;model&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                <span class="s2">&quot;options&quot;</span><span class="p">,</span>
                <span class="s2">&quot;shapes&quot;</span><span class="p">,</span>
                <span class="s2">&quot;date&quot;</span><span class="p">,</span>
                <span class="s2">&quot;calibration_dataset&quot;</span><span class="p">,</span>
                <span class="s2">&quot;weights_dtype&quot;</span><span class="p">,</span>
                <span class="s2">&quot;activations_dtype&quot;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">LinkJob</span><span class="p">(</span><span class="n">Job</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Link job for a collection of models.</span>

<span class="sd">    A link job should not be constructed directly. It is constructed by the hub client</span>
<span class="sd">    through :py:func:`qai_hub.submit_link_job`, or :py:func:`qai_hub.get_job`.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    models : List[Model]</span>
<span class="sd">        The models for the job.</span>
<span class="sd">    date : datetime</span>
<span class="sd">        The time this job was submitted.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__in_progress_states</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">CREATED</span><span class="p">,</span>
        <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">LINKING_MODELS</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">_job_type</span> <span class="o">=</span> <span class="n">JobType</span><span class="o">.</span><span class="n">LINK</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">job_pb</span><span class="p">,</span>
        <span class="n">owner</span><span class="p">:</span> <span class="n">Client</span><span class="p">,</span>
        <span class="n">models</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Model</span><span class="p">],</span>
        <span class="n">date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">link_job_pb</span> <span class="o">=</span> <span class="n">job_pb</span><span class="o">.</span><span class="n">link_job</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">owner</span><span class="o">=</span><span class="n">owner</span><span class="p">,</span>
            <span class="n">job_id</span><span class="o">=</span><span class="n">link_job_pb</span><span class="o">.</span><span class="n">link_job_id</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">link_job_pb</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span>
            <span class="n">hub_version</span><span class="o">=</span><span class="n">job_pb</span><span class="o">.</span><span class="n">hub_version</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="n">link_job_pb</span><span class="o">.</span><span class="n">options</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">owner</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">job_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_job_type</span><span class="p">,</span>
            <span class="n">in_progress_states</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__in_progress_states</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="n">models</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_target_model</span><span class="p">:</span> <span class="n">Model</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">owner</span><span class="o">.</span><span class="n">_make_target_model</span><span class="p">(</span><span class="n">link_job_pb</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JobStatus</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">link_job_pb</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span>
                <span class="n">api</span><span class="o">.</span><span class="n">get_job</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">job_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span>
            <span class="p">)</span><span class="o">.</span><span class="n">link_job</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_target_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">_make_target_model</span><span class="p">(</span><span class="n">link_job_pb</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_state_and_failure_reason</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">job_pb</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Job</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">api_pb</span><span class="o">.</span><span class="n">JobState</span><span class="o">.</span><span class="n">ValueType</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">inner_job_pb</span> <span class="o">=</span> <span class="n">job_pb</span><span class="o">.</span><span class="n">link_job</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">inner_job_pb</span><span class="o">.</span><span class="n">job_state</span><span class="p">,</span> <span class="n">inner_job_pb</span><span class="o">.</span><span class="n">failure_reason</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_target_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Model</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the target model object.</span>
<span class="sd">        If the job is not ready, this function will block until completion.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : TargetModel | None</span>
<span class="sd">            The target model object, or None if the job failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_model</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download_target_model</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TargetModel</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the downloaded target model, either in memory or as a file.</span>

<span class="sd">        If the job is not ready, this function will block until completion.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename:</span>
<span class="sd">            If filename is specified the target model is downloaded to file, otheriwse</span>
<span class="sd">            to memory.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : TargetModel | str | None</span>
<span class="sd">            The downloaded target model, filename, or None if the job failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">target_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_model</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">target_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">target_model</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">artifacts_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LinkJobResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns all the results of a job.</span>

<span class="sd">        This includes the linked target model.</span>

<span class="sd">        If the job is not ready, this function will block until completion.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        artifacts_dir:</span>
<span class="sd">            Directory name where the job artifacts are stored.</span>
<span class="sd">            If the directory does not exist, it is cretaed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : LinkJobResult</span>
<span class="sd">            Job results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">artifacts_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">artifacts_dir</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">artifacts_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">download_target_model</span><span class="p">(</span><span class="n">artifacts_dir</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">LinkJobResult</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_status</span><span class="p">(),</span>
            <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
            <span class="n">artifacts_dir</span><span class="o">=</span><span class="n">artifacts_dir</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Job(job_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="si">}</span><span class="s2">, model_id=</span><span class="si">{</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">model_id</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_class_repr_print</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s2">&quot;job_id&quot;</span><span class="p">,</span>
                <span class="s2">&quot;url&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span><span class="o">.</span><span class="n">code</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;models&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">model_id</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">]),</span>
                <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                <span class="s2">&quot;options&quot;</span><span class="p">,</span>
                <span class="s2">&quot;date&quot;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ProfileJob</span><span class="p">(</span><span class="n">Job</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Profile job for a model, a set of input specs, and a device.</span>

<span class="sd">    A profile job should not be constructed directly. It is constructed by the hub client</span>
<span class="sd">    through :py:func:`qai_hub.submit_profile_job`, or :py:func:`qai_hub.get_job`.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    device : Device</span>
<span class="sd">        The device on which the model is being profiled.</span>
<span class="sd">    model : Model</span>
<span class="sd">        The model for the job.</span>
<span class="sd">    date : datetime</span>
<span class="sd">        The time this job was submitted.</span>
<span class="sd">    shapes : InputSpecs</span>
<span class="sd">        The input specs for the model.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_job_type</span> <span class="o">=</span> <span class="n">JobType</span><span class="o">.</span><span class="n">PROFILE</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">job_pb</span><span class="p">,</span>
        <span class="n">owner</span><span class="p">:</span> <span class="n">Client</span><span class="p">,</span>
        <span class="n">device</span><span class="p">:</span> <span class="n">Device</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span>
        <span class="n">date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
        <span class="n">shapes</span><span class="p">:</span> <span class="n">InputSpecs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">profile_job_pb</span> <span class="o">=</span> <span class="n">job_pb</span><span class="o">.</span><span class="n">profile_job</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">owner</span><span class="o">=</span><span class="n">owner</span><span class="p">,</span>
            <span class="n">job_id</span><span class="o">=</span><span class="n">profile_job_pb</span><span class="o">.</span><span class="n">profile_job_id</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">profile_job_pb</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span>
            <span class="n">hub_version</span><span class="o">=</span><span class="n">job_pb</span><span class="o">.</span><span class="n">hub_version</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="n">profile_job_pb</span><span class="o">.</span><span class="n">options</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">owner</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">job_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_job_type</span><span class="p">,</span>
            <span class="n">in_progress_states</span><span class="o">=</span><span class="p">[</span>
                <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">CREATED</span><span class="p">,</span>
                <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">PROVISIONING_DEVICE</span><span class="p">,</span>
                <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">MEASURING_PERFORMANCE</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="p">:</span> <span class="n">InputSpecs</span> <span class="o">=</span> <span class="n">shapes</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_write_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">profile</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">dst_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the profile json to disk.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dst_path:</span>
<span class="sd">            Dir or filename to save to.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : str</span>
<span class="sd">            The path of the saved profile json.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dst_path</span><span class="p">):</span>
            <span class="c1"># Append a reasonable filename to save to.</span>
            <span class="n">dst_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dst_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="si">}</span><span class="s2">_results.json&quot;</span><span class="p">)</span>
            <span class="c1"># Append suffix if destination file exists.</span>
            <span class="n">dst_path</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_unique_path</span><span class="p">(</span><span class="n">dst_path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">dst_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">):</span>
            <span class="n">dst_path</span> <span class="o">+=</span> <span class="s2">&quot;.json&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dst_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved profile results to </span><span class="si">{</span><span class="n">dst_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dst_path</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span> <span class="o">|</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the downloaded profile, either in memory or as a file.</span>

<span class="sd">        If the job is not ready, this function will block until completion.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename:</span>
<span class="sd">            If filename is specified the profile is downloaded to file, otherwise to memory.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : Dict | str</span>
<span class="sd">            The downloaded profile, or filename</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="n">res_pb</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">get_job_results</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">res_pb</span><span class="o">.</span><span class="n">WhichOneof</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;profile_job_result&quot;</span><span class="p">:</span>
                <span class="n">profile</span> <span class="o">=</span> <span class="n">_profile_pb_to_python_dict</span><span class="p">(</span><span class="n">res_pb</span><span class="o">.</span><span class="n">profile_job_result</span><span class="o">.</span><span class="n">profile</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_profile</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;The supplied job ID is not for a Profile job&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">profile</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">artifacts_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ProfileJobResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns all the results of a job.</span>

<span class="sd">        This includes the profile and the compiled target model.</span>

<span class="sd">        If the job is not ready, this function will block until completion.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        artifacts_dir:</span>
<span class="sd">            Directory name where the job artifacts are stored.</span>
<span class="sd">            If the directory does not exist, it is created.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : ProfileJobResult</span>
<span class="sd">            Job results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">artifacts_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">artifacts_dir</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">artifacts_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_profile</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">Dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_profile</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">artifacts_dir</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ProfileJobResult</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_status</span><span class="p">(),</span>
            <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
            <span class="n">artifacts_dir</span><span class="o">=</span><span class="n">artifacts_dir</span><span class="p">,</span>
            <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JobStatus</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="p">:</span>
            <span class="n">profile_job_pb</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span>
                <span class="n">api</span><span class="o">.</span><span class="n">get_job</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">job_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span>
            <span class="p">)</span><span class="o">.</span><span class="n">profile_job</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">api</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">tensor_type_list_pb_to_list_shapes</span><span class="p">(</span>
                    <span class="n">profile_job_pb</span><span class="o">.</span><span class="n">tensor_type_list</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_state_and_failure_reason</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">job_pb</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Job</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">api_pb</span><span class="o">.</span><span class="n">JobState</span><span class="o">.</span><span class="n">ValueType</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">inner_job_pb</span> <span class="o">=</span> <span class="n">job_pb</span><span class="o">.</span><span class="n">profile_job</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">inner_job_pb</span><span class="o">.</span><span class="n">job_state</span><span class="p">,</span> <span class="n">inner_job_pb</span><span class="o">.</span><span class="n">failure_reason</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Job(job_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="si">}</span><span class="s2">, model_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">model_id</span><span class="si">}</span><span class="s2">, device=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_class_repr_print</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s2">&quot;job_id&quot;</span><span class="p">,</span>
                <span class="s2">&quot;url&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span><span class="o">.</span><span class="n">code</span><span class="p">),</span>
                <span class="s2">&quot;model&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                <span class="s2">&quot;options&quot;</span><span class="p">,</span>
                <span class="s2">&quot;shapes&quot;</span><span class="p">,</span>
                <span class="s2">&quot;device&quot;</span><span class="p">,</span>
                <span class="s2">&quot;date&quot;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">InferenceJob</span><span class="p">(</span><span class="n">Job</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inference job for a model, user provided inputs, and a device.</span>

<span class="sd">    An inference job should not be constructed directly. It is constructed by the hub client</span>
<span class="sd">    through :py:func:`qai_hub.submit_inference_job`, or :py:func:`qai_hub.get_job`.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    device : Device</span>
<span class="sd">        The device for this job.</span>
<span class="sd">    model : Model</span>
<span class="sd">        The model for the job.</span>
<span class="sd">    date : datetime</span>
<span class="sd">        The time this job was submitted.</span>
<span class="sd">    inputs : Dataset</span>
<span class="sd">        The inputs provided by user.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_job_type</span> <span class="o">=</span> <span class="n">JobType</span><span class="o">.</span><span class="n">INFERENCE</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">job_pb</span><span class="p">,</span>
        <span class="n">owner</span><span class="p">:</span> <span class="n">Client</span><span class="p">,</span>
        <span class="n">device</span><span class="p">:</span> <span class="n">Device</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span>
        <span class="n">date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
        <span class="n">inputs</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">inference_job_pb</span> <span class="o">=</span> <span class="n">job_pb</span><span class="o">.</span><span class="n">inference_job</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">owner</span><span class="o">=</span><span class="n">owner</span><span class="p">,</span>
            <span class="n">job_id</span><span class="o">=</span><span class="n">inference_job_pb</span><span class="o">.</span><span class="n">inference_job_id</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">inference_job_pb</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span>
            <span class="n">hub_version</span><span class="o">=</span><span class="n">job_pb</span><span class="o">.</span><span class="n">hub_version</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="n">inference_job_pb</span><span class="o">.</span><span class="n">options</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">owner</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">job_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_job_type</span><span class="p">,</span>
            <span class="n">in_progress_states</span><span class="o">=</span><span class="p">[</span>
                <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">CREATED</span><span class="p">,</span>
                <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">PROVISIONING_DEVICE</span><span class="p">,</span>
                <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">RUNNING_INFERENCE</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span> <span class="n">Dataset</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_output_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dataset</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the output dataset for a job.</span>

<span class="sd">        If the job is not ready, this function will block until completion.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : Dataset | None</span>
<span class="sd">            The output data if the job succeeded</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">get_job_results</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span><span class="o">.</span><span class="n">get_dataset</span><span class="p">(</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">inference_job_result</span><span class="o">.</span><span class="n">output_dataset_id</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download_output_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetEntries</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the downloaded output data, either in memory or as a h5f file.</span>

<span class="sd">        If the job is not ready, this function will block until completion.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename:</span>
<span class="sd">            If filename is specified the output data is downloaded to file, otherwise to memory.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : DatasetEntries | str | None</span>
<span class="sd">            The downloaded output data, filename, or None if the job failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output_dataset</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">dataset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dataset</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">artifacts_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InferenceJobResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns all the results of an inference job.</span>

<span class="sd">        If the job is not ready, this function will block until completion.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        artifacts_dir:</span>
<span class="sd">            Directory name where the job artifacts are stored.</span>
<span class="sd">            If the directory does not exist, it is cretaed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : InferenceJobResult</span>
<span class="sd">            Job results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">artifacts_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">artifacts_dir</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">artifacts_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">download_output_data</span><span class="p">(</span><span class="n">artifacts_dir</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">InferenceJobResult</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_status</span><span class="p">(),</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">artifacts_dir</span><span class="o">=</span><span class="n">artifacts_dir</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_state_and_failure_reason</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">job_pb</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Job</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">api_pb</span><span class="o">.</span><span class="n">JobState</span><span class="o">.</span><span class="n">ValueType</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">inner_job_pb</span> <span class="o">=</span> <span class="n">job_pb</span><span class="o">.</span><span class="n">inference_job</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">inner_job_pb</span><span class="o">.</span><span class="n">job_state</span><span class="p">,</span> <span class="n">inner_job_pb</span><span class="o">.</span><span class="n">failure_reason</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Job(job_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="si">}</span><span class="s2">, model_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">model_id</span><span class="si">}</span><span class="s2">, device=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s2">, inputs=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span><span class="o">.</span><span class="n">failure</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_class_repr_print</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="p">[</span>
                    <span class="s2">&quot;job_id&quot;</span><span class="p">,</span>
                    <span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span><span class="o">.</span><span class="n">code</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;failure_reason&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span><span class="o">.</span><span class="n">message</span><span class="p">),</span>
                    <span class="s2">&quot;model&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;options&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;inputs&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;device&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;date&quot;</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">_class_repr_print</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s2">&quot;job_id&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span><span class="o">.</span><span class="n">code</span><span class="p">),</span>
                <span class="s2">&quot;model&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                <span class="s2">&quot;inputs&quot;</span><span class="p">,</span>
                <span class="s2">&quot;device&quot;</span><span class="p">,</span>
                <span class="s2">&quot;date&quot;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_model_metadata_to_dict</span><span class="p">(</span>
    <span class="n">metadata_pb</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelMetadata</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ModelMetadataKey</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ModelMetadataKey</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metadata_pb</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">enum_key</span> <span class="o">=</span> <span class="n">ModelMetadataKey</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">enum_key</span> <span class="o">!=</span> <span class="n">ModelMetadataKey</span><span class="o">.</span><span class="n">UNSPECIFIED</span><span class="p">:</span>
            <span class="n">metadata</span><span class="p">[</span><span class="n">enum_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">metadata</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Client</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Client object to interact with the Qualcomm AI Hub API.</span>

<span class="sd">    A default client, using credentials from ``~/.qai_hub/client.ini`` can be</span>
<span class="sd">    accessed through the ``qai_hub`` module::</span>

<span class="sd">        import qai_hub as hub</span>

<span class="sd">        # Calls Client.upload_model on a default Client instance.</span>
<span class="sd">        hub.upload_model(&quot;model.pt&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Note: This class is primarily used through a default instantiation</span>
    <span class="c1"># through hub (e.g. import qai_hub as hub; hub.upload_model(...)). For that</span>
    <span class="c1"># reason, all examples and cross references should point to qai_hub for</span>
    <span class="c1"># documentation generation purposes.</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">ClientConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="n">config</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">verbose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">verbose</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ClientConfig</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">load_default_api_config</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to load client configuration file.</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="n">_visible_textbox</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_creation_date_from_timestamp</span><span class="p">(</span>
        <span class="n">pb</span><span class="p">:</span> <span class="p">(</span>
            <span class="n">api_pb</span><span class="o">.</span><span class="n">Dataset</span>
            <span class="o">|</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">CompileJob</span>
            <span class="o">|</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">LinkJob</span>
            <span class="o">|</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ProfileJob</span>
            <span class="o">|</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">InferenceJob</span>
            <span class="o">|</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">QuantizeJob</span>
            <span class="o">|</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">CompileJobSummary</span>
            <span class="o">|</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">QuantizeJobSummary</span>
            <span class="o">|</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">LinkJobSummary</span>
            <span class="o">|</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ProfileJobSummary</span>
            <span class="o">|</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">InferenceJobSummary</span>
            <span class="o">|</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Model</span>
        <span class="p">),</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">creation_time</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_expiration_date_from_timestamp</span><span class="p">(</span><span class="n">pb</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">pb</span><span class="o">.</span><span class="n">permanent</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">pb</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s2">&quot;expiration_time&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">expiration_time</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_web_url_of_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># Final empty &#39;&#39; is to produce a trailing slash (esthetic choice)</span>
        <span class="k">return</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">web_url</span><span class="p">,</span> <span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;jobs&quot;</span><span class="p">,</span> <span class="n">job_id</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_verbose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If true, API calls may print progress to standard output.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        verbose:</span>
<span class="sd">            Verbosity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_devices</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">os</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">attributes</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">select</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Device</span><span class="p">]:</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_validate_interval</span><span class="p">(</span><span class="n">os</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">_is_valid_version</span><span class="p">(</span><span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                This rationalizes the difference between setuptools version 66 and earlier.</span>
<span class="sd">                Version 66 will throw on invalid version numbers. Previous versions do not.</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">valid_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">Version</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">))</span>
                    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">Version</span><span class="p">(</span><span class="n">version</span><span class="p">))</span> <span class="ow">is</span> <span class="n">valid_type</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">os</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;[&quot;</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">_is_valid_version</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                        <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
                            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
                            <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">_is_valid_version</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                        <span class="p">):</span>
                            <span class="k">return</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Incorrectly formed OS interval </span><span class="si">{</span><span class="n">os</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">attributes</span><span class="p">]</span>
        <span class="n">_validate_device_params</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
        <span class="n">_validate_interval</span><span class="p">(</span><span class="n">os</span><span class="p">)</span>
        <span class="n">devices_pb</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span>
            <span class="n">api</span><span class="o">.</span><span class="n">get_device_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">attributes</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">select</span>
        <span class="p">)</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dev</span> <span class="ow">in</span> <span class="n">devices_pb</span><span class="o">.</span><span class="n">devices</span><span class="p">:</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">dev</span><span class="o">.</span><span class="n">attributes</span><span class="p">]</span>
            <span class="n">devices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Device</span><span class="p">(</span><span class="n">dev</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dev</span><span class="o">.</span><span class="n">os</span><span class="p">,</span> <span class="n">attrs</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">devices</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_devices</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">os</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">attributes</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Device</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of available devices.</span>

<span class="sd">        The returned list of devices are compatible with the supplied</span>
<span class="sd">        name, os, and attributes.</span>
<span class="sd">        The name must be an exact match with an existing device and os can either be a</span>
<span class="sd">        version (&quot;15.2&quot;) or a version range (&quot;[14,15)&quot;).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name:</span>
<span class="sd">            Only devices with this exact name will be returned.</span>
<span class="sd">        os:</span>
<span class="sd">            Only devices with an OS version that is compatible with this os are returned</span>
<span class="sd">        attributes:</span>
<span class="sd">            Only devices that have all requested properties are returned.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        device_list : List[Device]</span>
<span class="sd">            List of available devices, comptatible with the supplied filters.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        ::</span>

<span class="sd">            import qai_hub as hub</span>

<span class="sd">            # Get all devices</span>
<span class="sd">            devices = hub.get_devices()</span>

<span class="sd">            # Get all devices matching this operating system</span>
<span class="sd">            devices = hub.get_devices(os=&quot;12&quot;)</span>

<span class="sd">            # Get all devices matching this chipset</span>
<span class="sd">            devices = hub.get_devices(attributes=[&quot;chipset:quantization-snapdragon-8gen2&quot;])</span>

<span class="sd">            # Get all devices matching hardware</span>
<span class="sd">            devices = hub.get_devices(name=&quot;Samsung Galaxy S23&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_devices</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="n">Device</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Device</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_devices</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">device</span><span class="o">.</span><span class="n">os</span><span class="p">,</span> <span class="n">device</span><span class="o">.</span><span class="n">attributes</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">devices</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">devices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">devices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_device_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the super set of available device attributes.</span>

<span class="sd">        Any of these attributes can be used to filter devices when using</span>
<span class="sd">        :py:func:`~qai_hub.get_devices`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        attribute_list : List[str]</span>
<span class="sd">            Super set of all available device attributes.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        ::</span>

<span class="sd">            import qai_hub as hub</span>
<span class="sd">            attributes = hub.get_device_attributes()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_devices</span><span class="p">():</span>
            <span class="n">attrs</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
        <span class="n">attributes</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">attributes</span>

    <span class="c1">## model related members ##</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_make_model</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_pb</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">SourceModel</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">producer</span><span class="p">:</span> <span class="n">Job</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Model</span><span class="p">:</span>
        <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_creation_date_from_timestamp</span><span class="p">(</span><span class="n">model_pb</span><span class="p">)</span>
        <span class="n">model_type</span> <span class="o">=</span> <span class="n">_get_source_model_type_from_model_type</span><span class="p">(</span><span class="n">model_pb</span><span class="o">.</span><span class="n">model_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">producer</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">model_pb</span><span class="o">.</span><span class="n">producer_id</span><span class="p">:</span>
            <span class="n">producer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job</span><span class="p">(</span><span class="n">model_pb</span><span class="o">.</span><span class="n">producer_id</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Model</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">model_pb</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span>
            <span class="n">date</span><span class="p">,</span>
            <span class="n">model_type</span><span class="p">,</span>
            <span class="n">model_pb</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">_model_metadata_to_dict</span><span class="p">(</span><span class="n">model_pb</span><span class="o">.</span><span class="n">metadata</span><span class="p">),</span>
            <span class="n">model</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">producer</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_make_target_model</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">job_pb</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">CompileJob</span> <span class="o">|</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">QuantizeJob</span><span class="p">,</span> <span class="n">producer</span><span class="p">:</span> <span class="n">Job</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Model</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">job_pb</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s2">&quot;target_model&quot;</span><span class="p">):</span>
            <span class="n">target_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_model</span><span class="p">(</span><span class="n">job_pb</span><span class="o">.</span><span class="n">target_model</span><span class="p">,</span> <span class="n">producer</span><span class="o">=</span><span class="n">producer</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">target_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">APIException</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;We were unable to retrieve the target model. Please contact support at </span><span class="si">{</span><span class="n">SUPPORT_EMAIL</span><span class="si">}</span><span class="s2"> for help.&quot;</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">target_model</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_upload_model</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="p">(</span>
            <span class="n">Model</span> <span class="o">|</span> <span class="n">Any</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span>  <span class="c1"># Any instead of SourceModel to keep mypy happy</span>
        <span class="p">),</span>
        <span class="n">model_type</span><span class="p">:</span> <span class="n">SourceModelType</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Model</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">Model</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">model</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="n">_determine_model_extension</span><span class="p">(</span><span class="n">model_type</span><span class="p">)</span>
        <span class="n">api_model_type</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;api_pb.ModelType.ValueType&quot;</span><span class="p">,</span> <span class="n">model_type</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="c1"># Create a temporary file to be used if we need to write a model to disk before upload.</span>
        <span class="c1"># delete=False to be compatible with Windows</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">model_tempfile</span><span class="p">:</span>
            <span class="n">file_path_to_upload</span> <span class="o">=</span> <span class="n">model_tempfile</span><span class="o">.</span><span class="n">name</span>

        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">is_directory</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
            <span class="c1"># TODO (#11279): Consolidate model zip logic with</span>
            <span class="c1"># zip_model_if_necessary used by celery compiler worker</span>
            <span class="n">file_path_to_upload</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="p">))</span>
            <span class="n">model_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path_to_upload</span><span class="p">)</span>
            <span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">model_type</span> <span class="ow">in</span> <span class="n">ZIPPABLE_MODEL_TYPES</span><span class="p">:</span>
                <span class="c1"># Some models are directory based assets.</span>
                <span class="c1"># Ensure we upload these as zipped model.</span>
                <span class="k">assert</span> <span class="n">suffix</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">)</span>
                <span class="n">model_suffix</span> <span class="o">=</span> <span class="n">suffix</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># Skip making ONNX files compatible to zip structure</span>
                <span class="c1"># if the file_path_to_upload is not a directory and</span>
                <span class="c1"># is not a zip file already.</span>

                <span class="n">skip_zip_check</span> <span class="o">=</span> <span class="n">model_suffix</span> <span class="o">==</span> <span class="s2">&quot;.onnx&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">file_path_to_upload</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="n">file_path_to_upload</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_zip_check</span><span class="p">:</span>
                    <span class="n">file_path_to_upload</span> <span class="o">=</span> <span class="n">_make_zipped_model_compatible</span><span class="p">(</span>
                        <span class="n">file_path_to_upload</span><span class="p">,</span> <span class="n">model_tempfile</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">model_suffix</span>
                    <span class="p">)</span>
                    <span class="n">_assert_is_valid_zipped_model</span><span class="p">(</span><span class="n">file_path_to_upload</span><span class="p">)</span>
                    <span class="n">is_directory</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">TORCHSCRIPT</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>

            <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">file_path_to_upload</span><span class="p">)</span>
            <span class="n">model_name</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">original_name</span>
        <span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">MLMODEL</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">file_path_to_upload</span><span class="p">)</span>
            <span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;MLModel&quot;</span>
        <span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">TFLITE</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path_to_upload</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
            <span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;TFLite&quot;</span>
        <span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">ONNX</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">onnx</span>

            <span class="n">onnx</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">file_path_to_upload</span><span class="p">)</span>

            <span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;ONNX&quot;</span>
        <span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">ORT</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">onnx</span>

            <span class="n">onnx</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">file_path_to_upload</span><span class="p">)</span>
            <span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;ORT&quot;</span>
        <span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">MLPACKAGE</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tempdir</span><span class="p">:</span>
                <span class="n">mlpackage_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempdir</span><span class="p">,</span> <span class="s2">&quot;model.mlpackage&quot;</span><span class="p">)</span>
                <span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">mlpackage_path</span><span class="p">)</span>
                <span class="n">zipped_model_path</span> <span class="o">=</span> <span class="n">zip_model</span><span class="p">(</span><span class="n">tempdir</span><span class="p">,</span> <span class="n">mlpackage_path</span><span class="p">)</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">zipped_model_path</span><span class="p">,</span> <span class="n">file_path_to_upload</span><span class="p">)</span>
            <span class="n">is_directory</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;MLPackage&quot;</span>

        <span class="n">model_name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="n">model_name</span>
        <span class="n">res_pb</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span>
            <span class="n">api</span><span class="o">.</span><span class="n">create_and_upload_model</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
            <span class="n">file_path_to_upload</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
            <span class="n">model_type</span><span class="o">=</span><span class="n">api_model_type</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">is_directory</span><span class="o">=</span><span class="n">is_directory</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">model_tempfile</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">res_pb</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
            <span class="n">model_pb</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span>
                <span class="n">model_id</span><span class="o">=</span><span class="n">res_pb</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
                <span class="n">creation_time</span><span class="o">=</span><span class="n">res_pb</span><span class="o">.</span><span class="n">creation_time</span><span class="p">,</span>
                <span class="n">model_type</span><span class="o">=</span><span class="n">api_model_type</span><span class="p">,</span>
                <span class="n">is_directory</span><span class="o">=</span><span class="n">is_directory</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_model</span><span class="p">(</span><span class="n">model_pb</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>

        <span class="k">raise</span> <span class="n">InternalError</span><span class="p">(</span><span class="s2">&quot;Failed to upload model.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">upload_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">SourceModel</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Model</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uploads a model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model:</span>
<span class="sd">            In memory representation or filename of the model to upload.</span>

<span class="sd">        name:</span>
<span class="sd">            Optional name of the model. If a name is not specified, it is decided</span>
<span class="sd">            either based on the model or the file name.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        model : Model</span>
<span class="sd">            Returns a model if successful.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        UserError</span>
<span class="sd">            Failure in the model input.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        ::</span>

<span class="sd">            import qai_hub as hub</span>
<span class="sd">            import torch</span>

<span class="sd">            pt_model = torch.jit.load(&quot;model.pt&quot;)</span>

<span class="sd">            # Upload model</span>
<span class="sd">            model = hub.upload_model(pt_model)</span>

<span class="sd">            # Jobs can now be scheduled using this model</span>
<span class="sd">            device = hub.Device(&quot;Samsung Galaxy S23&quot;, &quot;12&quot;)</span>
<span class="sd">            cjob = hub.submit_compile_job(model, device=device,</span>
<span class="sd">                                          name=&quot;pt_model (1, 3, 256, 256)&quot;,</span>
<span class="sd">                                          input_shapes=dict(x=(1, 3, 256, 256)))</span>
<span class="sd">            model = cjob.get_target_model()</span>
<span class="sd">            pjob = hub.submit_profile_job(model, device=device,</span>
<span class="sd">                                          name=&quot;pt_model (1, 3, 256, 256)&quot;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model_type</span> <span class="o">=</span> <span class="n">_determine_model_type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">model_type</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_make_dataset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataset_pb</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">DatasetEntries</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dataset</span><span class="p">:</span>
        <span class="n">creation_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_creation_date_from_timestamp</span><span class="p">(</span><span class="n">dataset_pb</span><span class="p">)</span>
        <span class="n">expiration_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expiration_date_from_timestamp</span><span class="p">(</span><span class="n">dataset_pb</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Dataset</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">dataset_id</span><span class="o">=</span><span class="n">dataset_pb</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">,</span>
            <span class="n">dataset_name</span><span class="o">=</span><span class="n">dataset_pb</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">creation_time</span><span class="o">=</span><span class="n">creation_date</span><span class="p">,</span>
            <span class="n">expiration_time</span><span class="o">=</span><span class="n">expiration_date</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_upload_dataset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">inputs</span><span class="p">:</span> <span class="n">Dataset</span> <span class="o">|</span> <span class="n">DatasetEntries</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">permanent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dataset</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">inputs</span>
        <span class="c1"># delete=False to be compatible with Windows</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.h5&quot;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">inputs</span>
            <span class="n">data_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_name</span> <span class="o">=</span> <span class="s2">&quot;h5-dataset&quot;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">inputs</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5f</span><span class="p">:</span>
                <span class="n">dataset_entries_to_h5</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">h5f</span><span class="p">)</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="n">data_name</span>
        <span class="n">res_pb</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span>
            <span class="n">api</span><span class="o">.</span><span class="n">create_and_upload_dataset</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
            <span class="n">path</span><span class="p">,</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">permanent</span><span class="o">=</span><span class="n">permanent</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">res_pb</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
            <span class="n">dataset_pb</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span>
                <span class="n">dataset_id</span><span class="o">=</span><span class="n">res_pb</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">creation_time</span><span class="o">=</span><span class="n">res_pb</span><span class="o">.</span><span class="n">creation_time</span><span class="p">,</span>
                <span class="c1"># This is left at the default value (time.seconds == 0) if the dataset is permanent.</span>
                <span class="n">expiration_time</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="n">permanent</span> <span class="k">else</span> <span class="n">res_pb</span><span class="o">.</span><span class="n">expiration_time</span><span class="p">,</span>
                <span class="n">permanent</span><span class="o">=</span><span class="n">permanent</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_dataset</span><span class="p">(</span><span class="n">dataset_pb</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="k">raise</span> <span class="n">InternalError</span><span class="p">(</span><span class="s2">&quot;Failed to upload data.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">upload_dataset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DatasetEntries</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dataset</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upload a dataset that expires in 30 days. A Dataset has an ordered</span>
<span class="sd">        named schema. For example, dict(x=..., y=...) has a different schema</span>
<span class="sd">        than dict(y=..., x=...).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data:</span>
<span class="sd">            If data is a dict, ordered string keys defines the dataset schema.</span>
<span class="sd">            Length of the list is the number of samples and must be the same</span>
<span class="sd">            for all features</span>

<span class="sd">            If string, it must be an h5 path (str) to a saved dataset.</span>

<span class="sd">        name : str | None</span>
<span class="sd">            Optional name of the dataset. If a name is not specified, it is decided</span>
<span class="sd">            either based on the data or the file name.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dataset : Dataset</span>
<span class="sd">            Returns a dataset object if successful.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        ::</span>

<span class="sd">            import qai_hub as hub</span>
<span class="sd">            import numpy as np</span>

<span class="sd">            # Define dataset</span>
<span class="sd">            array = np.reshape(np.array(range(15)), (3, 5)).astype(np.float32)</span>

<span class="sd">            # Upload dataset</span>
<span class="sd">            hub.upload_dataset(dict(x=[array]), &#39;simplenet_dataset&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_data_entries</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_dataset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dataset</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of datasets visible to you.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        offset : int</span>
<span class="sd">            Offset the query to get even older datasets.</span>
<span class="sd">        limit : int</span>
<span class="sd">            Maximum numbers of datasets to return.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dataset_list: List[Dataset]</span>
<span class="sd">            List of datasets.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Fetch :py:class:`Dataset` objects for your five most recent datasets::</span>

<span class="sd">            import qai_hub as hub</span>

<span class="sd">            datasets = hub.get_datasets(limit=5)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">datasets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dataset_pb</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span>
                <span class="n">api</span><span class="o">.</span><span class="n">get_dataset_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span>
            <span class="p">)</span>
            <span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_make_dataset</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">dataset_pb</span><span class="o">.</span><span class="n">datasets</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">datasets</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dataset</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a dataset for a given id.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dataset_id : str</span>
<span class="sd">            id of a dataset.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dataset: Dataset</span>
<span class="sd">            The dataset for the id.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Get dataset and print information about it (granted you provide a</span>
<span class="sd">        valid dataset ID)::</span>

<span class="sd">            import qai_hub as hub</span>

<span class="sd">            dataset = hub.get_dataset(&quot;dabc123&quot;)</span>
<span class="sd">            print(&quot;Dataset information:&quot;, dataset)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dataset_pb</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">get_dataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">=</span><span class="n">dataset_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_dataset</span><span class="p">(</span><span class="n">dataset_pb</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Model</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a model for a given id.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model_id : str</span>
<span class="sd">            id of a model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        model: Model</span>
<span class="sd">            The model for the id.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model_pb</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">get_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">model_id</span><span class="o">=</span><span class="n">model_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_model</span><span class="p">(</span><span class="n">model_pb</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_models</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Model</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of models.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        offset : int</span>
<span class="sd">            Offset the query to get even older models.</span>
<span class="sd">        limit : int</span>
<span class="sd">            Maximum numbers of models to return.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        model_list: List[Model]</span>
<span class="sd">            List of models.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Fetch :py:class:`Model` objects for your five most recent models::</span>

<span class="sd">            import qai_hub as hub</span>

<span class="sd">            models = hub.get_models(limit=5)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">models</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">model_list_pb</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span>
                <span class="n">api</span><span class="o">.</span><span class="n">get_model_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">model_pb</span> <span class="ow">in</span> <span class="n">model_list_pb</span><span class="o">.</span><span class="n">models</span><span class="p">:</span>
                <span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_make_model</span><span class="p">(</span><span class="n">model_pb</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">models</span>

    <span class="c1">## job related members ##</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_make_job</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">job_pb</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Job</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Model</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="n">Model</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dataset</span><span class="p">:</span> <span class="n">Dataset</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Job</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">job_pb</span><span class="o">.</span><span class="n">WhichOneof</span><span class="p">(</span><span class="s2">&quot;job&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;compile_job&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">Model</span><span class="p">)</span>
            <span class="n">compile_job_pb</span> <span class="o">=</span> <span class="n">job_pb</span><span class="o">.</span><span class="n">compile_job</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">model</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_model</span><span class="p">(</span><span class="n">compile_job_pb</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
            <span class="n">shapes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">api</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">tensor_type_list_pb_to_list_shapes</span><span class="p">(</span>
                    <span class="n">compile_job_pb</span><span class="o">.</span><span class="n">tensor_type_list</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">target_shapes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">api</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">tensor_type_list_pb_to_list_shapes</span><span class="p">(</span>
                    <span class="n">compile_job_pb</span><span class="o">.</span><span class="n">target_tensor_type_list</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_creation_date_from_timestamp</span><span class="p">(</span><span class="n">compile_job_pb</span><span class="p">)</span>
            <span class="n">device</span> <span class="o">=</span> <span class="n">_dev_pb_to_dev</span><span class="p">(</span><span class="n">compile_job_pb</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
            <span class="n">compatible_devices</span> <span class="o">=</span> <span class="n">_devs_pb_to_devs</span><span class="p">(</span><span class="n">compile_job_pb</span><span class="o">.</span><span class="n">devices</span><span class="p">)</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_make_dataset</span><span class="p">(</span><span class="n">compile_job_pb</span><span class="o">.</span><span class="n">calibration_dataset</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">compile_job_pb</span><span class="o">.</span><span class="n">calibration_dataset</span><span class="o">.</span><span class="n">dataset_id</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">CompileJob</span><span class="p">(</span>
                <span class="n">job_pb</span><span class="o">=</span><span class="n">job_pb</span><span class="p">,</span>
                <span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">shapes</span><span class="o">=</span><span class="n">shapes</span><span class="p">,</span>
                <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
                <span class="n">compatible_devices</span><span class="o">=</span><span class="n">compatible_devices</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span>
                <span class="n">target_shapes</span><span class="o">=</span><span class="n">target_shapes</span><span class="p">,</span>
                <span class="n">calibration_dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">job_pb</span><span class="o">.</span><span class="n">WhichOneof</span><span class="p">(</span><span class="s2">&quot;job&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;link_job&quot;</span><span class="p">:</span>
            <span class="n">link_job_pb</span> <span class="o">=</span> <span class="n">job_pb</span><span class="o">.</span><span class="n">link_job</span>
            <span class="k">assert</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">List</span><span class="p">)</span>
            <span class="n">models</span> <span class="o">=</span> <span class="n">model</span> <span class="ow">or</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_make_model</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">link_job_pb</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">models</span><span class="p">]</span>
            <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_creation_date_from_timestamp</span><span class="p">(</span><span class="n">link_job_pb</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">LinkJob</span><span class="p">(</span>
                <span class="n">job_pb</span><span class="o">=</span><span class="n">job_pb</span><span class="p">,</span>
                <span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">models</span><span class="o">=</span><span class="n">models</span><span class="p">,</span>
                <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">job_pb</span><span class="o">.</span><span class="n">WhichOneof</span><span class="p">(</span><span class="s2">&quot;job&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;profile_job&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">Model</span><span class="p">)</span>
            <span class="n">profile_job_pb</span> <span class="o">=</span> <span class="n">job_pb</span><span class="o">.</span><span class="n">profile_job</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">model</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_model</span><span class="p">(</span><span class="n">profile_job_pb</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
            <span class="n">shapes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">api</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">tensor_type_list_pb_to_list_shapes</span><span class="p">(</span>
                    <span class="n">profile_job_pb</span><span class="o">.</span><span class="n">tensor_type_list</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_creation_date_from_timestamp</span><span class="p">(</span><span class="n">profile_job_pb</span><span class="p">)</span>
            <span class="n">device</span> <span class="o">=</span> <span class="n">_dev_pb_to_dev</span><span class="p">(</span><span class="n">profile_job_pb</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ProfileJob</span><span class="p">(</span>
                <span class="n">job_pb</span><span class="o">=</span><span class="n">job_pb</span><span class="p">,</span>
                <span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">shapes</span><span class="o">=</span><span class="n">shapes</span><span class="p">,</span>
                <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">job_pb</span><span class="o">.</span><span class="n">WhichOneof</span><span class="p">(</span><span class="s2">&quot;job&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;inference_job&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">Model</span><span class="p">)</span>
            <span class="n">inference_job_pb</span> <span class="o">=</span> <span class="n">job_pb</span><span class="o">.</span><span class="n">inference_job</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">model</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_model</span><span class="p">(</span><span class="n">inference_job_pb</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_dataset</span><span class="p">(</span><span class="n">inference_job_pb</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span>
            <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_creation_date_from_timestamp</span><span class="p">(</span><span class="n">inference_job_pb</span><span class="p">)</span>
            <span class="n">device</span> <span class="o">=</span> <span class="n">_dev_pb_to_dev</span><span class="p">(</span><span class="n">inference_job_pb</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">InferenceJob</span><span class="p">(</span>
                <span class="n">job_pb</span><span class="o">=</span><span class="n">job_pb</span><span class="p">,</span>
                <span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">job_pb</span><span class="o">.</span><span class="n">WhichOneof</span><span class="p">(</span><span class="s2">&quot;job&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;quantize_job&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">Model</span><span class="p">)</span>
            <span class="n">quantize_job_pb</span> <span class="o">=</span> <span class="n">job_pb</span><span class="o">.</span><span class="n">quantize_job</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">model</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_model</span><span class="p">(</span><span class="n">quantize_job_pb</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
            <span class="n">calibration_dataset</span> <span class="o">=</span> <span class="n">dataset</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_dataset</span><span class="p">(</span>
                <span class="n">quantize_job_pb</span><span class="o">.</span><span class="n">calibration_dataset</span>
            <span class="p">)</span>
            <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_creation_date_from_timestamp</span><span class="p">(</span><span class="n">quantize_job_pb</span><span class="p">)</span>
            <span class="n">shapes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">api</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">tensor_type_list_pb_to_list_shapes</span><span class="p">(</span>
                    <span class="n">quantize_job_pb</span><span class="o">.</span><span class="n">tensor_type_list</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">weights_dtype</span> <span class="o">=</span> <span class="n">QuantizeDtype</span><span class="p">(</span><span class="n">quantize_job_pb</span><span class="o">.</span><span class="n">weights_dtype</span><span class="p">)</span>
            <span class="n">activations_dtype</span> <span class="o">=</span> <span class="n">QuantizeDtype</span><span class="p">(</span><span class="n">quantize_job_pb</span><span class="o">.</span><span class="n">activations_dtype</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">QuantizeJob</span><span class="p">(</span>
                <span class="n">job_pb</span><span class="o">=</span><span class="n">job_pb</span><span class="p">,</span>
                <span class="n">weights_dtype</span><span class="o">=</span><span class="n">weights_dtype</span><span class="p">,</span>
                <span class="n">activations_dtype</span><span class="o">=</span><span class="n">activations_dtype</span><span class="p">,</span>
                <span class="n">calibration_dataset</span><span class="o">=</span><span class="n">calibration_dataset</span><span class="p">,</span>
                <span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                <span class="n">shapes</span><span class="o">=</span><span class="n">shapes</span><span class="p">,</span>
                <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Job</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a job for a given id.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        job_id : str</span>
<span class="sd">            id of a job.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        job: Job</span>
<span class="sd">            The job for the id.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Get job and print its status. The job ID is an alphanumeric string starting with `j`</span>
<span class="sd">        that you can get from the job&#39;s URL (`/jobs/&lt;job ID&gt;`).::</span>

<span class="sd">            import qai_hub as hub</span>

<span class="sd">            job = hub.get_job(&quot;jabc123&quot;)</span>
<span class="sd">            status = job.get_status()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">job_pb</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">get_job</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">job_id</span><span class="o">=</span><span class="n">job_id</span><span class="p">)</span>
        <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_job</span><span class="p">(</span><span class="n">job_pb</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">job</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># probably unknown job type</span>
            <span class="k">raise</span> <span class="n">InternalError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to retrieve job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">job</span>

    <span class="nd">@deprecation</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span>
        <span class="n">deprecated_in</span><span class="o">=</span><span class="s2">&quot;0.15.0&quot;</span><span class="p">,</span>
        <span class="n">details</span><span class="o">=</span><span class="s2">&quot;Please use the &#39;get_job_summaries&#39; API instead.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_jobs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">creator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Job</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deprecated.</span>

<span class="sd">        Please use the :py:func:`qai_hub.get_job_summaries` API instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">job_list_pb</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span>
                <span class="n">api</span><span class="o">.</span><span class="n">get_job_list</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
                <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span>
                <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
                <span class="n">creator</span><span class="o">=</span><span class="n">creator</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">job_pb</span> <span class="ow">in</span> <span class="n">job_list_pb</span><span class="o">.</span><span class="n">jobs</span><span class="p">:</span>
                <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_job</span><span class="p">(</span><span class="n">job_pb</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">job</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jobs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_make_job_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_summary_pb</span><span class="p">:</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">JobSummary</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JobSummary</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">job_summary_pb</span><span class="o">.</span><span class="n">WhichOneof</span><span class="p">(</span><span class="s2">&quot;job&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;compile_job_summary&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CompileJobSummary</span><span class="o">.</span><span class="n">_summary_from_pb</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">job_summary_pb</span><span class="o">.</span><span class="n">compile_job_summary</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">job_summary_pb</span><span class="o">.</span><span class="n">WhichOneof</span><span class="p">(</span><span class="s2">&quot;job&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;link_job_summary&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">LinkJobSummary</span><span class="o">.</span><span class="n">_summary_from_pb</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">job_summary_pb</span><span class="o">.</span><span class="n">link_job_summary</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">job_summary_pb</span><span class="o">.</span><span class="n">WhichOneof</span><span class="p">(</span><span class="s2">&quot;job&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;profile_job_summary&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ProfileJobSummary</span><span class="o">.</span><span class="n">_summary_from_pb</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">job_summary_pb</span><span class="o">.</span><span class="n">profile_job_summary</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">job_summary_pb</span><span class="o">.</span><span class="n">WhichOneof</span><span class="p">(</span><span class="s2">&quot;job&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;inference_job_summary&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">InferenceJobSummary</span><span class="o">.</span><span class="n">_summary_from_pb</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">job_summary_pb</span><span class="o">.</span><span class="n">inference_job_summary</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">job_summary_pb</span><span class="o">.</span><span class="n">WhichOneof</span><span class="p">(</span><span class="s2">&quot;job&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;quantize_job_summary&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">QuantizeJobSummary</span><span class="o">.</span><span class="n">_summary_from_pb</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">job_summary_pb</span><span class="o">.</span><span class="n">quantize_job_summary</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_job_summaries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">creator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="nb">type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">JobType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">JobSummary</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns summary information for jobs matching the specified filters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        creator: Optional[str]</span>
<span class="sd">            Fetch only jobs created by the specified creator. If unspecified, fetch all jobs owned by your organization.</span>
<span class="sd">        state: Optional[JobStatus.State] | List[JobStatus.State]</span>
<span class="sd">            Fetch only jobs that are currently in the specified state(s).</span>
<span class="sd">        type: Optional[JobType]</span>
<span class="sd">            Fetch only jobs of the specified type (compile, profile, etc.).</span>
<span class="sd">        limit : int</span>
<span class="sd">            Maximum number of jobs to return.</span>
<span class="sd">        offset : int</span>
<span class="sd">            How many jobs to skip over (in order to retrieve older jobs).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : List[JobSummary]</span>
<span class="sd">            List of job summaries in reverse chronological order (i.e., most recent first).</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Print a selection of recent jobs::</span>

<span class="sd">            import qai_hub as hub</span>

<span class="sd">            running = hub.get_job_summaries(limit=10, state=hub.JobStatus.all_running_states())</span>
<span class="sd">            failed = hub.get_job_summaries(limit=10, state=hub.JobStatus.State.FAILED)</span>
<span class="sd">            more_failed = hub.get_job_summaries(offset=10, limit=10, state=hub.JobStatus.State.FAILED)</span>
<span class="sd">            for j in running + failed + more_failed:</span>
<span class="sd">                print(f&quot;{j.job_id}: {j.name} running since {j.date}: currently {j.status.code}&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">job_summaries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">states</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">[</span><span class="n">state</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">State</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">state</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">job_summary_list_pb</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span>
                <span class="n">api</span><span class="o">.</span><span class="n">get_job_summary_list</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
                <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span>
                <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
                <span class="n">creator</span><span class="o">=</span><span class="n">creator</span><span class="p">,</span>
                <span class="n">states</span><span class="o">=</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">states</span><span class="p">],</span>
                <span class="n">job_type</span><span class="o">=</span><span class="p">(</span>
                    <span class="nb">type</span><span class="o">.</span><span class="n">value</span>
                    <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="k">else</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">JobType</span><span class="o">.</span><span class="n">JOB_TYPE_UNSPECIFIED</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">job_summary_pb</span> <span class="ow">in</span> <span class="n">job_summary_list_pb</span><span class="o">.</span><span class="n">job_summaries</span><span class="p">:</span>
                <span class="n">summary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_job_summary</span><span class="p">(</span><span class="n">job_summary_pb</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">summary</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">job_summaries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">job_summaries</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_input_specs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_type</span><span class="p">:</span> <span class="n">SourceModelType</span><span class="p">,</span>
        <span class="n">input_specs</span><span class="p">:</span> <span class="n">InputSpecs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">TORCHSCRIPT</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">input_specs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;input_specs must be provided for TorchScript models.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">model_type</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">SourceModelType</span><span class="o">.</span><span class="n">MLMODEL</span><span class="p">,</span>
            <span class="n">SourceModelType</span><span class="o">.</span><span class="n">TFLITE</span><span class="p">,</span>
            <span class="n">SourceModelType</span><span class="o">.</span><span class="n">ONNX</span><span class="p">,</span>
            <span class="n">SourceModelType</span><span class="o">.</span><span class="n">ORT</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="c1"># input_specs is optional for these models. If not</span>
            <span class="c1"># None, the provided shapes must be compatible with the model, or</span>
            <span class="c1"># the server returns an error.</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="n">input_specs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_specs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;input_specs must be Dict[str, Tuple[Tuple[int, ...], str]]]. Got </span><span class="si">{</span><span class="n">input_specs</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">input_specs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="n">shape</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">shape</span> <span class="o">=</span> <span class="n">spec</span>  <span class="c1"># type: ignore</span>

                <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">shape</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">dim</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;The shape of input &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; </span><span class="si">{</span><span class="n">shape</span><span class="si">}</span><span class="s2"> defines an empty tensor. &quot;</span>
                            <span class="s2">&quot;Remove the input or modify the input shape (all dim lengths should be &gt; 0) and try again.&quot;</span>
                        <span class="p">)</span>

    <span class="n">_SUPPORTED_NUMPY_DTYPES</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;float16&quot;</span><span class="p">),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;int8&quot;</span><span class="p">),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;int16&quot;</span><span class="p">),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;int32&quot;</span><span class="p">),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;int64&quot;</span><span class="p">),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;uint16&quot;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_data_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Dataset</span> <span class="o">|</span> <span class="n">DatasetEntries</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">suffix</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">suffix</span> <span class="o">!=</span> <span class="s2">&quot;.h5&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s1">&#39;Dataset file must have &quot;.h5&quot; extension.&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="s2">&quot;Dataset must be Dict[str, List[np.ndarray]] where the &quot;</span>
                <span class="s2">&quot;ordered keys define the schema, and the length of the list is &quot;</span>
                <span class="s2">&quot;the number of samples.&quot;</span>
            <span class="p">)</span>
        <span class="n">batchsizes</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SUPPORTED_NUMPY_DTYPES</span>
                <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">value</span>
            <span class="p">):</span>
                <span class="n">batchsizes</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The values in inputs dictionary must be list of numpy arrays &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;with a type in (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">_SUPPORTED_NUMPY_DTYPES</span><span class="p">])</span><span class="si">}</span><span class="s2">).&quot;</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">batchsizes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Batchsize of all inputs must be the same.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_devices</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">device</span><span class="p">:</span> <span class="n">Device</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="n">Device</span><span class="p">],</span>
        <span class="n">model_type</span><span class="p">:</span> <span class="n">SourceModelType</span><span class="p">,</span>
        <span class="n">compile_job</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Device</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">Device</span><span class="p">):</span>
            <span class="n">device</span> <span class="o">=</span> <span class="p">[</span><span class="n">device</span><span class="p">]</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dev</span> <span class="ow">in</span> <span class="n">device</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_device</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">d</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dev</span><span class="si">}</span><span class="s2"> is not available.&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">compile_job</span><span class="p">:</span>
                <span class="c1"># check if model is compatible with the device frameworks</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">MLMODEL</span>
                    <span class="ow">or</span> <span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">MLPACKAGE</span>
                    <span class="ow">or</span> <span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">MLMODELC</span>
                <span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;framework:coreml&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;device </span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2"> does not support Core ML model input&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">TFLITE</span>
                    <span class="ow">and</span> <span class="s2">&quot;framework:tflite&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">attributes</span>
                <span class="p">):</span>
                    <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;device </span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2"> does not support TFLite model input&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">ONNX</span>
                    <span class="ow">and</span> <span class="s2">&quot;framework:onnx&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">attributes</span>
                <span class="p">):</span>
                    <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;device </span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2"> does not support ONNX model input&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">ORT</span>
                    <span class="ow">and</span> <span class="s2">&quot;framework:onnx&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">attributes</span>
                <span class="p">):</span>
                    <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;device </span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2"> does not support ORT model input&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">QNN_LIB_AARCH64_ANDROID</span>
                    <span class="ow">or</span> <span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">QNN_LIB_X86_64_LINUX</span>
                    <span class="ow">or</span> <span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">QNN_CONTEXT_BINARY</span>
                <span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;framework:qnn&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;device </span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2"> does not support QNN model input&quot;</span><span class="p">)</span>

                <span class="c1"># check if model is compatible with the device os</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">QNN_LIB_AARCH64_ANDROID</span>
                    <span class="ow">and</span> <span class="s2">&quot;os:android&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">attributes</span>
                <span class="p">):</span>
                    <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Aarch64 Android device </span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2"> does not support model type </span><span class="si">{</span><span class="n">model_type</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="p">)</span>

                <span class="c1"># additional checks</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">model_type</span> <span class="o">==</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">MLPACKAGE</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">_is_mlpackage_supported</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">attributes</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">os</span><span class="p">)</span>
                <span class="p">):</span>
                    <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;device </span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2"> does not support Core ML .mlpackage.&quot;</span>
                        <span class="s2">&quot; Please either provide target iOS 15+ (or macOS 12+) for .mlpackage or .mlmodel for iOS 14 (or macOS 11) and below.&quot;</span>
                    <span class="p">)</span>

            <span class="n">devices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">devices</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">submit_compile_job</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Model</span> <span class="o">|</span> <span class="n">SourceModel</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">device</span><span class="p">:</span> <span class="n">Device</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="n">Device</span><span class="p">],</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">input_specs</span><span class="p">:</span> <span class="n">InputSpecs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">single_compile</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">calibration_data</span><span class="p">:</span> <span class="n">Dataset</span> <span class="o">|</span> <span class="n">DatasetEntries</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">retry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CompileJob</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="n">CompileJob</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Submits a compile job.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model:</span>
<span class="sd">            Model to compile. The model must be a PyTorch model or an ONNX model</span>

<span class="sd">        device:</span>
<span class="sd">            Devices for which to compile the input model.</span>

<span class="sd">        name:</span>
<span class="sd">            Optional name for the job. Job names need not be unique.</span>

<span class="sd">        input_specs:</span>
<span class="sd">            Required if `model` is a PyTorch model. Keys in `Dict` (which is</span>
<span class="sd">            ordered in Python 3.7+) define the input names for the target</span>
<span class="sd">            model (e.g., TFLite model) created from this profile job, and may</span>
<span class="sd">            be different from the names in PyTorch model.</span>

<span class="sd">            An input shape can either be a Tuple[int, ...], ie (1, 2, 3), or it</span>
<span class="sd">            can be a Tuple[Tuple[int, ...], str], ie ((1, 2, 3), &quot;int32&quot;)). The</span>
<span class="sd">            latter form can be used to specify the type of the input.  If a type</span>
<span class="sd">            is not specified, it defaults to &quot;float32&quot;. Currently, only &quot;float32&quot;,</span>
<span class="sd">            &quot;int8&quot;, &quot;int16&quot;, &quot;int32&quot;, &quot;uint8&quot;, and &quot;uint16&quot; are accepted types.</span>

<span class="sd">            For example, a PyTorch module with `forward(self, x, y)` may have</span>
<span class="sd">            `input_specs=dict(a=(1,2), b=(1, 3))`. When using the resulting</span>
<span class="sd">            target model (e.g. a TFLite model) from this profile job, the</span>
<span class="sd">            inputs must have keys `a` and `b`, not `x` and `y`. Similarly, if</span>
<span class="sd">            this target model is used in an inference job</span>
<span class="sd">            (see :py:func:`qai_hub.submit_inference_job`), the dataset must</span>
<span class="sd">            have entries `a`, `b` in this order, not `x`, `y`</span>

<span class="sd">            If `model` is an ONNX model, `input_specs` are optional.</span>
<span class="sd">            `input_specs` can be used to overwrite the model&#39;s input names</span>
<span class="sd">            and the dynamic extents for the input shapes.</span>
<span class="sd">            If input_specs is not None, it must be compatible with</span>
<span class="sd">            the model, or the server will return an error.</span>

<span class="sd">        options:</span>
<span class="sd">            Cli-like flag options. See :ref:`api_compile_options`.</span>

<span class="sd">        single_compile:</span>
<span class="sd">            If True, create a single job on a single device compatible with all devices.</span>
<span class="sd">            If False, create a single job for each device</span>

<span class="sd">        calibration_data:</span>
<span class="sd">            Data, Dataset, or Dataset ID to use for post-training quantization.</span>
<span class="sd">            PTQ will be applied to the model during translation.</span>

<span class="sd">        retry:</span>
<span class="sd">            If job creation fails due to rate-limiting, keep retrying periodically until creation succeeds.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        job: CompileJob | List[CompileJob]</span>
<span class="sd">            Returns the compile jobs. Always one job if single_compile is &quot;True&quot;,</span>
<span class="sd">            and possibly multiple jobs if it is &quot;False&quot;.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Submit a traced Torch model for compile on an Samsung Galaxy S23::</span>

<span class="sd">            import qai_hub as hub</span>
<span class="sd">            import torch</span>

<span class="sd">            pt_model = torch.jit.load(&quot;mobilenet.pt&quot;)</span>

<span class="sd">            input_specs = (1, 3, 224, 224)</span>

<span class="sd">            model = hub.upload_model(pt_model)</span>

<span class="sd">            job = hub.submit_compile_job(model, device=hub.Device(&quot;Samsung Galaxy S23&quot;),</span>
<span class="sd">                                         name=&quot;mobilenet (1, 3, 224, 224)&quot;,</span>
<span class="sd">                                         input_specs=dict(x=input_specs))</span>

<span class="sd">        For more examples, see :ref:`compile_examples`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Determine the model type</span>
        <span class="n">model_type</span> <span class="o">=</span> <span class="n">_determine_model_type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">allows_compilation</span><span class="p">(</span><span class="n">model_type</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Input model type cannot be compiled.&quot;</span><span class="p">)</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_devices</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">model_type</span><span class="p">,</span> <span class="n">compile_job</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_input_specs</span><span class="p">(</span><span class="n">model_type</span><span class="o">=</span><span class="n">model_type</span><span class="p">,</span> <span class="n">input_specs</span><span class="o">=</span><span class="n">input_specs</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">model_type</span><span class="o">=</span><span class="n">model_type</span><span class="p">)</span>
        <span class="n">tensor_type_list_pb</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">input_shapes_to_tensor_type_list_pb</span><span class="p">(</span><span class="n">input_specs</span><span class="p">)</span>

        <span class="c1"># Get Dataset</span>
        <span class="k">if</span> <span class="n">calibration_data</span><span class="p">:</span>
            <span class="n">calibration_dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_dataset</span><span class="p">(</span><span class="n">calibration_data</span><span class="p">)</span>
            <span class="n">calibration_dataset_pb</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span>
                <span class="n">dataset_id</span><span class="o">=</span><span class="n">calibration_dataset</span><span class="o">.</span><span class="n">dataset_id</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">calibration_dataset_pb</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">job_name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">single_compile</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">devices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">compatible_devices_pb</span> <span class="o">=</span> <span class="n">_devs_to_devs_pb</span><span class="p">(</span><span class="n">devices</span><span class="p">)</span>
            <span class="n">model_pb</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">model_id</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_id</span><span class="p">)</span>
            <span class="n">compile_job_pb</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">CompileJob</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model_pb</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">job_name</span><span class="p">,</span>
                <span class="n">devices</span><span class="o">=</span><span class="n">compatible_devices_pb</span><span class="p">,</span>
                <span class="n">tensor_type_list</span><span class="o">=</span><span class="n">tensor_type_list_pb</span><span class="p">,</span>
                <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
                <span class="n">calibration_dataset</span><span class="o">=</span><span class="n">calibration_dataset_pb</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">retry</span><span class="p">:</span>
                <span class="n">response_pb</span> <span class="o">=</span> <span class="n">_api_call_with_retry</span><span class="p">(</span>
                    <span class="n">api</span><span class="o">.</span><span class="n">create_compile_job</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">compile_job_pb</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">response_pb</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span>
                    <span class="n">api</span><span class="o">.</span><span class="n">create_compile_job</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">compile_job_pb</span>
                <span class="p">)</span>

            <span class="c1"># this fetches the job, including the selected device compiled for</span>
            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job</span><span class="p">(</span><span class="n">response_pb</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">CompileJob</span><span class="p">)</span>
            <span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Scheduled compile job (</span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="si">}</span><span class="s2">) successfully. To see &quot;</span>
                    <span class="s2">&quot;the status and results:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dev</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
                <span class="n">devices_pb</span> <span class="o">=</span> <span class="n">_devs_to_devs_pb</span><span class="p">([</span><span class="n">dev</span><span class="p">])</span>
                <span class="n">model_pb</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">model_id</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_id</span><span class="p">)</span>
                <span class="n">compile_job_pb</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">CompileJob</span><span class="p">(</span>
                    <span class="n">model</span><span class="o">=</span><span class="n">model_pb</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">job_name</span><span class="p">,</span>
                    <span class="n">devices</span><span class="o">=</span><span class="n">devices_pb</span><span class="p">,</span>
                    <span class="n">tensor_type_list</span><span class="o">=</span><span class="n">tensor_type_list_pb</span><span class="p">,</span>
                    <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
                    <span class="n">calibration_dataset</span><span class="o">=</span><span class="n">calibration_dataset_pb</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">response_pb</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span>
                    <span class="n">api</span><span class="o">.</span><span class="n">create_compile_job</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">compile_job_pb</span>
                <span class="p">)</span>
                <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job</span><span class="p">(</span><span class="n">response_pb</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">CompileJob</span><span class="p">)</span>
                <span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Scheduled compile job (</span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="si">}</span><span class="s2">) successfully. To see &quot;</span>
                        <span class="s2">&quot;the status and results:</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jobs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">jobs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">submit_quantize_job</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Model</span> <span class="o">|</span> <span class="n">SourceModel</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">calibration_data</span><span class="p">:</span> <span class="n">Dataset</span> <span class="o">|</span> <span class="n">DatasetEntries</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">weights_dtype</span><span class="p">:</span> <span class="n">QuantizeDtype</span> <span class="o">=</span> <span class="n">QuantizeDtype</span><span class="o">.</span><span class="n">INT8</span><span class="p">,</span>
        <span class="n">activations_dtype</span><span class="p">:</span> <span class="n">QuantizeDtype</span> <span class="o">=</span> <span class="n">QuantizeDtype</span><span class="o">.</span><span class="n">INT8</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuantizeJob</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Submits a quantize job. Input model must be onnx. The resulting target model</span>
<span class="sd">        on a completed job will be a quantized onnx model in QDQ format.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model:</span>
<span class="sd">            Model to quantize. The model must be a PyTorch model or an ONNX model</span>

<span class="sd">        calibration_data:</span>
<span class="sd">            Data, Dataset, or Dataset ID used to calibrate quantization parameters.</span>

<span class="sd">        name:</span>
<span class="sd">            Optional name for the job. Job names need not be unique.</span>

<span class="sd">        weights_dtype:</span>
<span class="sd">            The data type to which weights will be quantized.</span>

<span class="sd">        activations_dtype:</span>
<span class="sd">            The data type to which activations will be quantized.</span>

<span class="sd">        options:</span>
<span class="sd">            Cli-like flag options. See :ref:`api_quantize_options`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        job: QuantizeJob</span>
<span class="sd">            Returns the quantize job.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Submit an onnx model for quantization::</span>

<span class="sd">            import numpy as np</span>
<span class="sd">            import qai_hub as hub</span>

<span class="sd">            model_file = &quot;mobilenet_v2.onnx&quot;</span>
<span class="sd">            calibration_data = {&quot;t.1&quot;: [np.random.randn(1, 3, 224, 224).astype(np.float32)]}</span>
<span class="sd">            job = hub.submit_quantize_job(</span>
<span class="sd">                model_file,</span>
<span class="sd">                calibration_data,</span>
<span class="sd">                weights_dtype=hub.QuantizeDtype.INT8,</span>
<span class="sd">                activations_dtype=hub.QuantizeDtype.INT8,</span>
<span class="sd">                name=&quot;mobilenet&quot;,</span>
<span class="sd">            )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">weights_dtype</span> <span class="o">!=</span> <span class="n">QuantizeDtype</span><span class="o">.</span><span class="n">INT8</span> <span class="ow">and</span> <span class="n">activations_dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">QuantizeDtype</span><span class="o">.</span><span class="n">INT8</span><span class="p">,</span>
            <span class="n">QuantizeDtype</span><span class="o">.</span><span class="n">INT16</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Weights must be INT8 and activations must be INT8 or INT16.&quot;</span>
            <span class="p">)</span>
        <span class="c1"># Determine the model type</span>
        <span class="n">model_type</span> <span class="o">=</span> <span class="n">_determine_model_type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model_type</span> <span class="o">!=</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">ONNX</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Input model must be ONNX.&quot;</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">model_type</span><span class="o">=</span><span class="n">model_type</span><span class="p">)</span>

        <span class="c1"># Get Dataset</span>
        <span class="n">calibration_dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_dataset</span><span class="p">(</span><span class="n">calibration_data</span><span class="p">)</span>
        <span class="n">calibration_dataset_pb</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span>
            <span class="n">dataset_id</span><span class="o">=</span><span class="n">calibration_dataset</span><span class="o">.</span><span class="n">dataset_id</span>
        <span class="p">)</span>

        <span class="n">job_name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span>
        <span class="n">model_pb</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">model_id</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_id</span><span class="p">)</span>
        <span class="n">quantize_job_pb</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">QuantizeJob</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model_pb</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">job_name</span><span class="p">,</span>
            <span class="n">weights_dtype</span><span class="o">=</span><span class="n">weights_dtype</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">activations_dtype</span><span class="o">=</span><span class="n">activations_dtype</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">calibration_dataset</span><span class="o">=</span><span class="n">calibration_dataset_pb</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">response_pb</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">create_quantize_job</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">quantize_job_pb</span><span class="p">)</span>

        <span class="c1"># This fetches the job</span>
        <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job</span><span class="p">(</span><span class="n">response_pb</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">QuantizeJob</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Scheduled quantize job (</span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="si">}</span><span class="s2">) successfully. To see &quot;</span>
                <span class="s2">&quot;the status and results:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">job</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">submit_link_job</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">models</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Model</span><span class="p">],</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LinkJob</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Submits a link job.</span>

<span class="sd">        A link job combines multiple models into a single one with multiple</span>
<span class="sd">        graphs. This is particularly useful if the input models contain</span>
<span class="sd">        overlapping weights, since the weights will be shared between the</span>
<span class="sd">        graphs. This feature is exclusive to QNN context binaries.</span>

<span class="sd">        To profile or inference a multi-graph QNN context binary, please use</span>
<span class="sd">        ``--qnn_options context_enable_graphs=&lt;graph name&gt;`` to select the graph.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        models:</span>
<span class="sd">            Models to link. Each model in the list must be an AI Hub compiled QNN context binary model.</span>

<span class="sd">        name:</span>
<span class="sd">            Optional name for the job. Job names need not be unique.</span>

<span class="sd">        options:</span>
<span class="sd">            Cli-like flag options. See :ref:`api_link_options`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        job: LinkJob</span>
<span class="sd">            Returns the link job.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;A link job takes at least two input models.&quot;</span><span class="p">)</span>
        <span class="n">models_pb</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ModelList</span><span class="p">(</span><span class="n">total_query_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">model</span><span class="o">.</span><span class="n">producer</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">producer</span><span class="p">,</span> <span class="n">CompileJob</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">model</span><span class="o">.</span><span class="n">model_type</span> <span class="o">!=</span> <span class="n">SourceModelType</span><span class="o">.</span><span class="n">QNN_CONTEXT_BINARY</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                    <span class="s2">&quot;Supplied models must all be an AI Hub-compiled QNN context binary (from single-graph compile jobs)&quot;</span>
                <span class="p">)</span>
            <span class="n">models_pb</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">api_pb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">model_id</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_id</span><span class="p">))</span>
        <span class="n">job_name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="n">models</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
        <span class="n">link_job_pb</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">LinkJob</span><span class="p">(</span>
            <span class="n">models</span><span class="o">=</span><span class="n">models_pb</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">job_name</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="n">response_pb</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">create_link_job</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">link_job_pb</span><span class="p">)</span>
        <span class="n">link_job_pb</span><span class="o">.</span><span class="n">link_job_id</span> <span class="o">=</span> <span class="n">response_pb</span><span class="o">.</span><span class="n">id</span>
        <span class="n">link_job_pb</span><span class="o">.</span><span class="n">creation_time</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">response_pb</span><span class="o">.</span><span class="n">creation_time</span><span class="p">)</span>
        <span class="n">job_pb</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Job</span><span class="p">(</span><span class="n">link_job</span><span class="o">=</span><span class="n">link_job_pb</span><span class="p">)</span>
        <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_job</span><span class="p">(</span><span class="n">job_pb</span><span class="p">,</span> <span class="n">models</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">LinkJob</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">job</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">submit_profile_job</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Model</span> <span class="o">|</span> <span class="n">TargetModel</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">device</span><span class="p">:</span> <span class="n">Device</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="n">Device</span><span class="p">],</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">retry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ProfileJob</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="n">ProfileJob</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Submits a profile job.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model:</span>
<span class="sd">            Model to profile. Must not be a PyTorch, an ONNX, or an ORT model</span>

<span class="sd">        device:</span>
<span class="sd">            Devices on which to run the profile job.</span>

<span class="sd">        name:</span>
<span class="sd">            Optional name for the job. Job names need not be unique.</span>

<span class="sd">        options:</span>
<span class="sd">            Cli-like flag options. See :ref:`api_profile_options`.</span>

<span class="sd">        retry:</span>
<span class="sd">            If job creation fails due to rate-limiting, keep retrying periodically until creation succeeds.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        job: ProfileJob | List[ProfileJob]</span>
<span class="sd">            Returns the profile jobs.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Submit a tflite model for profiling on a Samsung Galaxy S23::</span>

<span class="sd">            import qai_hub as hub</span>

<span class="sd">            model = hub.upload_model(&quot;mobilenet.tflite&quot;)</span>

<span class="sd">            job = hub.submit_profile_job(model,</span>
<span class="sd">                                         device=hub.Device(&quot;Samsung Galaxy S23&quot;),</span>
<span class="sd">                                         name=&quot;mobilenet (1, 3, 224, 224)&quot;)</span>

<span class="sd">        For more examples, see :ref:`profile_examples`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Determine the model type</span>
        <span class="n">model_type</span> <span class="o">=</span> <span class="n">_determine_model_type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">requires_compilation</span><span class="p">(</span><span class="n">model_type</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="s2">&quot;Supplied model type cannot be profiled until is has been compiled.&quot;</span>
            <span class="p">)</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_devices</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">model_type</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">model_type</span><span class="o">=</span><span class="n">model_type</span><span class="p">)</span>
        <span class="n">job_name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dev</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
            <span class="n">dev_pb</span> <span class="o">=</span> <span class="n">_dev_to_dev_pb</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>
            <span class="n">model_pb</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">model_id</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_id</span><span class="p">)</span>
            <span class="n">profile_job_pb</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">ProfileJob</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model_pb</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">job_name</span><span class="p">,</span>
                <span class="n">device</span><span class="o">=</span><span class="n">dev_pb</span><span class="p">,</span>
                <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">retry</span><span class="p">:</span>
                <span class="n">response_pb</span> <span class="o">=</span> <span class="n">_api_call_with_retry</span><span class="p">(</span>
                    <span class="n">api</span><span class="o">.</span><span class="n">create_profile_job</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">profile_job_pb</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">response_pb</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span>
                    <span class="n">api</span><span class="o">.</span><span class="n">create_profile_job</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">profile_job_pb</span>
                <span class="p">)</span>

            <span class="n">profile_job_pb</span><span class="o">.</span><span class="n">profile_job_id</span> <span class="o">=</span> <span class="n">response_pb</span><span class="o">.</span><span class="n">id</span>
            <span class="n">profile_job_pb</span><span class="o">.</span><span class="n">creation_time</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">response_pb</span><span class="o">.</span><span class="n">creation_time</span><span class="p">)</span>
            <span class="n">job_pb</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Job</span><span class="p">(</span><span class="n">profile_job</span><span class="o">=</span><span class="n">profile_job_pb</span><span class="p">)</span>
            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_job</span><span class="p">(</span><span class="n">job_pb</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">ProfileJob</span><span class="p">)</span>
            <span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Scheduled profile job (</span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="si">}</span><span class="s2">) successfully. To see &quot;</span>
                    <span class="s2">&quot;the status and results:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jobs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">jobs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">submit_inference_job</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Model</span> <span class="o">|</span> <span class="n">TargetModel</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">device</span><span class="p">:</span> <span class="n">Device</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="n">Device</span><span class="p">],</span>
        <span class="n">inputs</span><span class="p">:</span> <span class="n">Dataset</span> <span class="o">|</span> <span class="n">DatasetEntries</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">retry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InferenceJob</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="n">InferenceJob</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Submits an inference job.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model:</span>
<span class="sd">            Model to run inference with. Must be one of the following:</span>
<span class="sd">            (1) Model object from a compile job via :py:func:`qai_hub.CompileJob.get_target_model`</span>
<span class="sd">            (2) Any TargetModel</span>
<span class="sd">            (3) Path to Any TargetModel</span>

<span class="sd">        device:</span>
<span class="sd">            Devices on which to run the job.</span>

<span class="sd">        inputs:</span>
<span class="sd">            If `Dataset`, it must have matching schema  to `model`. For</span>
<span class="sd">            example, if `model` is a target model from a compile job, and the</span>
<span class="sd">            compile job was submitted with `input_shapes=dict(a=(1, 2), b=(1,</span>
<span class="sd">            3))`. The dataset must also be created with</span>
<span class="sd">            `dict(a=&lt;list_of_np_array&gt;, b=&lt;list_of_np_array&gt;)`. See</span>
<span class="sd">            :py:func:`qai_hub.submit_compile_job` for details.</span>

<span class="sd">            If `Dict`, it&#39;s uploaded as a new `Dataset`, equivalent to</span>
<span class="sd">            calling :py:func:`qai_hub.upload_dataset` with arbitrary name.</span>
<span class="sd">            Note that `Dict` is ordered in Python 3.7+ and we rely on the</span>
<span class="sd">            order to match the schema. See the paragraph above for an example.</span>

<span class="sd">            If str, it&#39;s a h5 path to Dataset.</span>

<span class="sd">        name:</span>
<span class="sd">            Optional name for the job. Job names need not be unique.</span>

<span class="sd">        options:</span>
<span class="sd">            Cli-like flag options. See :ref:`api_profile_options`.</span>

<span class="sd">        retry:</span>
<span class="sd">            If job creation fails due to rate-limiting, keep retrying periodically until creation succeeds.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        job: InferenceJob | List[InferenceJob]</span>
<span class="sd">            Returns the inference jobs.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Submit a TFLite model for inference on a Samsung Galaxy S23::</span>

<span class="sd">            import qai_hub as hub</span>
<span class="sd">            import numpy as np</span>

<span class="sd">            # TFlite model path</span>
<span class="sd">            tflite_model = &quot;squeeze_net.tflite&quot;</span>

<span class="sd">            # Setup input data</span>
<span class="sd">            input_tensor = np.random.random((1, 3, 227, 227)).astype(np.float32)</span>

<span class="sd">            # Submit inference job</span>
<span class="sd">            job = hub.submit_inference_job(</span>
<span class="sd">                tflite_model,</span>
<span class="sd">                device=hub.Device(&quot;Samsung Galaxy S23&quot;),</span>
<span class="sd">                name=&quot;squeeze_net (1, 3, 227, 227)&quot;,</span>
<span class="sd">                inputs=dict(image=[input_tensor]),</span>
<span class="sd">            )</span>

<span class="sd">            # Load the output data into a dictionary of numpy arrays</span>
<span class="sd">            output_tensors = job.download_output_data()</span>

<span class="sd">        For more examples, see :ref:`inference_examples`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Determine the model type</span>
        <span class="n">model_type</span> <span class="o">=</span> <span class="n">_determine_model_type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">requires_compilation</span><span class="p">(</span><span class="n">model_type</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="s2">&quot;Supplied model type cannot be profiled until is has been compiled.&quot;</span>
            <span class="p">)</span>

        <span class="n">devices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_devices</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">model_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_data_entries</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">model_type</span><span class="o">=</span><span class="n">model_type</span><span class="p">)</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_dataset</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

        <span class="n">job_name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dev</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
            <span class="n">dev_pb</span> <span class="o">=</span> <span class="n">_dev_to_dev_pb</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>
            <span class="n">model_pb</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">model_id</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_id</span><span class="p">)</span>
            <span class="n">dataset_pb</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">dataset_id</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">)</span>
            <span class="n">inference_job_pb</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">InferenceJob</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model_pb</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">job_name</span><span class="p">,</span>
                <span class="n">device</span><span class="o">=</span><span class="n">dev_pb</span><span class="p">,</span>
                <span class="n">dataset</span><span class="o">=</span><span class="n">dataset_pb</span><span class="p">,</span>
                <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">retry</span><span class="p">:</span>
                <span class="n">response_pb</span> <span class="o">=</span> <span class="n">_api_call_with_retry</span><span class="p">(</span>
                    <span class="n">api</span><span class="o">.</span><span class="n">create_inference_job</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">inference_job_pb</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">response_pb</span> <span class="o">=</span> <span class="n">_api_call</span><span class="p">(</span>
                    <span class="n">api</span><span class="o">.</span><span class="n">create_inference_job</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">inference_job_pb</span>
                <span class="p">)</span>

            <span class="n">inference_job_pb</span><span class="o">.</span><span class="n">inference_job_id</span> <span class="o">=</span> <span class="n">response_pb</span><span class="o">.</span><span class="n">id</span>
            <span class="n">inference_job_pb</span><span class="o">.</span><span class="n">creation_time</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">response_pb</span><span class="o">.</span><span class="n">creation_time</span><span class="p">)</span>
            <span class="n">job_pb</span> <span class="o">=</span> <span class="n">api_pb</span><span class="o">.</span><span class="n">Job</span><span class="p">(</span><span class="n">inference_job</span><span class="o">=</span><span class="n">inference_job_pb</span><span class="p">)</span>
            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_job</span><span class="p">(</span><span class="n">job_pb</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">InferenceJob</span><span class="p">)</span>
            <span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Scheduled inference job (</span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="si">}</span><span class="s2">) successfully. To see &quot;</span>
                    <span class="s2">&quot;the status and results:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jobs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">jobs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">submit_compile_and_profile_jobs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Model</span> <span class="o">|</span> <span class="n">SourceModel</span> <span class="o">|</span> <span class="n">TargetModel</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">device</span><span class="p">:</span> <span class="n">Device</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="n">Device</span><span class="p">],</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">input_specs</span><span class="p">:</span> <span class="n">InputSpecs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">compile_options</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">profile_options</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">single_compile</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">calibration_data</span><span class="p">:</span> <span class="n">Dataset</span> <span class="o">|</span> <span class="n">DatasetEntries</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">retry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span>
        <span class="n">Tuple</span><span class="p">[</span><span class="n">CompileJob</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ProfileJob</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span>
        <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">CompileJob</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ProfileJob</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Submits a compilation job and a profile job.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model:</span>
<span class="sd">            Model to profile.</span>

<span class="sd">        device:</span>
<span class="sd">            Devices on which to run the jobs.</span>

<span class="sd">        name:</span>
<span class="sd">            Optional name for both the jobs. Job names need not be unique.</span>

<span class="sd">        input_specs:</span>
<span class="sd">            Required if `model` is a PyTorch model. Keys in `Dict` (which is</span>
<span class="sd">            ordered in Python 3.7+) define the input names for the target</span>
<span class="sd">            model (e.g., TFLite model) created from this profile job, and may</span>
<span class="sd">            be different from the names in PyTorch model.</span>

<span class="sd">            An input shape can either be a Tuple[int, ...], ie (1, 2, 3), or it</span>
<span class="sd">            can be a Tuple[Tuple[int, ...], str], ie ((1, 2, 3), &quot;int32&quot;)). The</span>
<span class="sd">            latter form can be used to specify the type of the input.  If a type</span>
<span class="sd">            is not specified, it defaults to &quot;float32&quot;. Currently, only &quot;float32&quot;,</span>
<span class="sd">            &quot;int8&quot;, &quot;int16&quot;, &quot;int32&quot;, &quot;uint8&quot;, and &quot;uint16&quot; are accepted types.</span>

<span class="sd">            For example, a PyTorch module with `forward(self, x, y)` may have</span>
<span class="sd">            `input_specs=dict(a=(1,2), b=(1, 3))`. When using the resulting</span>
<span class="sd">            target model (e.g. a TFLite model) from this profile job, the</span>
<span class="sd">            inputs must have keys `a` and `b`, not `x` and `y`. Similarly, if</span>
<span class="sd">            this target model is used in an inference job</span>
<span class="sd">            (see :py:func:`qai_hub.submit_inference_job`), the dataset must</span>
<span class="sd">            have entries `a`, `b` in this order, not `x`, `y`</span>

<span class="sd">            If `model` is an ONNX model, `input_specs` are optional.</span>
<span class="sd">            `input_specs` can be used to overwrite the model&#39;s input names</span>
<span class="sd">            and the dynamic extents for the input shapes.</span>
<span class="sd">            If input_specs is not None, it must be compatible with</span>
<span class="sd">            the model, or the server will return an error.</span>

<span class="sd">        single_compile:</span>
<span class="sd">            If True, create a single job on a single device compatible with all devices.</span>
<span class="sd">            If False, create a single job for each device</span>

<span class="sd">        compile_options:</span>
<span class="sd">            Cli-like flag options for the compile job. See :ref:`api_compile_options`.</span>

<span class="sd">        profile_options:</span>
<span class="sd">            Cli-like flag options for the profile job. See :ref:`api_profile_options`.</span>

<span class="sd">        calibration_data:</span>
<span class="sd">            Data, Dataset, or Dataset ID to use for post-training quantization.</span>
<span class="sd">            PTQ will be applied to the model during translation.</span>

<span class="sd">        retry:</span>
<span class="sd">            If job creation fails due to rate-limiting, keep retrying periodically until creation succeeds.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        jobs: Tuple[CompileJob | None, ProfileJob | None] | List[Tuple[CompileJob | None, ProfileJob | None]</span>
<span class="sd">            Returns a tuple of CompileJob and ProfileJob.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Submit a traced Torch model for profiling as a QNN Model Library on a</span>
<span class="sd">        Samsung Galaxy S23::</span>

<span class="sd">            import qai_hub as hub</span>
<span class="sd">            import torch</span>

<span class="sd">            pt_model = torch.jit.load(&quot;mobilenet.pt&quot;)</span>

<span class="sd">            input_shapes = (1, 3, 224, 224)</span>

<span class="sd">            model = hub.upload_model(pt_model)</span>

<span class="sd">            jobs = hub.submit_compile_and_profile_jobs(</span>
<span class="sd">                model, device=hub.Device(&quot;Samsung Galaxy 23&quot;),</span>
<span class="sd">                name=&quot;mobilenet (1, 3, 224, 224)&quot;,</span>
<span class="sd">                input_specs=dict(x=input_shapes),</span>
<span class="sd">                compile_options=&quot;--target_runtime qnn_lib_aarch64_android&quot;</span>
<span class="sd">            )</span>

<span class="sd">        For more examples, see :ref:`compile_examples` and ref:`profile_examples`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="p">[</span><span class="n">device</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">Device</span><span class="p">)</span> <span class="k">else</span> <span class="n">device</span>
        <span class="n">num_jobs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">devices</span><span class="p">)</span>
        <span class="n">model_type</span> <span class="o">=</span> <span class="n">_determine_model_type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">allows_compilation</span><span class="p">(</span><span class="n">model_type</span><span class="p">):</span>
            <span class="c1"># Ignoring type because the above predicate ensures that model is a TargetModel</span>
            <span class="n">pjobs</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_profile_job</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">devices</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">profile_options</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pjobs</span><span class="p">,</span> <span class="n">ProfileJob</span><span class="p">):</span>
                <span class="n">pjobs</span> <span class="o">=</span> <span class="p">[</span><span class="n">pjobs</span><span class="p">]</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pjobs</span><span class="p">,</span> <span class="n">List</span><span class="p">)</span>
            <span class="n">cjobs</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_jobs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cjobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_compile_job</span><span class="p">(</span>
                <span class="n">model</span><span class="p">,</span>
                <span class="n">devices</span><span class="p">,</span>
                <span class="n">name</span><span class="p">,</span>
                <span class="n">input_specs</span><span class="p">,</span>
                <span class="n">compile_options</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                <span class="n">single_compile</span><span class="o">=</span><span class="n">single_compile</span><span class="p">,</span>
                <span class="n">calibration_data</span><span class="o">=</span><span class="n">calibration_data</span><span class="p">,</span>
                <span class="n">retry</span><span class="o">=</span><span class="n">retry</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cjobs</span><span class="p">,</span> <span class="n">CompileJob</span><span class="p">):</span>
                <span class="n">cjobs</span> <span class="o">=</span> <span class="p">[</span><span class="n">cjobs</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_jobs</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cjobs</span><span class="p">,</span> <span class="n">List</span><span class="p">)</span>
            <span class="n">pjobs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">cjob</span><span class="p">,</span> <span class="n">dev</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cjobs</span><span class="p">,</span> <span class="n">devices</span><span class="p">):</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cjob</span><span class="p">,</span> <span class="n">CompileJob</span><span class="p">)</span>
                <span class="n">target_model</span> <span class="o">=</span> <span class="n">cjob</span><span class="o">.</span><span class="n">get_target_model</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">target_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">job_name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="n">cjob</span><span class="o">.</span><span class="n">name</span>
                    <span class="n">pjob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_profile_job</span><span class="p">(</span>
                        <span class="n">target_model</span><span class="p">,</span>
                        <span class="n">dev</span><span class="p">,</span>
                        <span class="n">job_name</span><span class="p">,</span>
                        <span class="n">profile_options</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                        <span class="n">retry</span><span class="o">=</span><span class="n">retry</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pjob</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">pjobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pjob</span><span class="p">)</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">cjobs</span><span class="p">,</span> <span class="n">pjobs</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">jobs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">jobs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">submit_compile_and_quantize_jobs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Model</span> <span class="o">|</span> <span class="n">SourceModel</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">device</span><span class="p">:</span> <span class="n">Device</span><span class="p">,</span>
        <span class="n">calibration_data</span><span class="p">:</span> <span class="n">Dataset</span> <span class="o">|</span> <span class="n">DatasetEntries</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">input_specs</span><span class="p">:</span> <span class="n">InputSpecs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">compile_options</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">quantize_options</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">weights_dtype</span><span class="p">:</span> <span class="n">QuantizeDtype</span> <span class="o">=</span> <span class="n">QuantizeDtype</span><span class="o">.</span><span class="n">INT8</span><span class="p">,</span>
        <span class="n">activations_dtype</span><span class="p">:</span> <span class="n">QuantizeDtype</span> <span class="o">=</span> <span class="n">QuantizeDtype</span><span class="o">.</span><span class="n">INT8</span><span class="p">,</span>
        <span class="n">retry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">CompileJob</span><span class="p">,</span> <span class="n">QuantizeJob</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compiles a model to onnx and runs a quantize job on the produced onnx model.</span>

<span class="sd">        The input model can be PyTorch or ONNX.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model:</span>
<span class="sd">            Model to compile and quantize.</span>

<span class="sd">        device:</span>
<span class="sd">            Device for which to compile the onnx model.</span>

<span class="sd">        name:</span>
<span class="sd">            Optional name for both the jobs. Job names need not be unique.</span>

<span class="sd">        input_specs:</span>
<span class="sd">            Required if `model` is a PyTorch model. Keys in `Dict` (which is</span>
<span class="sd">            ordered in Python 3.7+) define the input names for the target</span>
<span class="sd">            model (e.g., TFLite model) created from this profile job, and may</span>
<span class="sd">            be different from the names in PyTorch model.</span>

<span class="sd">            An input shape can either be a Tuple[int, ...], ie (1, 2, 3), or it</span>
<span class="sd">            can be a Tuple[Tuple[int, ...], str], ie ((1, 2, 3), &quot;int32&quot;)). The</span>
<span class="sd">            latter form can be used to specify the type of the input.  If a type</span>
<span class="sd">            is not specified, it defaults to &quot;float32&quot;. Currently, only &quot;float32&quot;,</span>
<span class="sd">            &quot;int8&quot;, &quot;int16&quot;, &quot;int32&quot;, &quot;uint8&quot;, and &quot;uint16&quot; are accepted types.</span>

<span class="sd">            For example, a PyTorch module with `forward(self, x, y)` may have</span>
<span class="sd">            `input_specs=dict(a=(1,2), b=(1, 3))`. When using the resulting</span>
<span class="sd">            target model (e.g. a TFLite model) from this profile job, the</span>
<span class="sd">            inputs must have keys `a` and `b`, not `x` and `y`. Similarly, if</span>
<span class="sd">            this target model is used in an inference job</span>
<span class="sd">            (see :py:func:`qai_hub.submit_inference_job`), the dataset must</span>
<span class="sd">            have entries `a`, `b` in this order, not `x`, `y`</span>

<span class="sd">            If `model` is an ONNX model, `input_specs` are optional.</span>
<span class="sd">            `input_specs` can be used to overwrite the model&#39;s input names</span>
<span class="sd">            and the dynamic extents for the input shapes.</span>
<span class="sd">            If input_specs is not None, it must be compatible with</span>
<span class="sd">            the model, or the server will return an error.</span>

<span class="sd">        compile_options:</span>
<span class="sd">            Cli-like flag options for the compile job. See :ref:`api_compile_options`.</span>

<span class="sd">        quantize_options:</span>
<span class="sd">            Cli-like flag options for the quantize job. See :ref:`api_quantize_options`.</span>

<span class="sd">        calibration_data:</span>
<span class="sd">            Data, Dataset, or Dataset ID to use during calibration in the quantize job.</span>

<span class="sd">        weights_dtype:</span>
<span class="sd">            The data type to which weights will be quantized.</span>

<span class="sd">        activations_dtype:</span>
<span class="sd">            The data type to which activations will be quantized.</span>

<span class="sd">        retry:</span>
<span class="sd">            If compile job creation fails due to rate-limiting, keep retrying periodically until creation succeeds.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        jobs: Tuple[CompileJob, QuantizeJob]</span>
<span class="sd">            Returns a tuple of CompileJob and ProfileJob.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Submit an torch model for compile and quantize::</span>

<span class="sd">            import torch</span>
<span class="sd">            import numpy as np</span>
<span class="sd">            import qai_hub as hub</span>

<span class="sd">            pt_model = torch.jit.load(&quot;mobilenet_v2.pt&quot;)</span>
<span class="sd">            input_shapes = (1, 3, 224, 224)</span>

<span class="sd">            calibration_data = {&quot;image&quot;: [np.random.randn(*input_shapes).astype(np.float32)]}</span>
<span class="sd">            job = hub.submit_compile_and_quantize_jobs(</span>
<span class="sd">                pt_model,</span>
<span class="sd">                hub.Device(&quot;Samsung Galaxy S23&quot;),</span>
<span class="sd">                calibration_data,</span>
<span class="sd">                input_specs={&quot;image&quot;: (input_shapes, &quot;float32&quot;)},</span>
<span class="sd">                weights_dtype=hub.QuantizeDtype.INT8,</span>
<span class="sd">                activations_dtype=hub.QuantizeDtype.INT8,</span>
<span class="sd">                name=&quot;mobilenet&quot;,</span>
<span class="sd">            )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model_type</span> <span class="o">=</span> <span class="n">_determine_model_type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">allows_compilation</span><span class="p">(</span><span class="n">model_type</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Input model type cannot be compiled.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;--target_runtime&quot;</span> <span class="ow">in</span> <span class="n">compile_options</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot set --target_runtime, it will be automatically set to ONNX.&quot;</span>
            <span class="p">)</span>
        <span class="n">compile_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_compile_job</span><span class="p">(</span>
            <span class="n">model</span><span class="p">,</span>
            <span class="n">device</span><span class="p">,</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">input_specs</span><span class="p">,</span>
            <span class="n">compile_options</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; --target_runtime onnx&quot;</span><span class="p">,</span>
            <span class="n">retry</span><span class="o">=</span><span class="n">retry</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">compile_job</span><span class="p">,</span> <span class="n">CompileJob</span><span class="p">)</span>
        <span class="n">target_model</span> <span class="o">=</span> <span class="n">compile_job</span><span class="o">.</span><span class="n">get_target_model</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">target_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">job_name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="n">compile_job</span><span class="o">.</span><span class="n">name</span>

        <span class="n">quantize_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_quantize_job</span><span class="p">(</span>
            <span class="n">target_model</span><span class="p">,</span>
            <span class="n">calibration_data</span><span class="p">,</span>
            <span class="n">weights_dtype</span><span class="p">,</span>
            <span class="n">activations_dtype</span><span class="p">,</span>
            <span class="n">job_name</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="n">quantize_options</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">compile_job</span><span class="p">,</span> <span class="n">quantize_job</span><span class="p">)</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Error&quot;</span><span class="p">,</span>
    <span class="s2">&quot;InternalError&quot;</span><span class="p">,</span>
    <span class="s2">&quot;UserError&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Device&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Model&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Job&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CompileJob&quot;</span><span class="p">,</span>
    <span class="s2">&quot;QuantizeJob&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LinkJob&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ProfileJob&quot;</span><span class="p">,</span>
    <span class="s2">&quot;InferenceJob&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JobSummary&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CompileJobSummary&quot;</span><span class="p">,</span>
    <span class="s2">&quot;QuantizeJobSummary&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LinkJobSummary&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ProfileJobSummary&quot;</span><span class="p">,</span>
    <span class="s2">&quot;InferenceJobSummary&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ModelMetadataKey&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SourceModelType&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JobResult&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CompileJobResult&quot;</span><span class="p">,</span>
    <span class="s2">&quot;QuantizeJobResult&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LinkJobResult&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ProfileJobResult&quot;</span><span class="p">,</span>
    <span class="s2">&quot;InferenceJobResult&quot;</span><span class="p">,</span>
    <span class="s2">&quot;QuantizeDtype&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JobStatus&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JobType&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Dataset&quot;</span><span class="p">,</span>
    <span class="s2">&quot;InputSpecs&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023-2024, Nota Inc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>